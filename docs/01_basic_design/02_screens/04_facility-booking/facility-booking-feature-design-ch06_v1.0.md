# æ–½è¨­äºˆç´„æ©Ÿèƒ½ è©³ç´°è¨­è¨ˆæ›¸ Chapter 06: å¤šè¨€èªå¯¾å¿œãƒ»é€šçŸ¥æ©Ÿèƒ½

**HarmoNet ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ—ãƒª**

**æ–‡æ›¸ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH06  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ29æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ‰¿èªå¾…ã¡

---

## ğŸ“‘ ç›®æ¬¡

- [6.1 å¤šè¨€èªå¯¾å¿œæ¦‚è¦](#61-å¤šè¨€èªå¯¾å¿œæ¦‚è¦)
  - [6.1.1 å¯¾å¿œè¨€èª](#611-å¯¾å¿œè¨€èª)
  - [6.1.2 å¤šè¨€èªå¯¾å¿œã®ç¯„å›²](#612-å¤šè¨€èªå¯¾å¿œã®ç¯„å›²)
  - [6.1.3 ç¿»è¨³æ–¹å¼ã®2å±¤æ§‹é€ ](#613-ç¿»è¨³æ–¹å¼ã®2å±¤æ§‹é€ )
- [6.2 é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ](#62-é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ)
  - [6.2.1 ç¿»è¨³ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«](#621-ç¿»è¨³ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«)
  - [6.2.2 ç¿»è¨³ã‚­ãƒ¼ã®å‘½åè¦å‰‡](#622-ç¿»è¨³ã‚­ãƒ¼ã®å‘½åè¦å‰‡)
  - [6.2.3 ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†](#623-ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†)
- [6.3 å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ](#63-å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ)
  - [6.3.1 Google Cloud Translation API ã®åˆ©ç”¨](#631-google-cloud-translation-api-ã®åˆ©ç”¨)
  - [6.3.2 ç®¡ç†è€…æŠ•ç¨¿æ™‚ã®ç¿»è¨³ãƒ•ãƒ­ãƒ¼](#632-ç®¡ç†è€…æŠ•ç¨¿æ™‚ã®ç¿»è¨³ãƒ•ãƒ­ãƒ¼)
  - [6.3.3 ä½æ°‘å´ã®æ²ç¤ºæ¿æŠ•ç¨¿ç¿»è¨³](#633-ä½æ°‘å´ã®æ²ç¤ºæ¿æŠ•ç¨¿ç¿»è¨³)
  - [6.3.4 ç¿»è¨³ã®æœ€é©åŒ–](#634-ç¿»è¨³ã®æœ€é©åŒ–)
- [6.4 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å¤šè¨€èªå¯¾å¿œ](#64-ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å¤šè¨€èªå¯¾å¿œ)
  - [6.4.1 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®ç¨®é¡](#641-ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®ç¨®é¡)
  - [6.4.2 ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤šè¨€èªåŒ–](#642-ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤šè¨€èªåŒ–)
  - [6.4.3 ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†](#643-ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†)
- [6.5 è¨€èªåˆ‡æ›¿æ©Ÿèƒ½](#65-è¨€èªåˆ‡æ›¿æ©Ÿèƒ½)
  - [6.5.1 è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ã®å®Ÿè£…](#651-è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ã®å®Ÿè£…)
  - [6.5.2 è¨€èªåˆ‡æ›¿ã®å‹•ä½œãƒ•ãƒ­ãƒ¼](#652-è¨€èªåˆ‡æ›¿ã®å‹•ä½œãƒ•ãƒ­ãƒ¼)
  - [6.5.3 è¨€èªè¨­å®šã®ä¿å­˜](#653-è¨€èªè¨­å®šã®ä¿å­˜)
- [6.6 é€šçŸ¥æ©Ÿèƒ½](#66-é€šçŸ¥æ©Ÿèƒ½)
  - [6.6.1 é€šçŸ¥ã®ç¨®é¡](#661-é€šçŸ¥ã®ç¨®é¡)
  - [6.6.2 é€šçŸ¥è¨­å®š](#662-é€šçŸ¥è¨­å®š)
  - [6.6.3 ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…](#663-ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…)
  - [6.6.4 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å®Ÿè£…](#664-ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å®Ÿè£…)
- [6.7 ç¿»è¨³å“è³ªã®å‘ä¸Š](#67-ç¿»è¨³å“è³ªã®å‘ä¸Š)
  - [6.7.1 ç¿»è¨³ç²¾åº¦ã®æ¤œè¨¼](#671-ç¿»è¨³ç²¾åº¦ã®æ¤œè¨¼)
  - [6.7.2 å›ºæœ‰åè©ã®å–ã‚Šæ‰±ã„](#672-å›ºæœ‰åè©ã®å–ã‚Šæ‰±ã„)
- [6.8 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#68-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
  - [6.8.1 ç¿»è¨³å¤±æ•—æ™‚ã®å¯¾å¿œ](#681-ç¿»è¨³å¤±æ•—æ™‚ã®å¯¾å¿œ)
  - [6.8.2 ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã®å¯¾å¿œ](#682-ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã®å¯¾å¿œ)
- [ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³](#-ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³)

---

## 6.1 å¤šè¨€èªå¯¾å¿œæ¦‚è¦

HarmoNetã§ã¯ã€æ—¥æœ¬äººä½æ°‘ã¨å¤–å›½äººä½æ°‘ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³éšœå£ã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã€åŒ…æ‹¬çš„ãªå¤šè¨€èªå¯¾å¿œã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### 6.1.1 å¯¾å¿œè¨€èª

| è¨€èª | è¨€èªã‚³ãƒ¼ãƒ‰ | æ–‡å­—ç¨® | å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ |
|------|-----------|--------|-------------|
| æ—¥æœ¬èª | `ja` / `JP` | - | æ—¥æœ¬äººä½æ°‘ |
| è‹±èª | `en` / `EN` | - | è‹±èªåœä½æ°‘ |
| ä¸­å›½èªï¼ˆç°¡ä½“å­—ï¼‰ | `zh-CN` / `CN` | ç°¡ä½“å­— | ä¸­å›½æœ¬åœŸå‡ºèº«ä½æ°‘ |

**æ³¨è¨˜**: ç¹ä½“å­—å¯¾å¿œã¯å°†æ¥æ¤œè¨

### 6.1.2 å¤šè¨€èªå¯¾å¿œã®ç¯„å›²

å¤šè¨€èªå¯¾å¿œã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

| å¯¾è±¡ | ç¿»è¨³æ–¹å¼ | èª¬æ˜ |
|------|----------|------|
| ãƒœã‚¿ãƒ³ãƒ»ãƒ©ãƒ™ãƒ«ãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ | ç¿»è¨³ãƒã‚¹ã‚¿ | äº‹å‰å®šç¾©ã•ã‚ŒãŸé™çš„ç¿»è¨³ |
| ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ç¿»è¨³ãƒã‚¹ã‚¿ | äº‹å‰å®šç¾©ã•ã‚ŒãŸé™çš„ç¿»è¨³ |
| ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ | ç¿»è¨³ãƒã‚¹ã‚¿ | å®šå‹æ–‡ã¨ã—ã¦äº‹å‰å®šç¾© |
| ãŠçŸ¥ã‚‰ã›ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ± | Google Translation API | ç®¡ç†è€…æŠ•ç¨¿æ™‚ã«å‹•çš„ç¿»è¨³ |
| åˆ©ç”¨è¦ç´„ãƒ»ãƒ˜ãƒ«ãƒ— | Google Translation API | åˆå›ä½œæˆæ™‚ã«ç¿»è¨³ã€ä»¥é™ã¯å›ºå®š |
| æ²ç¤ºæ¿æŠ•ç¨¿ | Google Translation API | ä½æ°‘ãŒã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ |
| ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æœ¬æ–‡ | ç¿»è¨³ãƒã‚¹ã‚¿ + å‹•çš„æŒ¿å…¥ | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ç¿»è¨³ãƒã‚¹ã‚¿ã€å¯å¤‰éƒ¨åˆ†ã¯å¤‰æ•° |

**å‚ç…§**: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºç”¨_æ©Ÿèƒ½è¦ä»¶å®šç¾©æ›¸_v1_1.txt - 3.8.4 å¤šè¨€èªå¯¾å¿œ

### 6.1.3 ç¿»è¨³æ–¹å¼ã®2å±¤æ§‹é€ 

HarmoNetã§ã¯ã€ç¿»è¨³æ–¹å¼ã‚’2å±¤æ§‹é€ ã§å®Ÿè£…ã—ã€ã‚³ã‚¹ãƒˆã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ã¾ã™ã€‚

#### ç¬¬1å±¤: é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç¿»è¨³

**å¯¾è±¡**: UIè¦ç´ ï¼ˆãƒœã‚¿ãƒ³ã€ãƒ©ãƒ™ãƒ«ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç­‰ï¼‰

**å®Ÿè£…æ–¹å¼**: ç¿»è¨³ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«

- äº‹å‰ã«äººæ‰‹ã§ç¿»è¨³ã—ãŸé«˜å“è³ªãªæ–‡è¨€ã‚’ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰é«˜é€Ÿã«å–å¾—
- ç¿»è¨³ã‚³ã‚¹ãƒˆ: ã‚¼ãƒ­ï¼ˆåˆå›ä½œæˆæ™‚ã®ã¿ï¼‰

#### ç¬¬2å±¤: å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç¿»è¨³

**å¯¾è±¡**: ãŠçŸ¥ã‚‰ã›ã€æ²ç¤ºæ¿æŠ•ç¨¿ç­‰

**å®Ÿè£…æ–¹å¼**: Google Cloud Translation API (Basic v2)

- æŠ•ç¨¿æ™‚ã¾ãŸã¯é–²è¦§æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã«ã‚ˆã‚Šå†ç¿»è¨³ã‚’å‰Šæ¸›
- æœˆé–“ä½¿ç”¨é‡: ç´„36,500æ–‡å­—ï¼ˆç„¡æ–™æ 50ä¸‡æ–‡å­—å†…ï¼‰

---

## 6.2 é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ

é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆUIè¦ç´ ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç­‰ï¼‰ã¯ã€ç¿»è¨³ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ã—ã¾ã™ã€‚

### 6.2.1 ç¿»è¨³ãƒã‚¹ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«

#### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ 

```sql
CREATE TABLE translations (
  translation_key VARCHAR(100) PRIMARY KEY,
  ja_text TEXT NOT NULL,
  en_text TEXT NOT NULL,
  cn_text TEXT NOT NULL,
  category VARCHAR(50),
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT chk_translation_key CHECK (translation_key ~ '^[a-z0-9._]+$')
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_translations_category ON translations(category);

-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
INSERT INTO translations (translation_key, ja_text, en_text, cn_text, category) VALUES
('booking.button.reserve', 'äºˆç´„ã™ã‚‹', 'Reserve', 'é¢„è®¢', 'ui.button'),
('booking.label.parking_space', 'é§è»Šå ´æ‰€', 'Parking Space', 'åœè½¦ä½', 'ui.label'),
('booking.message.reserve_success', 'äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ', 'Reservation completed successfully', 'é¢„è®¢æˆåŠŸ', 'ui.message'),
('booking.error.already_booked', 'ã“ã®é§è»Šå ´æ‰€ã¯æ—¢ã«äºˆç´„ã•ã‚Œã¦ã„ã¾ã™', 'This parking space is already booked', 'æ­¤åœè½¦ä½å·²è¢«é¢„è®¢', 'ui.error');
```

#### ã‚«ãƒ©ãƒ èª¬æ˜

| ã‚«ãƒ©ãƒ å | ãƒ‡ãƒ¼ã‚¿å‹ | èª¬æ˜ |
|---------|---------|------|
| `translation_key` | VARCHAR(100) | ç¿»è¨³ã‚­ãƒ¼ï¼ˆä¸»ã‚­ãƒ¼ï¼‰ |
| `ja_text` | TEXT | æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ |
| `en_text` | TEXT | è‹±èªãƒ†ã‚­ã‚¹ãƒˆ |
| `cn_text` | TEXT | ä¸­å›½èªãƒ†ã‚­ã‚¹ãƒˆ |
| `category` | VARCHAR(50) | ã‚«ãƒ†ã‚´ãƒªåˆ†é¡ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

#### ã‚«ãƒ†ã‚´ãƒªåˆ†é¡

| ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | ä¾‹ |
|----------|------|-----|
| `ui.button` | ãƒœã‚¿ãƒ³è¦ç´  | äºˆç´„ã™ã‚‹ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ç¢ºå®š |
| `ui.label` | ãƒ©ãƒ™ãƒ«è¦ç´  | é§è»Šå ´æ‰€ã€äºˆç´„æ—¥ã€è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼ |
| `ui.message` | ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | äºˆç´„å®Œäº†ã€å‡¦ç†ä¸­ã§ã™ |
| `ui.error` | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | äºˆç´„æ¸ˆã¿ã€å…¥åŠ›ã‚¨ãƒ©ãƒ¼ |
| `facility.booking` | æ–½è¨­äºˆç´„é–¢é€£ | äºˆç´„å¯èƒ½ã€æº€è»Šã€äºˆç´„ä¸å¯ |

### 6.2.2 ç¿»è¨³ã‚­ãƒ¼ã®å‘½åè¦å‰‡

ç¿»è¨³ã‚­ãƒ¼ã¯ã€æ©Ÿèƒ½ãƒ»è¦ç´ ç¨®åˆ¥ãƒ»è¦ç´ åã®éšå±¤æ§‹é€ ã§å‘½åã—ã¾ã™ã€‚

#### å‘½åè¦å‰‡

```
[æ©Ÿèƒ½].[è¦ç´ ç¨®åˆ¥].[è¦ç´ å]
```

#### å‘½åä¾‹

| ç¿»è¨³ã‚­ãƒ¼ | èª¬æ˜ | æ—¥æœ¬èª | è‹±èª | ä¸­å›½èª |
|---------|------|--------|------|--------|
| `booking.button.reserve` | äºˆç´„ãƒœã‚¿ãƒ³ | äºˆç´„ã™ã‚‹ | Reserve | é¢„è®¢ |
| `booking.button.cancel` | ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ | ã‚­ãƒ£ãƒ³ã‚»ãƒ« | Cancel | å–æ¶ˆ |
| `booking.label.parking_space` | é§è»Šå ´æ‰€ãƒ©ãƒ™ãƒ« | é§è»Šå ´æ‰€ | Parking Space | åœè½¦ä½ |
| `booking.label.date` | æ—¥ä»˜ãƒ©ãƒ™ãƒ« | äºˆç´„æ—¥ | Date | æ—¥æœŸ |
| `booking.message.reserve_success` | äºˆç´„æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ | Reservation completed | é¢„è®¢æˆåŠŸ |
| `booking.error.already_booked` | äºˆç´„æ¸ˆã¿ã‚¨ãƒ©ãƒ¼ | æ—¢ã«äºˆç´„ã•ã‚Œã¦ã„ã¾ã™ | Already booked | å·²è¢«é¢„è®¢ |
| `booking.error.invalid_date` | æ—¥ä»˜ã‚¨ãƒ©ãƒ¼ | ç„¡åŠ¹ãªæ—¥ä»˜ã§ã™ | Invalid date | æ—¥æœŸæ— æ•ˆ |

#### å‘½åã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

1. **å°æ–‡å­—ã®ã¿ä½¿ç”¨**: `booking.button.reserve` (æ­£) / `Booking.Button.Reserve` (èª¤)
2. **ãƒ‰ãƒƒãƒˆåŒºåˆ‡ã‚Š**: éšå±¤ã‚’æ˜ç¢ºã«è¡¨ç¾
3. **å…·ä½“çš„ãªåå‰**: `booking.button.action1` (èª¤) / `booking.button.reserve` (æ­£)
4. **å‹•è©ã¯åŸå½¢**: `reserving` (èª¤) / `reserve` (æ­£)

**å‚ç…§**: code-generation-rules-v2_1_EN.md - Rule 2: Translation Keys

### 6.2.3 ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†

ç¿»è¨³ãƒã‚¹ã‚¿ã¯ã€CSVå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¾ã™ã€‚

#### CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½

**ç®¡ç†ç”»é¢ã®å®Ÿè£…**:
- ç¿»è¨³ãƒã‚¹ã‚¿ä¸€è¦§ç”»é¢ã‹ã‚‰ã€ŒCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- Excelã§ç·¨é›†å¾Œã€ã€ŒCSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆGitç­‰ã§ç®¡ç†ï¼‰

**CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹**:

```csv
translation_key,ja_text,en_text,cn_text,category
booking.button.reserve,äºˆç´„ã™ã‚‹,Reserve,é¢„è®¢,ui.button
booking.button.cancel,ã‚­ãƒ£ãƒ³ã‚»ãƒ«,Cancel,å–æ¶ˆ,ui.button
booking.label.parking_space,é§è»Šå ´æ‰€,Parking Space,åœè½¦ä½,ui.label
booking.message.reserve_success,äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ,Reservation completed successfully,é¢„è®¢æˆåŠŸ,ui.message
```

#### ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ç¿»è¨³æ›´æ–°é–‹å§‹]) --> A[ç®¡ç†ç”»é¢ã‹ã‚‰ç¿»è¨³ãƒã‚¹ã‚¿ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ]
    A --> B[Excelã§ç¿»è¨³ã‚’ç·¨é›†ãƒ»è¿½åŠ ]
    B --> C[CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜]
    C --> D[ç®¡ç†ç”»é¢ã‹ã‚‰CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ]
    D --> E{ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³}
    E -->|ã‚¨ãƒ©ãƒ¼ã‚ã‚Š| F[ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º]
    F --> B
    E -->|OK| G[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ ]
    G --> H[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†èµ·å‹•ã¾ãŸã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢]
    H --> End([å®Œäº†])
    
    style Start fill:#e3f2fd
    style End fill:#c8e6c9
    style E fill:#fff9c4
    style G fill:#c8e6c9
```

**STEP 1: CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**
- ç®¡ç†ç”»é¢ã®ã€Œç¿»è¨³ãƒã‚¹ã‚¿ç®¡ç†ã€ã‹ã‚‰ã€ŒCSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
- ç¾åœ¨ã®ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

**STEP 2: Excelã§ç·¨é›†**
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVã‚’Excelã§é–‹ã
- ç¿»è¨³ã‚’ç·¨é›†ãƒ»è¿½åŠ ï¼ˆtranslation_keyã¯å¤‰æ›´ç¦æ­¢ï¼‰
- UTF-8å½¢å¼ã§ä¿å­˜

**STEP 3: CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ**
- ç®¡ç†ç”»é¢ã®ã€ŒCSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆé‡è¤‡ã‚­ãƒ¼ã€å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ï¼‰

**STEP 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ **
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸå¾Œã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¸€æ‹¬æ›´æ–°
- æ›´æ–°å±¥æ­´ã‚’ãƒ­ã‚°ã«è¨˜éŒ²

**STEP 5: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†èµ·å‹•**
- ç¿»è¨³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†èµ·å‹•ï¼ˆã¾ãŸã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼‰

#### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

ç¿»è¨³ãƒã‚¹ã‚¿CSVã‚’Gitã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

```bash
# Gitç®¡ç†ä¾‹
HarmoNet/
â””â”€â”€ translations/
    â”œâ”€â”€ translations_v1.0.csv
    â”œâ”€â”€ translations_v1.1.csv
    â””â”€â”€ translations_v1.2.csv
```

**å¤‰æ›´å±¥æ­´ã®è¨˜éŒ²**:
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å¤‰æ›´å†…å®¹ã‚’æ˜è¨˜
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµŒã¦æœ¬ç•ªç’°å¢ƒã«åæ˜ 

---

## 6.3 å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¤šè¨€èªå¯¾å¿œ

ç®¡ç†è€…æŠ•ç¨¿ã‚„æ²ç¤ºæ¿æŠ•ç¨¿ãªã©ã€å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã€Google Cloud Translation APIã‚’ä½¿ç”¨ã—ã¦ç¿»è¨³ã—ã¾ã™ã€‚

### 6.3.1 Google Cloud Translation API ã®åˆ©ç”¨

#### APIé¸å®šç†ç”±

HarmoNetã§ã¯ã€Google Cloud Translation API (Basic v2) ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

| è©•ä¾¡é …ç›® | è©•ä¾¡å†…å®¹ |
|---------|----------|
| **1. ã‚µãƒ¼ãƒ“ã‚¹ã®æŒç¶šæ€§** | Googleã®ä¸­æ ¸ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€ã¤ã¨ã—ã¦13å¹´ä»¥ä¸Šã®å®Ÿç¸¾ã€‚ã‚µãƒ¼ãƒ“ã‚¹çµ‚äº†ãƒªã‚¹ã‚¯ãŒæ¥µã‚ã¦ä½ã„ã€‚APIä»•æ§˜ãŒå®‰å®šã—ã¦ãŠã‚Šã€ç ´å£Šçš„å¤‰æ›´ãŒå°‘ãªã„ã€‚ |
| **2. ã‚³ã‚¹ãƒˆã®å„ªä½æ€§** | æœˆé–“50ä¸‡æ–‡å­—ã¾ã§ç„¡æ–™ã€‚ãƒãƒ³ã‚·ãƒ§ãƒ³è¦æ¨¡ã§ã®åˆ©ç”¨ï¼ˆæœˆ3.6ä¸‡æ–‡å­—æƒ³å®šï¼‰ã¯ç„¡æ–™æ å†…ã§é‹ç”¨å¯èƒ½ã€‚è¶…éæ™‚ã‚‚100ä¸‡æ–‡å­—ã‚ãŸã‚Š$20ï¼ˆç´„3,000å††ï¼‰ã¨ä½ã‚³ã‚¹ãƒˆã€‚ |
| **3. æŠ€è¡“çš„å„ªä½æ€§** | APIãŒéå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿè£…ãŒå®¹æ˜“ã€‚130è¨€èªä»¥ä¸Šã«å¯¾å¿œï¼ˆå°†æ¥ã®æ‹¡å¼µæ€§ï¼‰ã€‚é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ã€é«˜ã„ç¨¼åƒç‡ã€‚è±Šå¯Œãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨å®Ÿè£…äº‹ä¾‹ã€‚ |

**å‚ç…§**: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºç”¨_æ©Ÿèƒ½è¦ä»¶å®šç¾©æ›¸_v1_1.txt - 3.8.4 å¤šè¨€èªå¯¾å¿œ

#### APIä»•æ§˜ï¼ˆBasic v2ï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST https://translation.googleapis.com/language/translate/v2
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼**:
```http
Content-Type: application/json
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "q": "é§è»Šå ´ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ",
  "source": "ja",
  "target": "en",
  "format": "text"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "data": {
    "translations": [
      {
        "translatedText": "Your parking reservation has been completed",
        "detectedSourceLanguage": "ja"
      }
    ]
  }
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | ä¾‹ |
|-----------|------|-----|
| `q` | ç¿»è¨³å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ | "é§è»Šå ´ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ" |
| `source` | å…ƒè¨€èªã‚³ãƒ¼ãƒ‰ | "ja", "en", "zh-CN" |
| `target` | ç¿»è¨³å…ˆè¨€èªã‚³ãƒ¼ãƒ‰ | "en", "zh-CN", "ja" |
| `format` | ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ | "text" (ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ) / "html" |

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```json
{
  "error": {
    "code": 400,
    "message": "Invalid Value",
    "errors": [
      {
        "message": "Invalid Value",
        "domain": "global",
        "reason": "invalid"
      }
    ]
  }
}
```

### 6.3.2 ç®¡ç†è€…æŠ•ç¨¿æ™‚ã®ç¿»è¨³ãƒ•ãƒ­ãƒ¼

ç®¡ç†è€…ãŒãŠçŸ¥ã‚‰ã›ã‚„ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’æŠ•ç¨¿ã™ã‚‹éš›ã€æ—¥æœ¬èªã§å…¥åŠ›ã—ãŸå†…å®¹ã‚’è‡ªå‹•ç¿»è¨³ã—ã€3è¨€èªç‰ˆã‚’ä¸€æ‹¬ä¿å­˜ã—ã¾ã™ã€‚

```mermaid
flowchart TD
    Start([ç®¡ç†è€…ãŒæ—¥æœ¬èªã§æŠ•ç¨¿]) --> A[æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›]
    A --> B[ç¿»è¨³ãƒœã‚¿ãƒ³æŠ¼ä¸‹]
    B --> C[Google Translation APIå‘¼ã³å‡ºã—]
    C --> D[æ—¥æœ¬èªâ†’è‹±èª ç¿»è¨³]
    C --> E[æ—¥æœ¬èªâ†’ä¸­å›½èª ç¿»è¨³]
    D --> F[ç¿»è¨³çµæœã‚’è¡¨ç¤º]
    E --> F
    F --> G{ç¿»è¨³çµæœã‚’ç¢ºèª}
    G -->|ä¿®æ­£å¿…è¦| H[æ‰‹å‹•ã§ç¿»è¨³ã‚’ä¿®æ­£]
    G -->|OK| I[3è¨€èªç‰ˆã‚’ä¿å­˜]
    H --> I
    I --> J[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜]
    J --> K[å…¬é–‹å‡¦ç†]
    K --> End([å®Œäº†])
    
    style Start fill:#e3f2fd
    style End fill:#c8e6c9
    style C fill:#fff9c4
    style I fill:#c8e6c9
```

#### STEP 1: æ—¥æœ¬èªã§å…¥åŠ›

ç®¡ç†è€…ã¯ã€ãŠçŸ¥ã‚‰ã›æŠ•ç¨¿ç”»é¢ã§æ—¥æœ¬èªã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆã—ã¾ã™ã€‚

**å…¥åŠ›é …ç›®**:
- ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ50æ–‡å­—ä»¥å†…ï¼‰
- æœ¬æ–‡ï¼ˆ2000æ–‡å­—ä»¥å†…ï¼‰
- ã‚«ãƒ†ã‚´ãƒªé¸æŠ
- å…¬é–‹æ—¥æ™‚è¨­å®š

#### STEP 2: ã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹

ç”»é¢ä¸Šã®ã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Google Translation APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ç¿»è¨³ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
async function translateContent(japaneseText) {
  // è‹±èªç¿»è¨³
  const englishTranslation = await translateAPI({
    q: japaneseText,
    source: 'ja',
    target: 'en',
    format: 'text'
  });
  
  // ä¸­å›½èªç¿»è¨³
  const chineseTranslation = await translateAPI({
    q: japaneseText,
    source: 'ja',
    target: 'zh-CN',
    format: 'text'
  });
  
  return {
    ja: japaneseText,
    en: englishTranslation.data.translations[0].translatedText,
    cn: chineseTranslation.data.translations[0].translatedText
  };
}
```

#### STEP 3: ç¿»è¨³çµæœã‚’è¡¨ç¤º

APIã‹ã‚‰ã®ç¿»è¨³çµæœã‚’ç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚3è¨€èªã‚’ä¸¦ã¹ã¦è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã€ç®¡ç†è€…ãŒä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ã€‚

**ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥æœ¬èªï¼ˆåŸæ–‡ï¼‰                            â”‚
â”‚ é§è»Šå ´ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è‹±èªï¼ˆEnglishï¼‰                          â”‚
â”‚ Your parking reservation has been       â”‚
â”‚ completed                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸­å›½èªï¼ˆä¸­æ–‡ï¼‰                            â”‚
â”‚ æ‚¨çš„åœè½¦é¢„è®¢å·²å®Œæˆ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### STEP 4: ç¿»è¨³çµæœã‚’ç¢ºèªãƒ»ä¿®æ­£

è‡ªå‹•ç¿»è¨³ã®ç²¾åº¦ã‚’ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦æ‰‹å‹•ä¿®æ­£ã—ã¾ã™ã€‚

**ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**:
- å°‚é–€ç”¨èªã®æ­£ç¢ºæ€§ï¼ˆé§è»Šå ´ã€äºˆç´„ã€å®Œäº†ãªã©ï¼‰
- å›ºæœ‰åè©ã®ä¿æŒï¼ˆF1ã€B1ãªã©ï¼‰
- æ•¬èªãƒ»ä¸å¯§èªã®ãƒ¬ãƒ™ãƒ«
- æ–‡è„ˆã«å¿œã˜ãŸè¡¨ç¾

**ä¿®æ­£ä¾‹**:
- è‡ªå‹•ç¿»è¨³: "Parking lot reservation is done"
- ä¿®æ­£å¾Œ: "Your parking reservation has been completed"

#### STEP 5: 3è¨€èªç‰ˆã‚’ä¿å­˜

ç¿»è¨³çµæœã‚’ç¢ºèªå¾Œã€ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€3è¨€èªç‰ˆãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¸€æ‹¬ä¿å­˜ã•ã‚Œã¾ã™ã€‚

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜**:
```sql
INSERT INTO announcement_contents 
  (announcement_id, language, title, body, created_at)
VALUES
  (1, 'ja', 'é§è»Šå ´äºˆç´„å®Œäº†', 'é§è»Šå ´ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ', NOW()),
  (1, 'en', 'Parking Reservation Completed', 'Your parking reservation has been completed', NOW()),
  (1, 'zh-CN', 'åœè½¦é¢„è®¢å®Œæˆ', 'æ‚¨çš„åœè½¦é¢„è®¢å·²å®Œæˆ', NOW());
```

#### STEP 6: å…¬é–‹å‡¦ç†

ä¿å­˜å¾Œã€å…¬é–‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å…¨ä½æ°‘ã«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

**é€šçŸ¥é€ä¿¡**:
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆè¨­å®šONæ™‚ï¼‰
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆè¨­å®šONæ™‚ï¼‰
- ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ãƒãƒƒã‚¸æ›´æ–°

### 6.3.3 ä½æ°‘å´ã®æ²ç¤ºæ¿æŠ•ç¨¿ç¿»è¨³

ä½æ°‘ãŒè‡ªåˆ†ã¨ç•°ãªã‚‹è¨€èªã®æŠ•ç¨¿ã‚’é–²è¦§ã™ã‚‹éš›ã€ã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³ã§ç¿»è¨³çµæœã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã—ã¾ã™ã€‚

```mermaid
flowchart TD
    Start([ç•°è¨€èªã®æŠ•ç¨¿ã‚’é–²è¦§]) --> A[æŠ•ç¨¿è©³ç´°ç”»é¢ã‚’è¡¨ç¤º]
    A --> B[ç¿»è¨³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º]
    B --> C{ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¿»è¨³ãƒœã‚¿ãƒ³æŠ¼ä¸‹?}
    C -->|No| D[åŸæ–‡ã®ã¾ã¾è¡¨ç¤º]
    C -->|Yes| E[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèª]
    E --> F{ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Š?}
    F -->|Yes| G[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ç¿»è¨³ã‚’å–å¾—]
    F -->|No| H[Google Translation APIå‘¼ã³å‡ºã—]
    H --> I[ç¿»è¨³çµæœã‚’å–å¾—]
    I --> J[ç¿»è¨³çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜]
    J --> K[ç¿»è¨³çµæœã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤º]
    G --> K
    K --> End([å®Œäº†])
    
    style Start fill:#e3f2fd
    style End fill:#c8e6c9
    style H fill:#fff9c4
    style K fill:#c8e6c9
```

#### STEP 1: ç•°è¨€èªã®æŠ•ç¨¿ã‚’é–²è¦§

æ²ç¤ºæ¿ã§è‡ªåˆ†ã¨ç•°ãªã‚‹è¨€èªã®æŠ•ç¨¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

**ä¾‹**:
- æ—¥æœ¬äººä½æ°‘ãŒè‹±èªã®æŠ•ç¨¿ã‚’é–²è¦§
- ä¸­å›½äººä½æ°‘ãŒæ—¥æœ¬èªã®æŠ•ç¨¿ã‚’é–²è¦§

**ç”»é¢è¡¨ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŠ•ç¨¿è€…: John Smith                       â”‚
â”‚ æŠ•ç¨¿æ—¥: 2025-10-15 14:30               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ I found a lost key near the entrance.   â”‚
â”‚ Please contact me if it's yours.        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç¿»è¨³] [è¿”ä¿¡]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### STEP 2: ã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹

æŠ•ç¨¿ã®ä¸‹éƒ¨ã«è¡¨ç¤ºã•ã‚ŒãŸã€Œç¿»è¨³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

**ãƒœã‚¿ãƒ³è¡¨ç¤ºæ¡ä»¶**:
- æŠ•ç¨¿è¨€èª â‰  ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨€èªè¨­å®š
- ä¾‹: è‹±èªæŠ•ç¨¿ã‚’æ—¥æœ¬èªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–²è¦§ â†’ ç¿»è¨³ãƒœã‚¿ãƒ³è¡¨ç¤º

#### STEP 3: ç¿»è¨³å‡¦ç†

ã¾ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¢ºèªã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã‘ã‚Œã°Google Translation APIã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ç”Ÿæˆ**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
function generateCacheKey(text, sourceLang, targetLang) {
  const hash = sha256(text); // SHA-256ãƒãƒƒã‚·ãƒ¥
  return `translation:${sourceLang}:${targetLang}:${hash}`;
}

// ä¾‹: translation:en:ja:a1b2c3d4e5f6...
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ç¿»è¨³å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å„ªå…ˆï¼‰
async function getTranslation(text, sourceLang, targetLang) {
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
  const cacheKey = generateCacheKey(text, sourceLang, targetLang);
  const cached = await redis.get(cacheKey);
  
  if (cached) {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
    return JSON.parse(cached);
  }
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ â†’ APIå‘¼ã³å‡ºã—
  const translation = await translateAPI({
    q: text,
    source: sourceLang,
    target: targetLang,
    format: 'text'
  });
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ï¼ˆTTL: 7æ—¥é–“ï¼‰
  await redis.set(cacheKey, JSON.stringify(translation), 'EX', 604800);
  
  return translation;
}
```

#### STEP 4: ç¿»è¨³çµæœã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤º

åŸæ–‡ã®ä¸‹ã«ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚èƒŒæ™¯è‰²ã‚’å¤‰ãˆã¦åŒºåˆ¥ã—ã¾ã™ã€‚

**ç”»é¢è¡¨ç¤ºï¼ˆç¿»è¨³å¾Œï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŠ•ç¨¿è€…: John Smith                       â”‚
â”‚ æŠ•ç¨¿æ—¥: 2025-10-15 14:30               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ I found a lost key near the entrance.   â”‚
â”‚ Please contact me if it's yours.        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç¿»è¨³æ¸ˆã¿]                               â”‚
â”‚ ç„é–¢è¿‘ãã§éµã‚’æ‹¾ã„ã¾ã—ãŸã€‚               â”‚
â”‚ ãŠå¿ƒå½“ãŸã‚Šã®ã‚ã‚‹æ–¹ã¯ã”é€£çµ¡ãã ã•ã„ã€‚     â”‚
â”‚ [åŸæ–‡ã‚’è¡¨ç¤º] [è¿”ä¿¡]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CSSä¾‹**:
```css
.translated-text {
  background-color: #f5f5f5;
  padding: 12px;
  border-left: 4px solid #3B82F6;
  margin-top: 12px;
  border-radius: 4px;
}
```

#### STEP 5: ç¿»è¨³çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥

ç¿»è¨³çµæœã‚’Redisã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã€åŒã˜æŠ•ç¨¿ã®å†ç¿»è¨³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‰Šæ¸›ã—ã¾ã™ã€‚

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»•æ§˜**:
- **ã‚­ãƒ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `translation:{source_lang}:{target_lang}:{hash}`
- **TTL**: 7æ—¥é–“ï¼ˆ604,800ç§’ï¼‰
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ç›®æ¨™**: 70%ä»¥ä¸Š

### 6.3.4 ç¿»è¨³ã®æœ€é©åŒ–

ã‚³ã‚¹ãƒˆå‰Šæ¸›ã¨å¿œç­”é€Ÿåº¦å‘ä¸Šã®ãŸã‚ã€è¤‡æ•°ã®æœ€é©åŒ–æ–½ç­–ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### ç¿»è¨³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆå†ç¿»è¨³é˜²æ­¢ï¼‰

**ç›®çš„**: åŒã˜ãƒ†ã‚­ã‚¹ãƒˆã®å†ç¿»è¨³ã‚’é˜²æ­¢

**å®Ÿè£…æ–¹å¼**: Redisã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
class TranslationCache {
  constructor(redis) {
    this.redis = redis;
    this.ttl = 604800; // 7æ—¥é–“
  }
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
  generateKey(text, sourceLang, targetLang) {
    const hash = crypto.createHash('sha256').update(text).digest('hex');
    return `translation:${sourceLang}:${targetLang}:${hash}`;
  }
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—
  async get(text, sourceLang, targetLang) {
    const key = this.generateKey(text, sourceLang, targetLang);
    const cached = await this.redis.get(key);
    return cached ? JSON.parse(cached) : null;
  }
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
  async set(text, sourceLang, targetLang, translation) {
    const key = this.generateKey(text, sourceLang, targetLang);
    await this.redis.set(key, JSON.stringify(translation), 'EX', this.ttl);
  }
}
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã®è¨ˆæ¸¬**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡
class CacheMetrics {
  constructor() {
    this.hits = 0;
    this.misses = 0;
  }
  
  recordHit() {
    this.hits++;
  }
  
  recordMiss() {
    this.misses++;
  }
  
  getHitRate() {
    const total = this.hits + this.misses;
    return total > 0 ? (this.hits / total) * 100 : 0;
  }
}
```

#### å·®åˆ†ç¿»è¨³ï¼ˆå¤‰æ›´éƒ¨åˆ†ã®ã¿ï¼‰

**ç›®çš„**: ãŠçŸ¥ã‚‰ã›ç·¨é›†æ™‚ã€å¤‰æ›´éƒ¨åˆ†ã®ã¿ç¿»è¨³

**å®Ÿè£…æ–¹å¼**: ãƒ†ã‚­ã‚¹ãƒˆå·®åˆ†æ¤œå‡º + éƒ¨åˆ†ç¿»è¨³

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: å·®åˆ†ç¿»è¨³
async function translateDiff(oldText, newText, sourceLang, targetLang) {
  // ãƒ†ã‚­ã‚¹ãƒˆå·®åˆ†ã‚’æ¤œå‡º
  const diff = calculateDiff(oldText, newText);
  
  // å¤‰æ›´ã•ã‚ŒãŸéƒ¨åˆ†ã®ã¿ç¿»è¨³
  const changedParts = diff.filter(part => part.added || part.removed);
  
  if (changedParts.length === 0) {
    // å¤‰æ›´ãªã— â†’ æ—¢å­˜ç¿»è¨³ã‚’è¿”ã™
    return await getExistingTranslation(oldText, sourceLang, targetLang);
  }
  
  // å¤‰æ›´éƒ¨åˆ†ã®ã¿ç¿»è¨³
  const translatedParts = await Promise.all(
    changedParts.map(part => translateAPI({
      q: part.value,
      source: sourceLang,
      target: targetLang
    }))
  );
  
  // ç¿»è¨³çµæœã‚’ãƒãƒ¼ã‚¸
  return mergeDiff(diff, translatedParts);
}
```

#### ãƒãƒƒãƒå‡¦ç†ï¼ˆã¾ã¨ã‚ã¦ç¿»è¨³ï¼‰

**ç›®çš„**: è¤‡æ•°ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸€åº¦ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ç¿»è¨³

**å®Ÿè£…æ–¹å¼**: Google Translation APIã®ãƒãƒƒãƒç¿»è¨³æ©Ÿèƒ½

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ãƒãƒƒãƒç¿»è¨³
async function translateBatch(texts, sourceLang, targetLang) {
  // æœ€å¤§100ä»¶ã¾ã§ä¸€æ‹¬ç¿»è¨³
  const batchSize = 100;
  const batches = chunkArray(texts, batchSize);
  
  const results = await Promise.all(
    batches.map(batch => translateAPI({
      q: batch, // é…åˆ—ã§è¤‡æ•°ãƒ†ã‚­ã‚¹ãƒˆã‚’é€ä¿¡
      source: sourceLang,
      target: targetLang,
      format: 'text'
    }))
  );
  
  return results.flat();
}
```

**é©ç”¨ä¾‹**:
- ãŠçŸ¥ã‚‰ã›ä¸€è¦§ç”»é¢: 10ä»¶ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä¸€æ‹¬ç¿»è¨³
- æ²ç¤ºæ¿ä¸€è¦§ç”»é¢: 20ä»¶ã®æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä¸€æ‹¬ç¿»è¨³

#### ä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

**ç›®çš„**: ç„¡æ–™æ è¶…éã‚’é˜²æ­¢

**å®Ÿè£…æ–¹å¼**: ä½¿ç”¨é‡ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ + ã‚¢ãƒ©ãƒ¼ãƒˆ

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
class TranslationUsageMonitor {
  constructor() {
    this.monthlyLimit = 500000; // ç„¡æ–™æ : 50ä¸‡æ–‡å­—
    this.alertThreshold = 0.8; // ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤: 80%
  }
  
  // ä½¿ç”¨é‡è¨˜éŒ²
  async recordUsage(characterCount) {
    const currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
    const key = `translation_usage:${currentMonth}`;
    
    await redis.incrBy(key, characterCount);
    
    // ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
    const totalUsage = await redis.get(key);
    if (totalUsage > this.monthlyLimit * this.alertThreshold) {
      await this.sendAlert(totalUsage);
    }
  }
  
  // ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
  async sendAlert(usage) {
    const usagePercent = (usage / this.monthlyLimit) * 100;
    await sendEmail({
      to: 'admin@harmonet.example.com',
      subject: '[HarmoNet] ç¿»è¨³APIä½¿ç”¨é‡ã‚¢ãƒ©ãƒ¼ãƒˆ',
      body: `ç¿»è¨³APIä½¿ç”¨é‡ãŒ${usagePercent.toFixed(1)}%ã«é”ã—ã¾ã—ãŸã€‚`
    });
  }
  
  // æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
  async getMonthlyReport() {
    const currentMonth = new Date().toISOString().slice(0, 7);
    const key = `translation_usage:${currentMonth}`;
    const usage = await redis.get(key) || 0;
    
    return {
      month: currentMonth,
      usage: parseInt(usage),
      limit: this.monthlyLimit,
      usagePercent: (usage / this.monthlyLimit) * 100
    };
  }
}
```

**ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**:
- 80%åˆ°é”: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
- 90%åˆ°é”: ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ + ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆ
- 95%åˆ°é”: ç¿»è¨³æ©Ÿèƒ½ã‚’ä¸€æ™‚åˆ¶é™ï¼ˆç®¡ç†è€…ã®ã¿ä½¿ç”¨å¯èƒ½ï¼‰

---

## 6.4 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å¤šè¨€èªå¯¾å¿œ

ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã«å¿œã˜ã¦é©åˆ‡ãªè¨€èªã§é€ä¿¡ã•ã‚Œã¾ã™ã€‚

### 6.4.1 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®ç¨®é¡

HarmoNetã§ã¯ã€ä»¥ä¸‹ã®ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™ã€‚

#### äºˆç´„å®Œäº†é€šçŸ¥

**é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: äºˆç´„å®Œäº†æ™‚ï¼ˆå³æ™‚ï¼‰

**ä»¶å**:
- æ—¥æœ¬èª: `[HarmoNet] é§è»Šå ´äºˆç´„å®Œäº†ã®ãŠçŸ¥ã‚‰ã›`
- è‹±èª: `[HarmoNet] Parking Reservation Confirmation`
- ä¸­å›½èª: `[HarmoNet] åœè½¦é¢„è®¢ç¡®è®¤`

**æœ¬æ–‡å†…å®¹**:
- äºˆç´„æ—¥æ™‚
- é§è»Šå ´æ‰€ï¼ˆF1ã€œF6, B1ã€œB6ï¼‰
- åˆ©ç”¨æ–™é‡‘ï¼ˆ100å††ï¼‰
- è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼ï¼ˆä»»æ„ï¼‰
- æ³¨æ„äº‹é …ï¼ˆåˆ©ç”¨æ™‚é–“ã€è»Šé«˜åˆ¶é™ï¼‰
- å•ã„åˆã‚ã›å…ˆ

#### äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥

**é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ï¼ˆå³æ™‚ï¼‰

**ä»¶å**:
- æ—¥æœ¬èª: `[HarmoNet] é§è»Šå ´äºˆç´„ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«ã¤ã„ã¦`
- è‹±èª: `[HarmoNet] Parking Reservation Cancellation`
- ä¸­å›½èª: `[HarmoNet] åœè½¦é¢„è®¢å–æ¶ˆ`

**æœ¬æ–‡å†…å®¹**:
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸäºˆç´„ã®è©³ç´°
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ—¥æ™‚
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±ï¼ˆä»»æ„ï¼‰
- å•ã„åˆã‚ã›å…ˆ

#### ä»£ç†äºˆç´„å®Œäº†é€šçŸ¥

**é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ç®¡ç†è€…ãŒä»£ç†äºˆç´„ã‚’å®Œäº†æ™‚ï¼ˆå³æ™‚ï¼‰

**ä»¶å**:
- æ—¥æœ¬èª: `[HarmoNet] é§è»Šå ´äºˆç´„å®Œäº†ã®ãŠçŸ¥ã‚‰ã›ï¼ˆç®¡ç†è€…ä»£ç†äºˆç´„ï¼‰`
- è‹±èª: `[HarmoNet] Parking Reservation Confirmation (Admin Booking)`
- ä¸­å›½èª: `[HarmoNet] åœè½¦é¢„è®¢ç¡®è®¤ï¼ˆç®¡ç†å‘˜ä»£ç†é¢„è®¢ï¼‰`

**æœ¬æ–‡å†…å®¹**:
- äºˆç´„æ—¥æ™‚
- é§è»Šå ´æ‰€
- äºˆç´„è€…ï¼ˆç®¡ç†è€…åï¼‰
- æ³¨æ„äº‹é …
- å•ã„åˆã‚ã›å…ˆ

#### ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼é€šçŸ¥ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

**é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: äºˆç´„æ—¥ã®å‰æ—¥20:00

**ä»¶å**:
- æ—¥æœ¬èª: `[HarmoNet] é§è»Šå ´äºˆç´„ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼`
- è‹±èª: `[HarmoNet] Parking Reservation Reminder`
- ä¸­å›½èª: `[HarmoNet] åœè½¦é¢„è®¢æé†’`

**æœ¬æ–‡å†…å®¹**:
- äºˆç´„æ—¥æ™‚ï¼ˆç¿Œæ—¥ï¼‰
- é§è»Šå ´æ‰€
- æ³¨æ„äº‹é …
- å•ã„åˆã‚ã›å…ˆ

### 6.4.2 ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤šè¨€èªåŒ–

ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Handlebarså½¢å¼ã§ä½œæˆã—ã€3è¨€èªç‰ˆã‚’ç®¡ç†ã—ã¾ã™ã€‚

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³: Handlebars

Handlebarsã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤‰æ•°ã®åŸ‹ã‚è¾¼ã¿ã¨æ¡ä»¶åˆ†å²ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã¾ã™ã€‚

**æ—¥æœ¬èªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** (`booking_confirmation_ja.hbs`):

```handlebars
{{user_name}}æ§˜

é§è»Šå ´ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

ã€äºˆç´„å†…å®¹ã€‘
äºˆç´„æ—¥: {{booking_date}}
é§è»Šå ´æ‰€: {{space_id}}
è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼: {{vehicle_number}}
åˆ©ç”¨æ–™é‡‘: {{fee}}å††

æ³¨æ„äº‹é …:
- åˆ©ç”¨æ™‚é–“: 0:00ã€œ23:59
- è»Šé«˜åˆ¶é™: 2.1mä»¥ä¸‹
- äºˆç´„ã®å¤‰æ›´ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯å‰æ—¥ã¾ã§ã«ãŠé¡˜ã„ã„ãŸã—ã¾ã™

ãŠå•ã„åˆã‚ã›:
ç®¡ç†çµ„åˆäº‹å‹™æ‰€
é›»è©±: 03-xxxx-xxxx
ãƒ¡ãƒ¼ãƒ«: info@harmonet.example.com

HarmoNet
```

**è‹±èªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** (`booking_confirmation_en.hbs`):

```handlebars
Dear {{user_name}},

Your parking reservation has been completed.

ã€Reservation Detailsã€‘
Date: {{booking_date}}
Parking Space: {{space_id}}
Vehicle Number: {{vehicle_number}}
Fee: {{fee}} yen

Notes:
- Operating Hours: 0:00-23:59
- Height Limit: 2.1m or less
- Please cancel or modify your reservation by the day before

Contact:
Management Office
Phone: 03-xxxx-xxxx
Email: info@harmonet.example.com

HarmoNet
```

**ä¸­å›½èªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** (`booking_confirmation_cn.hbs`):

```handlebars
{{user_name}} æ‚¨å¥½ï¼Œ

æ‚¨çš„åœè½¦é¢„è®¢å·²å®Œæˆã€‚

ã€é¢„è®¢è¯¦æƒ…ã€‘
æ—¥æœŸ: {{booking_date}}
åœè½¦ä½: {{space_id}}
è½¦è¾†å·ç : {{vehicle_number}}
è´¹ç”¨: {{fee}}æ—¥å…ƒ

æ³¨æ„äº‹é¡¹:
- ä½¿ç”¨æ—¶é—´: 0:00ã€œ23:59
- è½¦é«˜é™åˆ¶: 2.1ç±³ä»¥ä¸‹
- è¯·åœ¨å‰ä¸€å¤©å‰å–æ¶ˆæˆ–ä¿®æ”¹é¢„è®¢

è”ç³»æ–¹å¼:
ç®¡ç†ç»„åˆäº‹åŠ¡æ‰€
ç”µè¯: 03-xxxx-xxxx
é‚®ç®±: info@harmonet.example.com

HarmoNet
```

#### å¤‰æ•°ä¸€è¦§

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| `{{user_name}}` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å | å±±ç”°å¤ªéƒ, John Smith, å¼ ä¸‰ |
| `{{booking_date}}` | äºˆç´„æ—¥ | 2025-11-15 |
| `{{space_id}}` | é§è»Šå ´æ‰€ | F1, B3 |
| `{{vehicle_number}}` | è»Šä¸¡ãƒŠãƒ³ãƒãƒ¼ | 1234, N/A |
| `{{fee}}` | åˆ©ç”¨æ–™é‡‘ | 100 |

### 6.4.3 ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†

ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯ã€SendGridã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¾ã™ã€‚

#### é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¤ãƒ™ãƒ³ãƒˆ | é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚° | é€ä¿¡å…ˆ |
|---------|--------------|--------|
| äºˆç´„å®Œäº† | å³æ™‚é€ä¿¡ | äºˆç´„è€… |
| äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ« | å³æ™‚é€ä¿¡ | äºˆç´„è€… |
| ä»£ç†äºˆç´„å®Œäº† | å³æ™‚é€ä¿¡ | äºˆç´„å¯¾è±¡è€… |
| ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ | äºˆç´„æ—¥ã®å‰æ—¥20:00 | äºˆç´„è€… |

#### é€ä¿¡ãƒ•ãƒ­ãƒ¼

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†
async function sendBookingConfirmationEmail(booking, user) {
  // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã‚’å–å¾—
  const userLanguage = user.language_preference; // 'ja', 'en', 'zh'
  
  // 2. è¨€èªã«å¿œã˜ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
  const template = await loadEmailTemplate('booking_confirmation', userLanguage);
  
  // 3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã¿
  const emailContent = template.render({
    user_name: user.name,
    booking_date: formatDate(booking.booking_date, userLanguage),
    space_id: booking.space_id,
    vehicle_number: booking.vehicle_number || 'N/A',
    fee: booking.fee
  });
  
  // 4. ãƒ¡ãƒ¼ãƒ«é€ä¿¡
  await sendEmail({
    to: user.email,
    subject: getSubject('booking_confirmation', userLanguage),
    body: emailContent
  });
  
  // 5. é€ä¿¡ãƒ­ã‚°è¨˜éŒ²
  await logEmailSent({
    user_id: user.user_id,
    email_type: 'booking_confirmation',
    language: userLanguage,
    sent_at: new Date()
  });
}
```

#### æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã«å¿œã˜ã¦ã€æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
function formatDate(date, language) {
  const d = new Date(date);
  
  switch (language) {
    case 'ja':
      return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
    case 'en':
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
      return `${monthNames[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
    case 'zh':
      return `${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
    default:
      return d.toISOString().split('T')[0]; // YYYY-MM-DD
  }
}
```

**ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹**:
- æ—¥æœ¬èª: `2025å¹´11æœˆ15æ—¥`
- è‹±èª: `November 15, 2025`
- ä¸­å›½èª: `2025å¹´11æœˆ15æ—¥`

---

## 6.5 è¨€èªåˆ‡æ›¿æ©Ÿèƒ½

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚¢ãƒ—ãƒªå†…ã§ä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### 6.5.1 è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ã®å®Ÿè£…

#### ãƒ˜ãƒƒãƒ€ãƒ¼å³ä¸Šã«é…ç½®

è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ã¯ã€å…¨ç”»é¢å…±é€šã®ãƒ˜ãƒƒãƒ€ãƒ¼å³ä¸Šã«é…ç½®ã—ã¾ã™ã€‚

**è¡¨ç¤ºå½¢å¼**:
- ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«: `JA` / `EN` / `CN`
- é¸æŠä¸­ã®è¨€èªã¯é’è‰²ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- ã‚¯ãƒªãƒƒã‚¯ã§è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

**HTMLä¾‹**:
```html
<header class="header">
  <div class="header__logo">HarmoNet</div>
  <div class="header__actions">
    <button class="header__notification-button">ğŸ””</button>
    <button class="header__language-button" id="languageButton">
      <span class="language-button__current">JA</span>
    </button>
  </div>
</header>
```

**CSSä¾‹**:
```css
.header__language-button {
  padding: 8px 16px;
  background-color: #E3F2FD;
  color: #1976D2;
  border: 1px solid #1976D2;
  border-radius: 4px;
  cursor: pointer;
}

.header__language-button:hover {
  background-color: #BBDEFB;
}
```

#### è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°

ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ¢ãƒ¼ãƒ€ãƒ«å½¢å¼ã®è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

**ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ§‹æˆ**:
```html
<div class="language-dialog" id="languageDialog">
  <div class="language-dialog__overlay"></div>
  <div class="language-dialog__content">
    <h3>è¨€èªé¸æŠ / Language / è¯­è¨€é€‰æ‹©</h3>
    <ul class="language-list">
      <li class="language-list__item" data-lang="ja">
        ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (Japanese)
      </li>
      <li class="language-list__item" data-lang="en">
        ğŸ‡ºğŸ‡¸ English (è‹±èª)
      </li>
      <li class="language-list__item" data-lang="zh">
        ğŸ‡¨ğŸ‡³ ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰(ä¸­å›½èª)
      </li>
    </ul>
    <button class="language-dialog__close">é–‰ã˜ã‚‹ / Close / å…³é—­</button>
  </div>
</div>
```

### 6.5.2 è¨€èªåˆ‡æ›¿ã®å‹•ä½œãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨€èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯]) --> A[è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º]
    A --> B[è¨€èªã‚’é¸æŠ]
    B --> C[é¸æŠè¨€èªã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜]
    C --> D[ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜]
    D --> E[ç”»é¢å…¨ä½“ã‚’å†æç”»]
    E --> F[é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç¿»è¨³]
    E --> G[å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç¿»è¨³]
    F --> H[ç¿»è¨³å®Œäº†]
    G --> H
    H --> End([å®Œäº†])
    
    style Start fill:#e3f2fd
    style End fill:#c8e6c9
    style C fill:#fff9c4
    style E fill:#fff9c4
```

#### STEP 1: è¨€èªãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—

ãƒ˜ãƒƒãƒ€ãƒ¼å³ä¸Šã®è¨€èªãƒœã‚¿ãƒ³ï¼ˆJA/EN/CNï¼‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™ã€‚

#### STEP 2: è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è¨€èªé¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

**è¡¨ç¤ºå†…å®¹**:
- æ—¥æœ¬èª (Japanese)
- English (è‹±èª)
- ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰(ä¸­å›½èª)

#### STEP 3: è¨€èªã‚’é¸æŠ

å¸Œæœ›ã®è¨€èªã‚’é¸æŠã—ã€ã€Œç¢ºå®šã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

**JavaScriptä¾‹**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: è¨€èªé¸æŠå‡¦ç†
document.querySelectorAll('.language-list__item').forEach(item => {
  item.addEventListener('click', async (e) => {
    const selectedLang = e.target.dataset.lang;
    
    // é¸æŠè¨€èªã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    document.querySelectorAll('.language-list__item').forEach(el => {
      el.classList.remove('language-list__item--selected');
    });
    e.target.classList.add('language-list__item--selected');
    
    // è¨€èªåˆ‡æ›¿å‡¦ç†
    await switchLanguage(selectedLang);
  });
});
```

#### STEP 4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ã¾ã™ã€‚

**SQLä¾‹**:
```sql
UPDATE users
SET language_preference = $1,
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = $2;

-- $1: 'ja' / 'en' / 'zh'
-- $2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
```

#### STEP 5: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜

ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«è¨€èªè¨­å®šã‚’ä¿å­˜ã—ã¾ã™ã€‚æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«è‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

**JavaScriptä¾‹**:
```javascript
// è¨€èªè¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
localStorage.setItem('user_language', 'ja'); // 'ja', 'en', 'zh'

// è¨€èªè¨­å®šã‚’å–å¾—
const userLanguage = localStorage.getItem('user_language') || 'ja';
```

#### STEP 6: ç”»é¢å…¨ä½“ã‚’å†æç”»

ç¾åœ¨è¡¨ç¤ºä¸­ã®ç”»é¢ã‚’é¸æŠè¨€èªã§å†æç”»ã—ã¾ã™ã€‚

**å‡¦ç†å†…å®¹**:
- é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: ç¿»è¨³ãƒã‚¹ã‚¿ã‹ã‚‰å–å¾—
- å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è©²å½“è¨€èªç‰ˆã‚’å–å¾—

**JavaScriptä¾‹**:
```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ç”»é¢å†æç”»
async function switchLanguage(newLanguage) {
  // 1. è¨€èªè¨­å®šã‚’ä¿å­˜
  await updateUserLanguage(newLanguage);
  localStorage.setItem('user_language', newLanguage);
  
  // 2. ç¿»è¨³ãƒã‚¹ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
  await loadTranslations(newLanguage);
  
  // 3. ç”»é¢ã‚’å†æç”»
  await reloadCurrentPage();
}
```

### 6.5.3 è¨€èªè¨­å®šã®ä¿å­˜

è¨€èªè¨­å®šã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ä¸¡æ–¹ã«ä¿å­˜ã—ã¾ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

**ãƒ†ãƒ¼ãƒ–ãƒ«**: `users`

**SQLä¾‹**:
```sql
UPDATE users
SET language_preference = $1,
    updated_at = CURRENT_TIMESTAMP
WHERE user_id = $2;

-- $1: 'ja' / 'en' / 'zh'
-- $2: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
```

**è¨€èªè¨­å®šã®å–å¾—**:
```sql
SELECT language_preference
FROM users
WHERE user_id = $1;
```

#### ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

**JavaScriptä¾‹**:
```javascript
// è¨€èªè¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
localStorage.setItem('user_language', 'ja'); // 'ja', 'en', 'zh'

// è¨€èªè¨­å®šã‚’å–å¾—
const userLanguage = localStorage.getItem('user_language') || 'ja';

// åˆå›èµ·å‹•æ™‚ã®è¨€èªåˆ¤å®š
function detectInitialLanguage() {
  // 1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç¢ºèª
  const stored = localStorage.getItem('user_language');
  if (stored) return stored;
  
  // 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆï¼‰
  const dbLanguage = await getUserLanguage();
  if (dbLanguage) return dbLanguage;
  
  // 3. ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨€èªè¨­å®šã‹ã‚‰åˆ¤å®š
  const browserLang = navigator.language.toLowerCase();
  if (browserLang.startsWith('ja')) return 'ja';
  if (browserLang.startsWith('zh')) return 'zh';
  return 'en'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è‹±èª
}
```

---

## 6.6 é€šçŸ¥æ©Ÿèƒ½

HarmoNetã§ã¯ã€ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã€ã‚¢ãƒ—ãƒªå†…é€šçŸ¥ã®3ç¨®é¡ã®é€šçŸ¥æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### 6.6.1 é€šçŸ¥ã®ç¨®é¡

#### ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆFirebase Cloud Messagingï¼‰

**å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ**:
- ãŠçŸ¥ã‚‰ã›å…¬é–‹æ™‚
- äºˆç´„å®Œäº†æ™‚
- äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆäºˆç´„æ—¥å‰æ—¥ï¼‰

**é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **:
- iOSï¼ˆAPNsçµŒç”±ï¼‰
- Androidï¼ˆFCMçµŒç”±ï¼‰
- Webï¼ˆãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ï¼‰

#### ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆSendGrid / Amazon SESï¼‰

**å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ**:
- ãŠçŸ¥ã‚‰ã›å…¬é–‹æ™‚
- äºˆç´„å®Œäº†æ™‚
- äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚
- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆäºˆç´„æ—¥å‰æ—¥ï¼‰
- ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯é€ä¿¡ï¼ˆèªè¨¼ç”¨ï¼‰

#### ã‚¢ãƒ—ãƒªå†…é€šçŸ¥

**è¡¨ç¤ºæ–¹æ³•**:
- é€šçŸ¥ä¸€è¦§ç”»é¢ã§ç¢ºèª
- ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã«æœªèª­ãƒãƒƒã‚¸è¡¨ç¤º
- ã‚¿ãƒƒãƒ—ã§è©³ç´°ç”»é¢ã¸é·ç§»

### 6.6.2 é€šçŸ¥è¨­å®š

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€å—ã‘å–ã‚‹é€šçŸ¥ã‚’æ©Ÿèƒ½åˆ¥ã«åˆ¶å¾¡ã§ãã¾ã™ã€‚

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®é€šçŸ¥è¨­å®š

**åŸºæœ¬è¨­å®š**:
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥: ON/OFFï¼ˆå…¨ä½“ï¼‰
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥: ON/OFFï¼ˆå…¨ä½“ï¼‰

**æ©Ÿèƒ½åˆ¥è¨­å®š**:
- ãŠçŸ¥ã‚‰ã›: ON/OFF
- æ²ç¤ºæ¿: ON/OFF
- æ–½è¨­äºˆç´„: ON/OFF
- ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼: ON/OFF

**ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ **:
```sql
CREATE TABLE notification_settings (
  user_id INTEGER PRIMARY KEY REFERENCES users(user_id),
  push_enabled BOOLEAN DEFAULT TRUE,
  email_enabled BOOLEAN DEFAULT TRUE,
  push_announcement BOOLEAN DEFAULT TRUE,
  push_board BOOLEAN DEFAULT TRUE,
  push_booking BOOLEAN DEFAULT TRUE,
  push_reminder BOOLEAN DEFAULT TRUE,
  email_announcement BOOLEAN DEFAULT TRUE,
  email_board BOOLEAN DEFAULT TRUE,
  email_booking BOOLEAN DEFAULT TRUE,
  email_reminder BOOLEAN DEFAULT TRUE,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.6.3 ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…

Firebase Cloud Messagingã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### é€ä¿¡ãƒ•ãƒ­ãƒ¼

1. **äºˆç´„å®Œäº†æ™‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§FCMã«é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
2. **FCMãŒå„ãƒ‡ãƒã‚¤ã‚¹ã«ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’é…ä¿¡**
3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’ã‚¿ãƒƒãƒ—**
4. **ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã€è©²å½“ç”»é¢ã«é·ç§»**

#### é€šçŸ¥ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰

```json
{
  "notification": {
    "title": "é§è»Šå ´äºˆç´„å®Œäº†",
    "body": "2025-11-15 F1ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ"
  },
  "data": {
    "type": "booking_confirmation",
    "booking_id": "bk_a1b2c3d4",
    "screen": "booking_detail"
  }
}
```

#### é€ä¿¡å‡¦ç†

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: FCMãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é€ä¿¡
async function sendPushNotification(user, notificationType, data) {
  // é€šçŸ¥è¨­å®šã‚’ç¢ºèª
  const settings = await getNotificationSettings(user.user_id);
  if (!settings.push_enabled || !settings[`push_${notificationType}`]) {
    return; // é€šçŸ¥OFFã®å ´åˆã¯é€ä¿¡ã—ãªã„
  }
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒã‚¤ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
  const deviceTokens = await getDeviceTokens(user.user_id);
  
  // è¨€èªã«å¿œã˜ãŸé€šçŸ¥ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
  const message = await getNotificationMessage(notificationType, user.language_preference, data);
  
  // FCMã«é€ä¿¡
  const fcmMessage = {
    notification: {
      title: message.title,
      body: message.body
    },
    data: {
      type: notificationType,
      ...data
    },
    tokens: deviceTokens
  };
  
  await fcm.sendMulticast(fcmMessage);
}
```

### 6.6.4 ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®å®Ÿè£…

SendGridã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### é€ä¿¡API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
```
POST https://api.sendgrid.com/v3/mail/send
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼**:
```http
Authorization: Bearer YOUR_API_KEY
Content-Type: application/json
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£**:
```json
{
  "personalizations": [
    {
      "to": [{"email": "user@example.com"}],
      "subject": "[HarmoNet] é§è»Šå ´äºˆç´„å®Œäº†ã®ãŠçŸ¥ã‚‰ã›"
    }
  ],
  "from": {"email": "noreply@harmonet.example.com"},
  "content": [
    {
      "type": "text/html",
      "value": "<html>...</html>"
    }
  ]
}
```

#### é€ä¿¡å‡¦ç†

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: SendGridãƒ¡ãƒ¼ãƒ«é€ä¿¡
async function sendEmailNotification(user, emailType, data) {
  // é€šçŸ¥è¨­å®šã‚’ç¢ºèª
  const settings = await getNotificationSettings(user.user_id);
  if (!settings.email_enabled || !settings[`email_${emailType}`]) {
    return; // é€šçŸ¥OFFã®å ´åˆã¯é€ä¿¡ã—ãªã„
  }
  
  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  const template = await loadEmailTemplate(emailType, user.language_preference);
  const emailContent = template.render(data);
  
  // SendGridã«é€ä¿¡
  const message = {
    personalizations: [
      {
        to: [{ email: user.email }],
        subject: getEmailSubject(emailType, user.language_preference)
      }
    ],
    from: { email: 'noreply@harmonet.example.com' },
    content: [
      {
        type: 'text/html',
        value: emailContent
      }
    ]
  };
  
  await sendgrid.send(message);
  
  // é€ä¿¡ãƒ­ã‚°è¨˜éŒ²
  await logEmailSent({
    user_id: user.user_id,
    email_type: emailType,
    language: user.language_preference,
    sent_at: new Date()
  });
}
```

---

## 6.7 ç¿»è¨³å“è³ªã®å‘ä¸Š

è‡ªå‹•ç¿»è¨³ã®å“è³ªã‚’é«˜ã‚ã‚‹ãŸã‚ã€è¤‡æ•°ã®æ–½ç­–ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### 6.7.1 ç¿»è¨³ç²¾åº¦ã®æ¤œè¨¼

#### æ‰‹å‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼

ç®¡ç†è€…æŠ•ç¨¿æ™‚ã€ç¿»è¨³çµæœã‚’ç¢ºèªãƒ»ä¿®æ­£ã§ãã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¾ã™ã€‚

**ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹**:
1. Google Translation APIã§è‡ªå‹•ç¿»è¨³
2. ç¿»è¨³çµæœã‚’ç”»é¢ã«è¡¨ç¤º
3. ç®¡ç†è€…ãŒç¢ºèªãƒ»ä¿®æ­£
4. 3è¨€èªç‰ˆã‚’ä¿å­˜

**ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**:
- å°‚é–€ç”¨èªã®æ­£ç¢ºæ€§
- å›ºæœ‰åè©ã®ä¿æŒ
- æ•¬èªãƒ»ä¸å¯§èªã®ãƒ¬ãƒ™ãƒ«
- æ–‡è„ˆã«å¿œã˜ãŸè¡¨ç¾

#### æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹å“è³ªå‘ä¸Šï¼ˆå°†æ¥å®Ÿè£…ï¼‰

GPT-4ç­‰ã®é«˜ç²¾åº¦ç¿»è¨³ãƒ¢ãƒ‡ãƒ«ã‚’æ´»ç”¨ã—ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ãŸç¿»è¨³ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

**å®Ÿè£…æ¡ˆ**:
- Google Translation APIã®ä»£ã‚ã‚Šã«GPT-4 APIã‚’ä½¿ç”¨
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å°‚é–€ç”¨èªè¾æ›¸ã‚’å‚ç…§
- ç¿»è¨³å±¥æ­´ã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ´»ç”¨

### 6.7.2 å›ºæœ‰åè©ã®å–ã‚Šæ‰±ã„

é§è»Šå ´æ‰€åï¼ˆF1ã€œF6, B1ã€œB6ï¼‰ãªã©ã®å›ºæœ‰åè©ã¯ã€ç¿»è¨³ã›ãšãã®ã¾ã¾ä¿æŒã—ã¾ã™ã€‚

#### å›ºæœ‰åè©è¾æ›¸ã®ä½œæˆ

**è¾æ›¸ãƒ‡ãƒ¼ã‚¿**:
```javascript
const properNouns = [
  'F1', 'F2', 'F3', 'F4', 'F5', 'F6',
  'B1', 'B2', 'B3', 'B4', 'B5', 'B6',
  'HarmoNet',
  'ã‚»ã‚­ãƒ¥ãƒ¬ã‚¢ã‚·ãƒ†ã‚£',
  'SECUREA City'
];
```

#### ç¿»è¨³å‰å‡¦ç†

å›ºæœ‰åè©ã‚’ä¸€æ™‚çš„ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç½®æ›ã—ã¦ã‹ã‚‰ç¿»è¨³ã—ã¾ã™ã€‚

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: å›ºæœ‰åè©ã®ä¿è­·
function preprocessText(text) {
  // å›ºæœ‰åè©ã‚’ä¸€æ™‚çš„ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç½®æ›
  const placeholders = [];
  const protectedTerms = ['F1', 'F2', 'F3', 'F4', 'F5', 'F6', 
                          'B1', 'B2', 'B3', 'B4', 'B5', 'B6'];
  
  let processedText = text;
  protectedTerms.forEach((term, index) => {
    const placeholder = `__PLACEHOLDER_${index}__`;
    processedText = processedText.replace(new RegExp(term, 'g'), placeholder);
    placeholders.push({ placeholder, term });
  });
  
  return { processedText, placeholders };
}

// ç¿»è¨³å¾Œå‡¦ç†
function postprocessText(translatedText, placeholders) {
  let finalText = translatedText;
  placeholders.forEach(({ placeholder, term }) => {
    finalText = finalText.replace(new RegExp(placeholder, 'g'), term);
  });
  return finalText;
}

// ä½¿ç”¨ä¾‹
async function translateWithProperNouns(text, sourceLang, targetLang) {
  // å‰å‡¦ç†: å›ºæœ‰åè©ã‚’ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç½®æ›
  const { processedText, placeholders } = preprocessText(text);
  
  // ç¿»è¨³å®Ÿè¡Œ
  const translated = await translateAPI({
    q: processedText,
    source: sourceLang,
    target: targetLang
  });
  
  // å¾Œå‡¦ç†: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å…ƒã«æˆ»ã™
  const finalText = postprocessText(translated.data.translations[0].translatedText, placeholders);
  
  return finalText;
}
```

**å®Ÿè¡Œä¾‹**:
```javascript
// å…¥åŠ›: "F1ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ"
// å‰å‡¦ç†: "__PLACEHOLDER_0__ã®äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ"
// ç¿»è¨³: "Reservation for __PLACEHOLDER_0__ has been completed"
// å¾Œå‡¦ç†: "Reservation for F1 has been completed"
```

---

## 6.8 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

ç¿»è¨³ã‚„ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®å¤±æ•—æ™‚ã«é©åˆ‡ã«å¯¾å¿œã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æãªã‚ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

### 6.8.1 ç¿»è¨³å¤±æ•—æ™‚ã®å¯¾å¿œ

#### Google Translation API ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | ã‚¨ãƒ©ãƒ¼å†…å®¹ | å¯¾å¿œæ–¹æ³• |
|------------|-----------|---------|
| `429 Too Many Requests` | ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é | ã‚¨ã‚¯ã‚¹ãƒãƒãƒ³ã‚·ãƒ£ãƒ«ãƒãƒƒã‚¯ã‚ªãƒ•ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§3å›ï¼‰ |
| `403 Forbidden` | API ã‚­ãƒ¼ç„¡åŠ¹ | ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²ã€ç®¡ç†è€…ã¸ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡ |
| `500 Internal Server Error` | APIå´ã‚¨ãƒ©ãƒ¼ | ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€å¤§3å›ï¼‰ã€å¤±æ•—æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ãƒªãƒˆãƒ©ã‚¤å‡¦ç†
async function translateWithRetry(text, sourceLang, targetLang, maxRetries = 3) {
  let retries = 0;
  let delay = 1000; // åˆå›1ç§’
  
  while (retries < maxRetries) {
    try {
      const result = await translateAPI({
        q: text,
        source: sourceLang,
        target: targetLang
      });
      return result.data.translations[0].translatedText;
      
    } catch (error) {
      retries++;
      
      if (error.status === 429) {
        // ãƒ¬ãƒ¼ãƒˆåˆ¶é™: ã‚¨ã‚¯ã‚¹ãƒãƒãƒ³ã‚·ãƒ£ãƒ«ãƒãƒƒã‚¯ã‚ªãƒ•
        await sleep(delay);
        delay *= 2; // 2å€ãšã¤é…å»¶
        
      } else if (error.status === 403) {
        // API ã‚­ãƒ¼ç„¡åŠ¹: ç®¡ç†è€…ã¸ã‚¢ãƒ©ãƒ¼ãƒˆ
        await sendAlert('Translation API key is invalid');
        throw error;
        
      } else if (error.status >= 500) {
        // ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤
        await sleep(delay);
        
      } else {
        // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤ã›ãšä¾‹å¤–ã‚¹ãƒ­ãƒ¼
        throw error;
      }
    }
  }
  
  // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°è¶…é
  throw new Error('Translation failed after maximum retries');
}
```

#### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

ç¿»è¨³å¤±æ•—æ™‚ã¯åŸæ–‡ã‚’è¡¨ç¤ºã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
async function getTranslationOrFallback(text, sourceLang, targetLang) {
  try {
    return await translateWithRetry(text, sourceLang, targetLang);
  } catch (error) {
    // ç¿»è¨³å¤±æ•—: åŸæ–‡ã‚’è¿”ã™
    console.error('Translation failed:', error);
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    showErrorMessage('ç¿»è¨³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    
    return text; // åŸæ–‡ã‚’è¿”ã™
  }
}
```

### 6.8.2 ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã®å¯¾å¿œ

#### SendGrid ã‚¨ãƒ©ãƒ¼

ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã¯ã€é€ä¿¡ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜ã—ã¦å¾Œã§å†é€ä¿¡ã—ã¾ã™ã€‚

**å†é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯**:
1. é€ä¿¡å¤±æ•—æ™‚ã€é€ä¿¡ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜
2. 5åˆ†å¾Œã«å†é€ä¿¡ï¼ˆæœ€å¤§3å›ï¼‰
3. 3å›å¤±æ•—ã—ãŸå ´åˆã¯ç®¡ç†è€…ã¸ã‚¢ãƒ©ãƒ¼ãƒˆ

#### é€ä¿¡ã‚­ãƒ¥ãƒ¼ã®å®Ÿè£…

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚­ãƒ¥ãƒ¼
class EmailQueue {
  async add(emailData) {
    await db.insert('email_queue', {
      user_id: emailData.user_id,
      email_type: emailData.email_type,
      to_email: emailData.to_email,
      subject: emailData.subject,
      body: emailData.body,
      retry_count: 0,
      status: 'pending',
      created_at: new Date()
    });
  }
  
  async process() {
    // é€ä¿¡å¾…ã¡ã®ãƒ¡ãƒ¼ãƒ«ã‚’å–å¾—
    const emails = await db.query(`
      SELECT * FROM email_queue
      WHERE status = 'pending'
      AND retry_count < 3
      ORDER BY created_at ASC
      LIMIT 10
    `);
    
    for (const email of emails) {
      try {
        // ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        await sendgrid.send({
          to: email.to_email,
          subject: email.subject,
          html: email.body
        });
        
        // é€ä¿¡æˆåŠŸ: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        await db.update('email_queue', {
          status: 'sent',
          sent_at: new Date()
        }, { id: email.id });
        
      } catch (error) {
        // é€ä¿¡å¤±æ•—: ãƒªãƒˆãƒ©ã‚¤ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
        await db.update('email_queue', {
          retry_count: email.retry_count + 1,
          last_error: error.message
        }, { id: email.id });
        
        // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°åˆ°é”
        if (email.retry_count + 1 >= 3) {
          await db.update('email_queue', {
            status: 'failed'
          }, { id: email.id });
          
          // ç®¡ç†è€…ã¸ã‚¢ãƒ©ãƒ¼ãƒˆ
          await sendAlert(`Email failed after 3 retries: ${email.id}`);
        }
      }
    }
  }
}

// 5åˆ†ã”ã¨ã«é€ä¿¡ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†
setInterval(() => {
  emailQueue.process();
}, 5 * 60 * 1000);
```

#### ãƒ­ã‚°è¨˜éŒ²

ã™ã¹ã¦ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’è¨˜éŒ²ã—ã€é€ä¿¡çŠ¶æ³ã‚’è¿½è·¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

**ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ **:
```sql
CREATE TABLE email_logs (
  log_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id INTEGER NOT NULL REFERENCES users(user_id),
  email_type VARCHAR(50) NOT NULL,
  language VARCHAR(10) NOT NULL,
  to_email VARCHAR(255) NOT NULL,
  subject TEXT,
  status VARCHAR(20) NOT NULL,  -- 'sent', 'failed', 'pending'
  error_message TEXT,
  retry_count INTEGER DEFAULT 0,
  sent_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_email_logs_user_id (user_id),
  INDEX idx_email_logs_status (status),
  INDEX idx_email_logs_created_at (created_at)
);
```

**ãƒ­ã‚°ã‚¯ã‚¨ãƒªä¾‹**:
```sql
-- ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€ä¿¡å±¥æ­´
SELECT * FROM email_logs
WHERE user_id = $1
ORDER BY created_at DESC
LIMIT 20;

-- é€ä¿¡å¤±æ•—ä¸€è¦§
SELECT * FROM email_logs
WHERE status = 'failed'
ORDER BY created_at DESC;

-- æ—¥åˆ¥é€ä¿¡æ•°
SELECT DATE(created_at) AS date, COUNT(*) AS count
FROM email_logs
WHERE status = 'sent'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

---

## ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

- [â¬…ï¸ å‰ã®ç« : Chapter 05 - ç®¡ç†æ©Ÿèƒ½](facility-booking-feature-design-ch05_v1.0.md)
- [â¡ï¸ æ¬¡ã®ç« : Chapter 07 - å°†æ¥æ‹¡å¼µãƒ»è£œè¶³](facility-booking-feature-design-ch07_v1.0.md)
- [ğŸ“š ç›®æ¬¡ã«æˆ»ã‚‹](facility-booking-feature-design-ch00-index_v1.0.md)

---

**æ–‡æ›¸ç®¡ç†æƒ…å ±**

| é …ç›® | å†…å®¹ |
|------|------|
| æ–‡æ›¸ID | HARMONET-FACILITY-BOOKING-DESIGN-001-CH06 |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | v1.0 |
| ä½œæˆæ—¥ | 2025å¹´10æœˆ29æ—¥ |
| æœ€çµ‚æ›´æ–° | 2025å¹´10æœˆ29æ—¥ |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | æ‰¿èªå¾…ã¡ |
| ä½œæˆè€… | HarmoNeté–‹ç™ºãƒãƒ¼ãƒ  |
| æ‰¿èªè€… | ï¼ˆæœªæ‰¿èªï¼‰ |

**å¤‰æ›´å±¥æ­´**

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | å¤‰æ›´è€… |
|-----------|------|----------|--------|
| v1.0 | 2025-10-29 | åˆç‰ˆä½œæˆ | HarmoNeté–‹ç™ºãƒãƒ¼ãƒ  |

---

Â© 2025 HarmoNet Project. All rights reserved.
