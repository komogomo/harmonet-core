# 第6章: 主要機能

**掲示板機能 詳細設計書 v2.0**

[← 第5章](board-feature-design-ch05.md) | [目次に戻る](board-feature-design-ch00-index.md) | [第7章へ →](board-feature-design-ch07.md)

---

## 6.1 投稿機能

### 6.1.1 投稿フォーム仕様

投稿フォームの詳細は「第5章 新規投稿画面」を参照してください。

**入力項目の概要**

| 項目 | 必須 | 制限 |
|------|------|------|
| カテゴリ | 必須 | ドロップダウンから1つ選択 |
| タイトル | 必須 | 最大50文字 |
| 本文 | 必須 | 最大2000文字 |
| 添付ファイル | 任意 | 最大5ファイル、合計10MB |

---

### 6.1.2 投稿時の自動設定項目

投稿ボタン押下時、以下の項目が自動的に設定されます。

| 項目 | 設定内容 |
|------|---------|
| **投稿者** | ログインユーザーの情報（ニックネーム or 実名） |
| **投稿日時** | 投稿ボタン押下時のタイムスタンプ |
| **掲示板タイプ** | カテゴリから自動判定（全体 / グループ / 回覧板） |
| **返信可能フラグ** | 回覧板の場合は自動的に「返信不可」 |

---

### 6.1.3 投稿の編集・削除

#### 編集

**対象**

自分の投稿のみ

**編集可能項目**

- タイトル
- 本文
- 添付ファイル

**編集不可項目**

- カテゴリ（投稿後は変更不可）

**編集履歴**

投稿が編集された場合、「編集済み」マークを表示します。

```
田中さん • 10/27 10:00（編集済み）
```

**Phase 2での拡張**

編集履歴の詳細を表示する機能を追加予定

---

#### 削除

**対象**

自分の投稿のみ

**確認ダイアログ**

削除前に確認ダイアログを表示します。

```
本当に削除しますか？

削除した投稿は元に戻せません。
コメントは残りますが、本文は「この投稿は削除されました」と表示されます。

[キャンセル] [削除する]
```

**削除後の表示**

投稿データは論理削除（物理削除はしない）され、以下のように表示されます。

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
この投稿は削除されました

（コメントは引き続き表示されます）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**コメントの扱い**

投稿を削除しても、既存のコメントは残ります。

---

#### 管理者による削除

**対象**

管理者は全ての投稿を削除可能

**削除理由の入力**

管理者が投稿を削除する場合、削除理由を入力します。

```
削除理由を入力してください

[誹謗中傷]
[スパム・宣伝]
[個人情報の漏洩]
[差別的な表現]
[その他]

補足説明:
┌─────────────────────────────┐
│                             │
└─────────────────────────────┘

[キャンセル] [削除する]
```

**投稿者への通知**

削除後、投稿者に通知を送信します。

```
あなたの投稿が削除されました

削除理由: 誹謗中傷
補足説明: 特定の個人を攻撃する内容が含まれていたため、削除しました。

削除日時: 2025/10/27 15:00
```

---

### 6.1.4 投稿時のAI自動処理

投稿ボタン押下後、AIが自動的に内容をチェックします。

#### 処理の流れ

```
投稿ボタン押下
  ↓
[投稿内容を確認中...] 表示（0.5秒）
  ↓
AI自動判定（3段階）
  ↓
レベル1: ブロック → エラー表示、修正を促す
レベル2: 変換提案 → 変換後の文章を表示、選択可能
レベル3: OK → 即座に投稿完了
```

---

#### レベル1: 即座にブロック（投稿不可）

以下の内容を含む投稿は即座にブロックされ、投稿できません。

**ブロック対象**

1. 誹謗中傷・暴言・差別表現
2. 人種・民族・国籍差別
3. 性別・年齢による差別
4. 個人特定情報
5. 個人情報
6. 性的・暴力的表現
7. NGワード（管理者が設定）

**ブロック時の表示**

```
❌ 投稿できませんでした

理由：
・部屋番号が含まれています
・攻撃的な表現が含まれています

内容を修正してから再度投稿してください。

[ 内容を修正する ]
```

---

#### レベル2: 自動変換提案

攻撃的だが改善可能な表現を、自動的に適切な表現に変換して提案します。

**変換対象**

1. 攻撃的だが改善可能な表現
2. 無意識の差別的表現（本人は差別の意図なし）
3. 感情的な表現
4. 個人特定につながる情報（暗示的）

**変換提案の表示**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 より適切な表現に変換しました

【元の文章】
夜中にうるさい外国人がいて迷惑です

【変換後の文章】
夜間に生活音が聞こえて困っています。
住民の皆さんに配慮をお願いしたいです。

[変換後の文章で投稿] [元の文章に戻す]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**選択肢**

- **変換後の文章で投稿**: 変換後の文章で投稿
- **元の文章に戻す**: 元の文章を編集して再投稿

---

#### レベル3: OK（即座に投稿完了）

問題なし。即座に投稿完了します。

```
✅ 投稿しました

投稿詳細画面へ移動します...
```

---

#### モデレーション機能の詳細

> **📄 詳細は別紙参照**
> 
> AI自動モデレーション機能の詳細設計については、以下の別紙を参照してください:
> - 『**AI自動モデレーション設計書**』（作成予定）

---

## 6.2 コメント機能

### 6.2.1 コメント仕様

#### 基本仕様

| 項目 | 仕様 |
|------|------|
| **階層** | 1階層のみ（投稿に対するコメントのみ、コメントへの返信は不可） |
| **文字数制限** | 最大500文字 |
| **添付ファイル** | コメントには添付不可（MVP） |
| **投稿者表示** | ニックネーム表示 |

**1階層のみとする理由**

- 複雑な議論を避け、シンプルに保つ
- スレッドが深くなりすぎるのを防ぐ
- スマートフォンでの閲覧性を優先

---

#### 表示順

**投稿日時の昇順（古いコメントが上）**

最初のコメントが上、最新のコメントが下に表示されます。

**Phase 2での拡張**

以下のソート機能を追加予定:

- 新着順
- いいね順（リアクション機能実装後）

---

### 6.2.2 コメントの編集・削除

#### 編集

**対象**

自分のコメントのみ編集可能

**編集可能項目**

- コメント本文

**編集履歴**

コメントが編集された場合、「編集済み」マークを表示します。

```
田中さん • 10/27 11:00（編集済み）
```

---

#### 削除

**対象**

自分のコメントのみ削除可能

**確認ダイアログ**

```
コメントを削除しますか？

削除したコメントは元に戻せません。

[キャンセル] [削除する]
```

**削除後の表示**

コメントは論理削除され、以下のように表示されます。

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
このコメントは削除されました
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

#### 管理者権限

**管理者は全てのコメントを削除可能**

投稿と同様、削除理由を入力し、コメント投稿者に通知します。

---

### 6.2.3 返信不可投稿の扱い

回覧板など、返信不可に設定された投稿では、コメント入力欄が表示されません。

**表示内容**

```
この投稿には返信できません
```

- グレーの背景
- 中央揃えのテキスト

---

## 6.3 添付ファイル機能

### 6.3.1 対応ファイル形式

| ファイル種類 | 対応形式 | MVP機能 |
|-------------|---------|---------|
| **画像** | JPEG, PNG, GIF, WebP | プレビュー表示、拡大表示 |
| **PDF** | PDF | ダウンロードのみ（プレビューはPhase 2） |
| **Office** | Word (.docx), Excel (.xlsx), PowerPoint (.pptx) | ダウンロードのみ |

---

### 6.3.2 ファイルサイズ制限

#### 一般住民

| 項目 | 制限 |
|------|------|
| **1ファイルあたり** | 最大5MB |
| **1投稿あたり** | 最大5ファイル、合計10MB |

#### 管理者

| 項目 | 制限 |
|------|------|
| **1ファイルあたり** | 最大10MB |
| **1投稿あたり** | 最大10ファイル、合計20MB |

**管理者の制限緩和の理由**

管理組合からの公式通知では、総会資料や工事図面など、大容量ファイルを添付する必要があるため、制限を緩和します。

---

#### 制限超過時のエラーメッセージ

```
❌ ファイルサイズは5MB以下にしてください
❌ 添付ファイルは最大5個までです
❌ 合計ファイルサイズは10MB以下にしてください
```

---

### 6.3.3 画像プレビュー機能

#### 一覧画面での表示

投稿カードに添付画像の1枚目をサムネイル表示します。

**複数枚ある場合**

```
┌─────┐
│     │  +3
│ 画像 │
│     │
└─────┘
```

「+3」のようなバッジを表示します。

---

#### 詳細画面での表示

画像は横スクロールで全て表示します。

```
┌─────┐ ┌─────┐ ┌─────┐
│     │ │     │ │     │
│ 画像1│ │ 画像2│ │ 画像3│
│     │ │     │ │     │
└─────┘ └─────┘ └─────┘
```

**タップ動作**

タップでライトボックス（全画面表示）を開きます。

**ライトボックスの機能**

- 画像を全画面表示
- ピンチイン・アウトで拡大縮小
- スワイプで次の画像へ移動
- 「×」ボタンで閉じる

---

### 6.3.4 PDF・Officeファイルの扱い

#### 表示方法

ファイル名とアイコンを表示します。

```
┌─────────────────────────┐
│ 📄 総会資料.pdf         │
│ [ダウンロード]          │
└─────────────────────────┘
```

**ファイルアイコン**

- PDF: 📄
- Word: 📝
- Excel: 📊
- PowerPoint: 📊

---

#### ダウンロード

タップでダウンロードを開始します。

**ダウンロード先**

- スマートフォン: デバイスのダウンロードフォルダ
- PC: ブラウザのデフォルトダウンロードフォルダ

---

#### プレビュー機能（Phase 2）

Phase 2でブラウザ内プレビュー機能を追加予定です。

- PDFビューアー統合
- Officeファイルのプレビュー（Microsoft Office Online統合）

---

### 6.3.5 権限別の添付制御

| ユーザー種別 | 添付可能ファイル | 制限 |
|-------------|----------------|------|
| **一般住民** | 画像、PDF | 最大5ファイル、合計10MB |
| **管理者** | 画像、PDF、Office | 最大10ファイル、合計20MB |

---

## まとめ

第6章では、投稿機能、コメント機能、添付ファイル機能の詳細仕様を定義しました。

**重要なポイント**

- 投稿時にAI自動モデレーションで3段階判定（ブロック/変換提案/OK）
- 投稿・コメントの編集・削除は本人のみ可能（管理者は全て可能）
- コメントは1階層のみでシンプルに保つ
- 画像はプレビュー表示、PDF・Officeはダウンロード
- 管理者は添付ファイル制限を緩和

---

[← 第5章](board-feature-design-ch05.md) | [目次に戻る](board-feature-design-ch00-index.md) | [第7章へ →](board-feature-design-ch07.md)

---

**Document ID:** SEC-APP-BOARD-DESIGN-002-CH06  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-27
