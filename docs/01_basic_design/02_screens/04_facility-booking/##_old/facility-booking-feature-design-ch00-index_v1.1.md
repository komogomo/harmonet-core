# 施設予約機能 詳細設計書 - 目次

**HarmoNet スマートコミュニケーションアプリ**

**文書ID**: HARMONET-FACILITY-BOOKING-DESIGN-001  
**バージョン**: v1.1  
**最終更新**: 2025年10月29日  
**ステータス**: 承認待ち

---

## 📝 改訂履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|---------|--------|
| v1.0 | 2025-10-29 | 初版作成 | TKD + Claude |
| v1.1 | 2025-10-29 | Phase詳細追加、時間単位予約拡張、駐車場UI詳細化、テナント管理追加 | TKD + Claude |

---

## 📚 文書構成

本設計書は以下の章で構成されています。各章は独立したマークダウンファイルとして管理され、必要に応じて個別に参照・更新が可能です。

### Chapter 00: 目次・概要（本ファイル）
**ファイル名**: `facility-booking-feature-design-ch00-index_v1_1.md`

- 文書構成
- 改訂履歴
- 各章へのリンク
- 読み方ガイド

---

### Chapter 01: 概要・MVP機能セット
**ファイル名**: `facility-booking-feature-design-ch01_v1_1.md`

#### 主要トピック
- 1.1 目的と背景
- 1.2 基本方針
  - 共通予約構造の設計思想
  - ルール定義層での差異吸収
  - UI統一の考え方
- 1.3 MVP機能セット（ゲスト駐車場）
  - MVP実装範囲
  - MVP除外機能
- 1.4 将来実装機能
  - Phase 2: 集会室・ゲストルーム
    - 集会室予約（時間単位、承認フロー必須）
    - ゲストルーム予約（宿泊単位、承認フロー必須）
    - 時間単位予約対応（30分/1時間刻み、タイムスロット表示）
    - 終日予約オプション（管理者設定により有効/無効）
    - 承認フロー実装（申請→承認→通知）
  - Phase 3: 会議室・シアタールーム・ポイント・決済
    - 会議室予約（小規模打ち合わせ、即時確定）
    - シアタールーム予約（ホームシアター設備）
    - ラウンジ・ワークスペース（コワーキングスペース）
    - ポイント連携機能（予約・利用でポイント付与）
    - 決済機能（クレジットカード、電子マネー等）
  - Phase 4: EV充電器・IoT連携・AI活用
    - EV充電器予約（電力使用量に応じた実費請求）
    - IoT連携（スマートロック自動解錠）
    - HEMS連携（エネルギー管理）
    - AI予測機能（混雑予測、おすすめ提案）
    - コミュニティ機能連携（掲示板連携、イベント企画）
- 1.5 対象施設の分類
  - 室内系施設
  - 宿泊・駐車系施設
  - 共用スペース系施設
  - 機能設備系施設

---

### Chapter 02: 施設構造・データモデル
**ファイル名**: `facility-booking-feature-design-ch02_v1_1.md`

#### 主要トピック
- 2.1 データモデル設計思想
  - 施設間の差異をルール層で吸収
  - スキーマ変更なしの施設追加
- 2.2 facility_master（施設マスタ）
  - テーブル構造
  - カラム定義
  - is_activeによる有効/無効管理
  - テナントIDによる所属管理
- 2.3 facility_rule（施設ルール定義）
  - テーブル構造
  - カラム定義
  - ルール項目詳細
  - 時間単位予約設定（最大予約可能時間、終日オプション）
- 2.4 reservation（予約データ）
  - テーブル構造
  - カラム定義
  - ステータス管理
- 2.5 facility_i18n（多言語対応）
  - テーブル構造
  - 対応言語
- 2.6 reservation_meta（拡張データ）
  - JSONB構造
  - 将来拡張への対応
- 2.7 ER図
- 2.8 テナント単位の施設管理
  - テナントごとの施設マスタ設定
  - 施設カテゴリ分類
  - 施設の有効/無効管理
  - テナント間で施設構成が異なる前提
- 2.9 駐車場レイアウト管理
  - レイアウトMAP画像の管理
  - 駐車場番号リストの定義
  - 駐車場番号と表示順序の設定

---

### Chapter 03: 予約フロー・画面構成
**ファイル名**: `facility-booking-feature-design-ch03_v1_1.md`

#### 主要トピック
- 3.1 共通予約フロー概要
  - 施設選択 → カレンダー選択 → 予約入力 → 確認 → 完了
  - 即時確定 vs 承認待ち
- 3.2 施設選択画面（NEW）
  - 施設カテゴリプルダウン
  - テナント所有施設のみ表示
  - 施設詳細プレビュー
  - アクティブ施設のみ表示
- 3.3 カレンダー選択画面
  - 月表示カレンダー
  - 空き状況の色分け
  - 日付選択UI
- 3.4 施設詳細・空き状況画面
  - 一般施設の場合
    - 施設情報表示
    - 時間帯別空き状況
    - 終日予約チェックボックス（管理者設定により表示/非表示）
    - 予約可能枠の表示
  - 駐車場の場合（特殊UI）
    - 駐車場MAP表示
      - 静的画像、駐車場番号を表示
      - テナントごとにMAP画像を設定可能
    - 行カレンダー表示
      - テーブル構造
        - 固定列: 日付、曜日
        - スクロール列: 駐車場予約状況
      - 1行 = 1日
      - 駐車場予約状況列の表示
        - 駐車場番号（F1, F2, ...）と状態を色で表示
        - 色分け: 緑（空き）、赤（予約済み）、青（自分の予約）、グレー（予約不可）
        - 横スクロール可能
      - 縦スクロール: 日付を探す
      - セルタップで予約選択または詳細表示
    - 凡例表示（色の意味）
- 3.5 予約入力画面
  - 日時選択
  - 利用人数入力
  - 用途入力
  - 追加情報入力（施設による）
- 3.6 予約確認画面
  - 予約内容確認
  - 料金表示（該当施設）
  - ポイント消費確認（将来）
- 3.7 予約完了画面
  - 完了メッセージ
  - 予約詳細表示
  - 次のアクション案内
- 3.8 画面遷移図
- 3.9 レスポンシブ対応

---

### Chapter 04: 予約制限ルール・検証
**ファイル名**: `facility-booking-feature-design-ch04_v1_1.md`

#### 主要トピック
- 4.1 予約単位制御
  - 時間単位予約（Phase 2以降）
    - 30分刻み、管理者設定可能
    - 最大予約可能時間の設定（30分単位、施設ごとに設定可能）
  - 終日予約オプション（Phase 2以降）
    - 管理者設定により有効/無効
    - 終日チェックボックスの表示制御
  - 日単位予約（MVP）
  - コマ単位予約（将来）
- 4.2 予約制限ルール
  - 最大予約日数制限
    - 同時に予約できる日数の上限
    - 管理者画面で設定可能
    - デフォルト: 3日
  - 連続予約制限　←　**連続予約は機能として提供しない**
  - 同時予約数制限　←　**管理者画面で最大予約日数を設定可能とする**
  - 予約可能期間　←　**翌月末までを予約可能とする**
- 4.3 重複予約防止
  - 排他制御の実装
  - トランザクション管理
  - 同時アクセス対策
- 4.4 キャンセルポリシー
  - キャンセル可能期限
  - キャンセル手数料（将来）
  - ペナルティルール（将来）
- 4.5 バリデーション仕様
  - 入力値検証
  - ビジネスルール検証
  - エラーメッセージ定義
- 4.6 承認フロー（Phase 2以降）
  - 承認が必要な施設
  - 承認プロセス
  - 承認通知

---

### Chapter 05: 管理機能
**ファイル名**: `facility-booking-feature-design-ch05_v1_1.md`

#### 主要トピック
- 5.1 施設マスタ管理
  - 施設の登録・編集・削除
  - 施設情報の設定
  - 画像登録
  - 有効/無効切り替え
  - テナント単位での施設管理
  - 駐車場の場合: MAP画像アップロード、駐車場番号リストの登録・編集
- 5.2 施設ルール管理
  - ルールの登録・編集
  - ルールテンプレート
  - 施設タイプ別デフォルトルール
  - 時間単位予約設定
    - 最大予約可能時間（30分単位で設定）
    - 終日予約チェックボックス表示設定
  - テナント単位での施設有効/無効管理
- 5.3 予約状況確認
  - カレンダービュー
  - リストビュー
  - 予約詳細表示
  - フィルタ・検索機能
- 5.4 代理予約機能
  - 管理者による代理予約
  - 住民情報の選択
  - 代理予約の記録
- 5.5 予約ブロック設定
  - メンテナンス期間の設定
  - 特定施設の利用停止
  - ブロック理由の記録
- 5.6 利用統計レポート
  - 稼働率分析
  - 人気施設ランキング
  - ユーザー別利用履歴
  - CSVエクスポート
- 5.7 多言語コンテンツ管理
  - 施設名・説明文の翻訳管理
  - Google Translation API連携
  - 翻訳レビュー機能
- 5.8 駐車場レイアウト管理
  - レイアウト画像アップロード（PNG/JPG、推奨サイズ: 800x400px）
  - 駐車場番号リスト設定
  - 表示順序の設定
  - 各駐車場の有効/無効設定

---

### Chapter 06: 多言語対応・通知機能
**ファイル名**: `facility-booking-feature-design-ch06_v1_1.md`

#### 主要トピック
- 6.1 多言語対応の設計
  - facility_i18nテーブル構造
  - 対応言語（日本語・英語・中国語）
  - 翻訳フロー
- 6.2 施設名・説明文の翻訳
  - 管理者による翻訳入力
  - Google Translation API活用
  - 翻訳品質管理
- 6.3 予約通知機能
  - 予約完了通知
  - 予約変更通知
  - キャンセル通知
  - リマインダー通知
- 6.4 メール通知仕様
  - メールテンプレート
  - 送信タイミング
  - 多言語メール
- 6.5 プッシュ通知仕様
  - 通知内容
  - 通知タイミング
  - 通知設定管理
- 6.6 通知設定のカスタマイズ
  - ユーザー別通知設定
  - 通知ON/OFF
  - 通知方法選択

---

### Chapter 07: 将来拡張・補足
**ファイル名**: `facility-booking-feature-design-ch07_v1_1.md`

#### 主要トピック
- 7.1 時間単位予約への対応
  - タイムスロット管理（30分刻み）
  - 終日予約オプション
  - 最大予約可能時間の管理者設定
  - UI変更点
- 7.2 ポイント・料金連携
  - ポイント消費機能
  - 料金計算ロジック
  - 決済連携（将来）
- 7.3 IoT連携
  - スマートロック連携
  - 入退室管理
  - 利用状況モニタリング
- 7.4 エネルギー管理連携
  - HEMS連携
  - 電力使用量記録
  - エコポイント付与
- 7.5 コミュニティ機能連携
  - イベント予約との連携
  - グループ予約機能
  - 共同利用機能
- 7.6 AI活用
  - 予約混雑予測
  - おすすめ施設提案
  - 自動リマインダー最適化
- 7.7 技術実装詳細への参照
  - データベース詳細設計
  - API設計
  - インフラ構成
- 7.8 制約事項
- 7.9 既知の課題

---

## 📖 読み方ガイド

### 対象読者別の推奨章

#### プロジェクトマネージャー・プロダクトオーナー
- **必読**: Chapter 01（概要・MVP）
- **推奨**: Chapter 03（画面構成）、Chapter 05（管理機能）
- **参考**: Chapter 04（ルール）、Chapter 07（将来拡張）

#### UI/UXデザイナー
- **必読**: Chapter 03（画面構成）
- **推奨**: Chapter 01（概要）、Chapter 06（多言語・通知）
- **参考**: Chapter 04（バリデーション）

#### バックエンドエンジニア
- **必読**: Chapter 02（データモデル）、Chapter 04（ルール・検証）
- **推奨**: Chapter 05（管理機能）、Chapter 06（通知）
- **参考**: Chapter 07（将来拡張）

#### フロントエンドエンジニア
- **必読**: Chapter 03（画面構成）
- **推奨**: Chapter 04（バリデーション）、Chapter 06（多言語）
- **参考**: Chapter 02（データモデル）

#### QAエンジニア・テスター
- **必読**: Chapter 04（ルール・検証）
- **推奨**: Chapter 03（画面構成）、Chapter 05（管理機能）
- **参考**: 全章

---

## 🔗 関連ドキュメント

### HarmoNet 基本設計
- `01_DESIGN_PHILOSOPHY_Securea_City_Guideline_v2_0.md` - デザイン哲学
- `harmonet-design-system_v1_0.md` - デザインシステム
- `05_Project-Structure-v3_3_EN.md` - プロジェクト構造

### HarmoNet 機能設計
- `プロダクト開発用_機能要件定義書_v1_1.txt` - 全体機能要件
- `board-feature-design-v1_1.md` - 掲示板機能設計
- `home-feature-design-ch00-index_v2_0.md` - ホーム画面設計
- `login-feature-design-ch00_index_v1_0.md` - ログイン機能設計

### HarmoNet 開発規約
- `HarmoNet_FileNaming_Standard_v1_0.md` - ファイル命名規則
- `code-generation-rules-v2_1_EN.md` - コード生成ルール
- `naming-conventions-v2_1_EN.md` - 命名規則

---

## ⚙️ 文書管理情報

### バージョン管理
- 本文書はバージョン管理システム（Git）で管理されます
- 変更時は必ず改訂履歴を更新してください
- マイナーバージョンアップ: 内容の追加・修正（例: v1.0 → v1.1）
- メジャーバージョンアップ: 構成の大幅変更（例: v1.9 → v2.0）

### 承認プロセス
1. 作成者: TKD + Claude
2. レビュー: プロジェクトマネージャー
3. 承認: プロダクトオーナー
4. 公開: 開発チーム全員

### 更新ルール
- 各章は独立して更新可能
- 章間の整合性は定期的にレビュー
- 重要な変更は関連章も同時に更新

---

## 📋 用語集

| 用語 | 説明 |
|-----|------|
| **HarmoNet** | セキュレアシティ スマートコミュニケーションアプリの正式名称 |
| **MVP** | Minimum Viable Product（実用最小限の製品） |
| **facility_master** | 施設マスタテーブル。施設の基本情報を管理 |
| **facility_rule** | 施設ルールテーブル。施設ごとの予約ルールを定義 |
| **reservation** | 予約テーブル。予約データを管理 |
| **facility_i18n** | 施設多言語テーブル。施設名・説明文の翻訳を管理 |
| **テナント** | 物件単位。セキュレアシティ全体または特定の棟 |
| **排他制御** | 複数ユーザーの同時予約を防ぐ仕組み |
| **JSONB** | PostgreSQLのJSON型。拡張データの保存に使用 |
| **Google Translation API** | Googleが提供する機械翻訳API |
| **連続予約** | 1回の操作で複数日を予約する機能（本システムでは提供しない） |
| **最大予約日数** | 1人が同時に保持できる予約数の上限（管理者設定可能） |
| **行カレンダー** | 1行=1日、列=駐車場番号の形式で表示するカレンダー |

---

## 📞 問い合わせ先

### 技術的な質問
- プロジェクトリード: TKD
- 開発チーム: HarmoNet Dev Team

### ビジネス要件の質問
- プロダクトオーナー: (未定)
- プロジェクトマネージャー: (未定)

---

**Document ID**: HARMONET-FACILITY-BOOKING-DESIGN-001  
**Status**: 承認待ち  
**Created**: 2025-10-29  
**Last Updated**: 2025-10-29  
**Version**: v1.1  
**Authors**: TKD + Claude  

---

© 2025 HarmoNet Project. All rights reserved.
