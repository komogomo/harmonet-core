# 第6章: 掲示板詳細画面（コメント入力エリア設計）

**掲示板詳細画面 設計書 v2.2**

[← 第5章](board-detail-design-ch05_v2.1.md) | [目次に戻る](board-detail-design-ch00-index.md)

---

## 🆕 ChangeLog (v2.2 / 2025-10-31)

- コード削除・5節構成に再整理  
- UI構造および操作仕様を明文化  
- 投稿前バリデーション／AIモデレーションの参照を機能仕様へ統一  
- UIトーンを「やさしく・自然・控えめ」に統一  
- 不要なQA・アクセシビリティ記述を削除  
- メタ情報をHarmoNet共通フォーマットに更新  

---

## 6.1 概要

本章では、掲示板詳細画面における**コメント入力エリア**のUI/UX設計を定義する。  
利用者が投稿内容に意見・返信を記述する領域であり、入力、送信、AIモデレーション、エラー処理の一連の操作を対象とする。

対象機能は以下に含まれる：  
- コメント本文入力（最大500文字）  
- 投稿ボタン押下による送信処理  
- 投稿前のバリデーションおよびAIモデレーションチェック  
- 入力中状態（loading）やエラー通知表示  

---

## 6.2 UI構成と操作仕様

### 6.2.1 レイアウト概要

| 項目 | 内容 |
|------|------|
| テキストエリア | コメント本文を入力する領域。行数は自動伸縮。 |
| 文字数カウンター | 残り文字数を右下に表示（例：420 / 500） |
| 投稿ボタン | 青系アクセント（#1565C0）。押下で送信APIを呼び出す。 |
| プレースホルダー | 「コメントを入力してください」 |
| 入力中インジケータ | 投稿ボタン右横に小型スピナー表示 |

**構成イメージ**
```
──────────────────────────────
💬 コメントを入力してください...
[ 投稿する ]　　　420 / 500
──────────────────────────────
```

### 6.2.2 動作仕様

- テキストエリア入力時に残り文字数を動的に更新。  
- 投稿ボタン押下後は非活性化し、送信中スピナーを表示。  
- 投稿完了時はエリアをクリアし、コメント一覧へ即時反映。  
- 通信エラー時は「送信に失敗しました」と軽量モーダルで通知。  

---

## 6.3 バリデーション・モデレーション仕様

### 6.3.1 投稿前バリデーション

| チェック項目 | 内容 |
|---------------|------|
| 空入力 | 入力が空の場合は投稿不可 |
| 文字数制限 | 500文字を超過した場合は赤字で警告 |
| 不正文字 | 禁止ワード・スクリプト挿入を除外 |

### 6.3.2 AIモデレーション連携

投稿送信時にAIモデレーションAPIを呼び出し、以下をチェックする：  
- 個人情報の含有  
- 暴言・誹謗中傷表現  
- 広告・スパム投稿  
検出時は投稿者に修正メッセージを表示。  

**参照:** `harmonet-functional-requirements-ch03-functional-req-part1_v1.3.md`  
> 「3.2.2 投稿機能」および「3.2.6 通報後対応ルール」を準拠。  

### 6.3.3 状態管理
- 投稿中：送信ボタン非活性、スピナー表示。  
- 成功時：入力欄をクリアし、投稿一覧を更新。  
- エラー時：赤字エラーメッセージ表示（3秒で自動消去）。  

---

## 6.4 非表示制御・エラー表示仕様

### 6.4.1 表示制御

| 条件 | 動作 |
|------|------|
| 投稿がロック中 | 入力欄とボタンをグレーアウト（管理者設定） |
| 回覧板投稿 | コメント機能を非表示 |
| 閲覧専用モード | テキストエリア非表示、メッセージ「コメント投稿は無効です」 |

### 6.4.2 エラー通知

- 通信失敗時：「ネットワークエラーが発生しました」  
- モデレーションブロック時：「内容に不適切な表現が含まれています」  
- 入力超過時：「文字数制限を超えています（最大500文字）」  

通知は軽量モーダルで表示し、背景をブラー化（`backdrop-filter: blur(4px)`）して強調。  

---

## 6.5 UIトーンとアクセシビリティ

### 6.5.1 トーン指針

- 「やさしく・自然・控えめ」を原則とする。  
- 背景は白基調、ボタンは淡青アクセント（#1565C0）。  
- 枠線は#E0E0E0、影は`shadow-sm`。  
- テキストエリアは角丸8pxで統一。  

### 6.5.2 アクセシビリティ対応

- フォント：BIZ UDゴシック（ユニバーサルデザイン準拠）  
- コントラスト比：WCAG 2.1 AA準拠（4.5:1以上）  
- フォーカスリング：`outline-offset: 2px; outline-color: #1565C0`  
- 音声読み上げ：aria-label属性で主要操作に対応  

---

**Document ID:** SEC-APP-BOARD-DETAIL-006-CH06  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-31  
**Version:** 2.2  
