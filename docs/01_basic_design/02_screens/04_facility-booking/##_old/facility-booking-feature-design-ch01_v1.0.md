# 施設予約機能 詳細設計書 Chapter 01: 概要・MVP機能セット

**HarmoNet スマートコミュニケーションアプリ**

**文書ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH01  
**バージョン**: v1.0  
**最終更新**: 2025年10月29日  
**ステータス**: 承認待ち

---

## 📝 改訂履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|---------|--------|
| v1.0 | 2025年10月29日 | 初版作成 | TKD |

---

## 目次

1. [目的と背景](#1-目的と背景)
2. [基本方針](#2-基本方針)
3. [MVP機能セット（ゲスト駐車場）](#3-mvp機能セットゲスト駐車場)
4. [将来実装機能](#4-将来実装機能)
5. [対象施設の分類](#5-対象施設の分類)

---

## 1. 目的と背景

### 1.1 HarmoNetにおける施設予約機能の位置づけ

施設予約機能は、HarmoNetアプリケーションにおける重要な住民サービス機能の一つです。住民が共用施設をオンラインで予約・管理できる仕組みを提供し、管理組合の業務効率化と住民の利便性向上を同時に実現します。

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 2.1 開発目的

HarmoNetの開発目的の一つである「共用施設の効率利用」を具体化する機能として、以下の価値を提供します：

- リアルタイムでの予約状況確認
- 24時間365日いつでも予約可能
- 予約履歴の一元管理
- 多言語対応による外国人住民への配慮

### 1.2 なぜ施設予約機能が必要か

大規模分譲住宅地における共用施設の管理には、以下の課題が存在します：

#### 1.2.1 紙ベースの予約管理からの脱却

**現状の課題**
- 管理組合事務所の営業時間内のみ予約受付
- 電話・FAX・訪問による予約手続きの煩雑さ
- 予約台帳の手書き管理による転記ミス
- 予約状況の共有が困難（他の住民が予約可否を確認できない）

**解決策**
- オンライン予約システムによる24時間受付
- 自動化による人的ミスの削減
- リアルタイムでの空き状況可視化

#### 1.2.2 予約状況のリアルタイム可視化

**現状の課題**
- 予約可否を確認するために管理組合への問い合わせが必要
- 複数の日程候補を確認する場合の手間
- 予約が埋まっているかどうかの事前確認が困難

**解決策**
- カレンダー形式での予約状況表示
- 空き状況の色分け表示
- 複数日程の一括確認が可能

#### 1.2.3 多言語対応の必要性

**現状の課題**
- 日本語のみの案内・予約フォーム
- 外国人住民が予約手続きを理解できない
- 言語の壁による施設利用の機会損失

**解決策**
- 3言語（日本語・英語・中国語）完全対応
- 翻訳APIによる動的コンテンツの自動翻訳
- すべての住民が母語で予約できる環境

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.8.4 多言語対応

#### 1.2.4 管理者の負担軽減

**現状の課題**
- 予約受付・確認・台帳記入の手作業
- 予約状況の問い合わせ対応
- キャンセル処理の煩雑さ
- 利用料金の集計・請求作業

**解決策**
- 予約プロセスの完全自動化
- 予約・キャンセル通知の自動送信
- 利用統計の自動集計
- 管理画面での一元管理

---

## 2. 基本方針

### 2.1 共通予約構造の設計思想

HarmoNetの施設予約機能は、**「施設の種類が異なっても共通の予約構造で管理できる」**ことを設計の基本方針とします。

#### 2.1.1 なぜ共通予約構造が重要か

**拡張性の確保**
- MVP（ゲスト駐車場）から将来の施設追加までスムーズに拡張
- 新しい施設を追加する際にシステム改修を最小限に抑える
- データモデルの一貫性を維持

**開発効率の向上**
- 一度構築した予約システムを複数施設で再利用
- 画面・ロジックの共通化によるコード量削減
- テスト・保守の効率化

**ユーザー体験の統一**
- どの施設でも同じ操作感で予約できる
- 学習コストの削減
- 迷わない・間違えないUI

#### 2.1.2 データモデルではなくルール定義層で差異を吸収

施設間の違いは、データベースの構造ではなく、**ルール定義層（facility_rule）で吸収**します。

**ルール定義層で管理する項目**
- 予約単位（時間単位/日単位/コマ単位）
- 最大予約数（同時に予約できる施設数）
- 連続予約制限（最大何日間連続予約可能か）
- キャンセルポリシー（いつまでキャンセル可能か）
- 承認要否（管理者承認が必要か/即時確定か）
- 料金・ポイント設定（有料/無料、料金体系）
- 予約可能期間（何日先まで予約可能か）
- 利用時間制限（最短/最長利用時間）

**例：ゲスト駐車場のルール定義**
```json
{
  "facility_type": "guest_parking",
  "booking_unit": "day",
  "max_consecutive_days": 3,
  "advance_booking_days": 30,
  "cancellation_deadline": "before_start",
  "requires_approval": false,
  "fee_per_unit": 100,
  "currency": "JPY"
}
```

**例：集会室のルール定義（将来実装）**
```json
{
  "facility_type": "meeting_room",
  "booking_unit": "hour",
  "max_consecutive_hours": 4,
  "advance_booking_days": 60,
  "cancellation_deadline": "3_days_before",
  "requires_approval": true,
  "fee_per_unit": 500,
  "currency": "JPY"
}
```

このアプローチにより、施設ごとにテーブルを作成する必要がなくなり、拡張性と保守性が向上します。

### 2.2 UI統一の考え方

#### 2.2.1 施設によってUIを変えない原則

どの施設を予約する場合でも、予約フローは以下の3ステップで統一します：

**STEP 1: 選択**
- 日付・時間を選択
- 空き状況を視覚的に確認

**STEP 2: 入力**
- 利用目的・人数などの必要情報を入力
- 施設ごとの固有項目（駐車場の場合は車両ナンバー、集会室の場合は利用人数など）

**STEP 3: 確認**
- 予約内容を確認
- 利用料金・注意事項の表示
- 確定ボタンをタップ

この3ステップは、施設の種類に関わらず常に同じであり、ユーザーは一度覚えた操作方法をすべての施設で使い回せます。

#### 2.2.2 HarmoNetデザインシステムへの準拠

施設予約機能のすべてのUI要素は、HarmoNetデザインシステムに準拠します。

**参照**: 01_DESIGN_PHILOSOPHY_Securea_City_Guideline_v2_0.md

**デザイン原則**
- **やさしく（Gentle）**: 誰もが安心して使える優しいトーン
- **自然（Natural）**: 直感的に操作できるインターフェース
- **控えめ（Modest）**: 過度な装飾を避けたシンプルなデザイン

**カラーパレット**
- プライマリカラー: 青系（#3B82F6）
- セカンダリカラー: 緑系（#10B981）
- エラーカラー: 赤系（#EF4444）
- 背景色: 白/ライトグレー（#F9FAFB）

**タイポグラフィ**
- システムフォント（日本語: Noto Sans JP、英語: Inter、中国語: Noto Sans SC）
- フラットな丁寧語を使用
- 翻訳を前提とした平易な文章構造

#### 2.2.3 メッセージトーンの統一

すべてのメッセージは、以下のトーンで統一します：

**成功メッセージ**
- ❌ 悪い例: 「予約が完了しました！」（感嘆符は使わない）
- ✅ 良い例: 「予約が完了しました。ご利用日をお楽しみください。」

**エラーメッセージ**
- ❌ 悪い例: 「エラーが発生しました」（原因不明）
- ✅ 良い例: 「この日付はすでに予約済みです。別の日付をお選びください。」

**確認メッセージ**
- ❌ 悪い例: 「本当に削除しますか？」（威圧的）
- ✅ 良い例: 「予約をキャンセルします。よろしいですか？」

---

## 3. MVP機能セット（ゲスト駐車場）

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.4 施設予約

### 3.1 MVP実装範囲

HarmoNetの施設予約機能におけるMVP（Minimum Viable Product）は、**ゲスト用駐車場のみ**を対象とします。

#### 3.1.1 対象施設: ゲスト用駐車場

**配置・台数**
- 表側（F1〜F6）: 6台
- 裏側（B1〜B6）: 6台
- **合計**: 12台

**予約単位**
- 1日単位（時間単位予約は将来実装）

**予約可能期間**
- 当日から30日先まで
- 例：10月29日に予約する場合、10月29日〜11月27日の範囲で予約可能

**利用料金**
- 1日100円（税込）
- アプリ内決済なし（管理費と合算して後日請求）

**車両ナンバー**
- 下4桁を入力（任意項目）
- 数字のみ、ハイフン不要

**連続予約制限**
- 最大3日間まで連続予約可能
- 例：10月29日に予約する場合、10月29日・30日・31日の3日間まで連続可能

**キャンセルポリシー**
- 利用開始前まで随時キャンセル可能
- キャンセル料なし
- 当日キャンセルも可能

#### 3.1.2 予約フロー概要

**住民側の予約フロー**
1. カレンダーで日付を選択
2. 駐車場MAP（F1-F6, B1-B6）から空き駐車場所を選択
3. 車両ナンバー下4桁を入力（任意）
4. 連続予約日数を選択（任意、最大3日間）
5. 予約内容を確認
6. 予約を確定
7. 確認メール・プッシュ通知を受信

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.4.3 予約フロー（住民側）

**管理者側の機能**
- 全予約状況の確認（カレンダー形式）
- 代理予約（住民に代わって予約可能）
- 予約のキャンセル・変更
- 予約ブロック設定（特定日付・駐車場所を予約不可にする）

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.4.6 予約管理（管理者側）

#### 3.1.3 予約制限ルール

| 制限項目 | ルール |
|---------|--------|
| 同日複数予約 | 同一ユーザーが同日に複数予約不可 |
| 連続予約 | 最大3日間まで連続予約可能 |
| 予約期限 | 当日から30日先まで |
| キャンセル | 利用開始前まで随時可能 |

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.4.2 予約制限ルール

**排他制御**
- 同じ駐車場所・同じ日付に対して、複数のユーザーが同時に予約しようとした場合、先に確定ボタンを押したユーザーの予約が優先されます
- 後から確定ボタンを押したユーザーには「この駐車場所はすでに予約されました」とエラーメッセージを表示

#### 3.1.4 通知機能

**予約完了時**
- 件名: 「[HarmoNet] 駐車場予約完了のお知らせ」
- 本文: 予約日時、駐車場所、利用料金、車両ナンバー、注意事項、問い合わせ先
- 多言語対応: ユーザーの言語設定（JA/EN/CN）に応じて送信

**予約キャンセル時**
- 件名: 「[HarmoNet] 駐車場予約キャンセルのお知らせ」
- 本文: キャンセルした予約の詳細、注意事項、問い合わせ先
- 多言語対応: ユーザーの言語設定に応じて送信

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 3.4.5 通知メール仕様

### 3.2 MVP除外機能

以下の機能は、MVPの範囲外とし、将来のフェーズで実装します。

**決済機能（アプリ内決済）**
- MVP では決済機能を実装せず、後日請求で対応
- 将来的にクレジットカード・電子マネー決済を検討

**時間単位予約**
- MVP は日単位予約のみ
- 集会室・会議室など時間単位が必要な施設は Phase 2 以降で対応

**承認フロー**
- MVP では即時確定（承認不要）
- 管理者承認が必要な施設は Phase 2 以降で対応

**ポイント連携**
- 予約・利用に応じたポイント付与は Phase 3 以降で検討

**集会室・ゲストルーム等の他施設**
- MVP はゲスト駐車場のみ
- 他施設は Phase 2 以降で段階的に追加

---

## 4. 将来実装機能

施設予約機能は、MVP完了後に段階的に機能を拡張していきます。

### 4.1 Phase 2（MVP完了後6ヶ月以内）

**参照**: プロダクト開発用_機能要件定義書_v1_1.txt - 6.2 将来的な拡張

#### 4.1.1 集会室予約

**概要**
- 住民の会合・イベント・パーティー等に利用できる集会室の予約機能

**予約単位**
- 時間単位（1時間〜4時間）
- 予約可能時間: 9:00〜21:00

**予約制限**
- 1回の予約で最大4時間まで
- 予約可能期間: 60日先まで

**利用料金**
- 1時間あたり500円
- 冷暖房費別途

**承認フロー**
- 管理者承認が必要
- 承認期限: 予約申請から3営業日以内

#### 4.1.2 ゲストルーム予約

**概要**
- 来客用の宿泊施設

**予約単位**
- 1泊単位

**予約制限**
- 1回の予約で最大3泊まで
- 予約可能期間: 90日先まで

**利用料金**
- 1泊3,000円
- 清掃費別途1,000円

**承認フロー**
- 管理者承認が必要

#### 4.1.3 会議室予約

**概要**
- 小規模な打ち合わせ・リモートワークスペース

**予約単位**
- 時間単位（1時間〜2時間）
- 予約可能時間: 9:00〜18:00

**予約制限**
- 1回の予約で最大2時間まで
- 予約可能期間: 30日先まで

**利用料金**
- 無料

**承認フロー**
- 即時確定（承認不要）

#### 4.1.4 時間単位予約対応

- 時間単位での予約が可能な施設に対応
- 30分刻みまたは1時間刻みでの予約
- カレンダーUIの拡張（タイムスロット表示）

#### 4.1.5 承認フロー実装

**承認プロセス**
1. 住民が予約申請
2. 管理者に通知
3. 管理者が承認・却下を判断
4. 結果を住民に通知

**承認画面（管理者側）**
- 承認待ち予約の一覧表示
- 予約詳細の確認
- 承認・却下ボタン
- 却下理由の入力（却下時）

### 4.2 Phase 3（MVP完了後1年以内）

#### 4.2.1 シアタールーム

**概要**
- ホームシアター設備を備えた共用スペース

**予約単位**
- 時間単位（2時間〜4時間）

**利用料金**
- 1時間あたり800円

#### 4.2.2 ラウンジ・ワークスペース

**概要**
- コワーキングスペース・リラックススペース

**予約単位**
- 時間単位（1時間〜）

**利用料金**
- 無料（座席指定なし）

#### 4.2.3 EV充電器

**概要**
- 電気自動車用の充電設備

**予約単位**
- 時間単位（1時間〜8時間）

**利用料金**
- 実費請求（電力使用量に応じて）

#### 4.2.4 ポイント連携機能

**概要**
- 予約・利用に応じてポイントを付与
- ポイントを割引に利用可能

**ポイント付与ルール**
- 予約1回につき10ポイント
- キャンセルなし利用完了で追加20ポイント
- 連続利用ボーナス

**ポイント利用**
- 1ポイント = 1円相当
- 施設利用料金の割引に使用可能

#### 4.2.5 決済機能

**対応決済方法**
- クレジットカード（Visa, Mastercard, JCB）
- デビットカード
- 電子マネー（Suica, PASMO等）
- QRコード決済（PayPay等）

**決済タイミング**
- 予約確定時に決済
- キャンセル時は全額返金

### 4.3 Phase 4（MVP完了後2年以内）

#### 4.3.1 IoT連携（スマートロック）

**概要**
- 予約確定後、スマートロックで自動解錠
- 予約時間外は施錠

**対応施設**
- 集会室
- ゲストルーム
- 会議室
- シアタールーム

#### 4.3.2 HEMS連携（エネルギー管理）

**概要**
- 施設の電力使用状況を可視化
- エネルギー効率の最適化

#### 4.3.3 AI予測機能（混雑予測）

**概要**
- 過去の予約データから混雑時期を予測
- おすすめの予約日時を提案

**機能例**
- 「この日は比較的空いています」
- 「週末は混雑が予想されます」
- 「平日午前中がおすすめです」

#### 4.3.4 コミュニティ機能連携

**概要**
- 掲示板機能と連携
- イベント企画・参加者募集
- 施設利用レポートの共有

---

## 5. 対象施設の分類

HarmoNetで予約可能な施設を、以下の4つのカテゴリに分類します。

### 5.1 室内系施設

**特徴**
- 屋内の施設
- 時間単位での予約が主
- 承認フローが必要な場合が多い
- 利用目的・人数の入力が必要

**対象施設**
- 集会室（Phase 2）
- パーティールーム（Phase 2）
- シアタールーム（Phase 3）
- 会議室（Phase 2）

**共通仕様**
- 予約単位: 時間単位（1時間〜）
- 予約可能時間: 9:00〜21:00（施設により異なる）
- 利用人数制限あり
- 設備・備品の選択が可能

### 5.2 宿泊・駐車系施設

**特徴**
- 日単位での予約が主
- 比較的シンプルな予約フロー
- 車両情報・宿泊者情報の入力が必要

**対象施設**
- ゲストルーム（Phase 2）
- ゲスト駐車場（MVP対象）

**共通仕様**
- 予約単位: 日単位
- 連続予約制限あり
- 利用者情報の入力が必要

### 5.3 共用スペース系施設

**特徴**
- 予約なしでも利用可能な場合が多い
- 座席指定・エリア指定が可能
- 無料または低額での提供

**対象施設**
- ラウンジ（Phase 3）
- ワークスペース（Phase 3）
- キッズルーム（Phase 4）

**共通仕様**
- 予約単位: 時間単位（任意）
- 予約なしでも利用可能
- 混雑状況の可視化

### 5.4 機能設備系施設

**特徴**
- 設備の利用が主目的
- 使用量に応じた課金が発生する場合がある
- IoT連携が前提

**対象施設**
- EV充電器（Phase 3）
- 宅配ロッカー（Phase 4・将来）
- 自転車置き場（Phase 4・将来）

**共通仕様**
- 予約単位: 時間単位または使用量単位
- リアルタイムの使用状況管理
- 実費請求が必要な場合がある

---

## 📖 ナビゲーション

- [⬅️ 前の章: Chapter 00 - 目次・概要](facility-booking-feature-design-ch00-index_v1.0.md)
- [➡️ 次の章: Chapter 02 - 施設構造・データモデル](facility-booking-feature-design-ch02_v1.0.md)
- [📚 目次に戻る](facility-booking-feature-design-ch00-index_v1.0.md)

---

**文書管理番号**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH01  
**文書分類**: 施設予約機能 詳細設計書  
**セキュリティレベル**: 社外秘

---

© 2025 HarmoNet Project. All rights reserved.
