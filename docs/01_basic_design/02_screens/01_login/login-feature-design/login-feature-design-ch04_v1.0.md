# 第4章: メール送信完了画面詳細

**Document:** LOGIN画面 機能設計書 v1.0  
**Chapter:** 4 of 6  
**Last Updated:** 2025/10/27

---

## 4.1 画面構成（3層構造）

メール送信完了画面も、統一された3層構造を採用します。

```
┌─────────────────────────────────────┐
│   ヘッダー領域 (Layer 1)             │
│   - アプリタイトル                    │
│   - 言語切替ボタン                    │
├─────────────────────────────────────┤
│                                     │
│   コンテンツ領域 (Layer 2)           │
│   - 成功アイコン                     │
│   - 完了メッセージ                   │
│   - 説明文                           │
│   - 再送信ボタン                     │
│                                     │
├─────────────────────────────────────┤
│   フッター領域 (Layer 3)             │
│   - リンク（利用規約等）              │
│   - コピーライト                     │
└─────────────────────────────────────┘
```

---

## 4.2 ヘッダー領域

### 構成要素

ログイン画面と同一の仕様です。

| 要素 | 説明 | 必須 |
|------|------|------|
| **アプリタイトル** | 「セキュレアシティ」 | ✅ |
| **言語切替ボタン** | JA / EN / CN | ✅ |

**詳細は第3章 3.2節を参照してください。**

---

## 4.3 コンテンツ領域

### 全体構成

**背景:**
- グラデーション背景（ログイン画面と同一）
  - 開始色: `#667eea` (紫)
  - 終了色: `#764ba2` (青紫)
  - 方向: 135度

**カード:**
- 背景色: `#ffffff` (白)
- 角丸: 16px
- 影: `0 4px 12px rgba(0, 0, 0, 0.1)`
- 最大幅: 500px
- パディング: 48px 32px

### 成功アイコン

**仕様:**
- アイコン: ✓（チェックマーク）
- サイズ: 80px × 80px（円形背景）
- アイコン色: `#10b981` (緑)
- 背景色: `rgba(16, 185, 129, 0.1)` (薄い緑)
- 配置: 中央寄せ
- マージン下: 24px

**SVGアイコン例:**
```html
<div class="success-icon">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
</div>
```

**アニメーション（オプション）:**
```css
.success-icon {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
```

---

### 完了メッセージ

**タイトル:**
- フォントサイズ: 24px（PC）、20px（モバイル）
- フォントウェイト: 700 (Bold)
- 文字色: `#1f2937`
- 配置: 中央寄せ
- マージン下: 16px

**説明文:**
- フォントサイズ: 14px
- 文字色: `#6b7280`
- 行間: 1.6
- 配置: 中央寄せ
- マージン下: 32px

### 多言語対応

| 言語 | タイトル | 説明文 |
|------|---------|--------|
| **日本語(JA)** | メールを送信しました | 入力されたメールアドレス宛にログインリンクを送信しました。<br>メールボックスをご確認ください。 |
| **英語(EN)** | Email Sent | We've sent a login link to your email address.<br>Please check your inbox. |
| **中国語(CN)** | 邮件已发送 | 我们已将登录链接发送到您的电子邮件地址。<br>请检查您的收件箱。 |

---

### 再送信ボタン

**ボタン仕様:**
| 項目 | 仕様 |
|------|------|
| **ラベル** | 再送信する |
| **type** | button |
| **背景色** | `transparent`（透明） |
| **文字色** | `#3b82f6` (青) |
| **ボーダー** | `2px solid #3b82f6` |
| **幅** | 100% |
| **高さ** | 46px (パディング: 14px) |
| **角丸** | 8px |
| **フォントサイズ** | 14px |
| **フォントウェイト** | 600 (Semibold) |

**ホバー時（PC/タブレット）:**
```css
.btn-resend:hover {
  background: #3b82f6;
  color: #ffffff;
  transition: all 0.2s;
}
```

**無効状態（レート制限時）:**
```css
.btn-resend:disabled {
  border-color: #d1d5db;
  color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.6;
}
```

**カウントダウン表示:**
- レート制限適用時にカウントダウンを表示
- 例: 「再送信まであと 58秒」

**多言語対応:**
| 言語 | ボタンラベル | カウントダウン |
|------|-------------|---------------|
| **日本語(JA)** | 再送信する | 再送信まであと {seconds}秒 |
| **英語(EN)** | Resend | Resend in {seconds}s |
| **中国語(CN)** | 重新发送 | 重新发送还需 {seconds}秒 |

---

## 4.4 再送信機能の仕様

### 再送信フロー

```
┌──────────────────────────────────────────┐
│  メール送信完了画面                        │
│                                          │
│  [再送信する]ボタン                       │
└─────────────┬────────────────────────────┘
              │
              │ ① ユーザーがボタンをクリック
              │
              ▼
┌──────────────────────────────────────────┐
│  バリデーション                           │
│  - レート制限チェック                     │
│  - 前回送信からの経過時間確認              │
└─────────────┬────────────────────────────┘
              │
              ├─ レート制限内 → 再送信実行
              │
              └─ レート制限超過 → エラー表示
```

### レート制限仕様

**同一メールアドレスへの送信制限:**
| 制限タイプ | 制限値 | 期間 |
|-----------|--------|------|
| **送信回数** | 3回 | 1時間 |
| **クールダウン** | 60秒 | 前回送信から |

**制限超過時の動作:**
1. ボタンを無効化
2. カウントダウン表示
3. エラーメッセージ表示（オプション）

**実装例:**
```javascript
// 再送信可能時刻を計算
const lastSentAt = new Date('2025-10-27T10:30:00Z');
const cooldownSeconds = 60;
const nextAvailableAt = new Date(lastSentAt.getTime() + cooldownSeconds * 1000);

// カウントダウン
const now = new Date();
const remainingSeconds = Math.ceil((nextAvailableAt - now) / 1000);

if (remainingSeconds > 0) {
  // ボタン無効化 + カウントダウン表示
  button.disabled = true;
  button.textContent = `再送信まであと ${remainingSeconds}秒`;
} else {
  // ボタン有効化
  button.disabled = false;
  button.textContent = '再送信する';
}
```

---

### エラーケース

**1. レート制限超過（時間内の送信回数超過）**
| 言語 | エラーメッセージ |
|------|-----------------|
| 日本語 | 送信回数の上限に達しました。しばらくしてから再度お試しください。 |
| 英語 | You've reached the maximum number of attempts. Please try again later. |
| 中国語 | 您已达到最大尝试次数。请稍后再试。 |

**2. ネットワークエラー**
| 言語 | エラーメッセージ |
|------|-----------------|
| 日本語 | メールの送信に失敗しました。しばらくしてから再度お試しください。 |
| 英語 | Failed to send email. Please try again later. |
| 中国語 | 发送邮件失败。请稍后再试。 |

**3. システムエラー**
| 言語 | エラーメッセージ |
|------|-----------------|
| 日本語 | システムエラーが発生しました。時間をおいて再度お試しください。 |
| 英語 | A system error occurred. Please try again later. |
| 中国語 | 发生系统错误。请稍后再试。 |

---

## 4.5 デザイン仕様

### カラーパレット

| 用途 | カラーコード | 説明 |
|------|-------------|------|
| **Success** | `#10b981` | 成功アイコン |
| **Success Light** | `rgba(16, 185, 129, 0.1)` | 成功アイコン背景 |
| **Primary** | `#3b82f6` | 再送信ボタン枠線・文字 |
| **Text Primary** | `#1f2937` | タイトル |
| **Text Secondary** | `#6b7280` | 説明文 |
| **Background** | `#ffffff` | カード背景 |
| **Error** | `#ef4444` | エラーメッセージ |

### タイポグラフィ

| 要素 | サイズ | ウェイト | 色 |
|------|-------|---------|-----|
| タイトル | 24px | 700 | `#1f2937` |
| 説明文 | 14px | 400 | `#6b7280` |
| ボタン | 14px | 600 | `#3b82f6` |
| カウントダウン | 13px | 500 | `#6b7280` |

### スペーシング

**カード内:**
- パディング: 48px 32px（PC）、32px 24px（モバイル）
- 成功アイコン下マージン: 24px
- タイトル下マージン: 16px
- 説明文下マージン: 32px

---

## 4.6 フッター領域

### 構成要素

ログイン画面と同一の仕様です。

**詳細は第3章 3.8節を参照してください。**

---

## 4.7 レスポンシブ対応

### ブレークポイント

| デバイス | 幅 | 調整内容 |
|---------|-----|---------|
| **PC** | > 768px | デフォルト |
| **タブレット** | 768px | カード幅調整 |
| **スマートフォン** | < 768px | パディング縮小、フォントサイズ調整 |

### スマートフォン最適化

**カード:**
- パディング: 32px 24px（48px 32pxから縮小）

**成功アイコン:**
- サイズ: 64px × 64px（80px × 80pxから縮小）

**タイトル:**
- フォントサイズ: 20px（24pxから縮小）

**説明文:**
- フォントサイズ: 13px（14pxから縮小）

---

## 4.8 アクセシビリティ

### セマンティックHTML

```html
<main class="page-content">
  <div class="email-sent-card">
    <!-- 成功アイコン -->
    <div class="success-icon" role="img" aria-label="送信成功">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    </div>
    
    <!-- 成功メッセージ -->
    <div class="success-message">
      <h2 id="success-title">メールを送信しました</h2>
      <p id="success-text">
        入力されたメールアドレス宛にログインリンクを送信しました。
        メールボックスをご確認ください。
      </p>
    </div>
    
    <!-- 再送信ボタン -->
    <button 
      type="button" 
      class="btn-resend"
      aria-label="ログインメールを再送信"
      aria-describedby="resend-info"
    >
      再送信する
    </button>
    
    <span id="resend-info" class="sr-only">
      メールが届かない場合、このボタンで再送信できます
    </span>
  </div>
</main>
```

### キーボードナビゲーション

**Tab順序:**
1. 言語切替ボタン（JA）
2. 言語切替ボタン（EN）
3. 言語切替ボタン（CN）
4. 再送信ボタン
5. フッターリンク（利用規約）
6. フッターリンク（プライバシーポリシー）
7. フッターリンク（お問い合わせ）

**Enterキー / Spaceキー:**
- 再送信ボタンにフォーカス時 → 再送信実行

### スクリーンリーダー対応

**重要な通知:**
```html
<div role="status" aria-live="polite" aria-atomic="true">
  メールを送信しました
</div>
```

**エラー通知:**
```html
<div role="alert" aria-live="assertive">
  送信回数の上限に達しました
</div>
```

### フォーカスインジケーター

```css
.btn-resend:focus {
  outline: 3px solid #3b82f6;
  outline-offset: 2px;
}
```

---

## 4.9 ユーザー体験の最適化

### メール到着までの待機時間

**想定時間:**
- 通常: 10秒〜1分
- 遅延時: 1分〜5分

**ユーザーへの案内:**
```
メールが届かない場合：
1. 迷惑メールフォルダをご確認ください
2. メールアドレスが正しいかご確認ください
3. しばらく待ってから再送信してください
```

### 多言語案内

| 言語 | 案内文 |
|------|--------|
| 日本語 | メールが届かない場合は、迷惑メールフォルダをご確認いただくか、再送信をお試しください。 |
| 英語 | If you don't receive the email, please check your spam folder or try resending. |
| 中国語 | 如果您没有收到邮件,请检查垃圾邮件文件夹或尝试重新发送。 |

---

## 4.10 実装上の注意事項

### セッション管理

**セッション情報:**
- メールアドレス（暗号化して保持）
- テナントID
- 最終送信日時
- 送信回数

**セッション有効期限:**
- 1時間（レート制限リセット時間と同期）

### ログ記録

**記録項目:**
- メール送信イベント
- 再送信イベント
- レート制限発動
- エラー発生

**ログレベル:**
- INFO: 送信成功
- WARNING: レート制限超過
- ERROR: 送信失敗

---

**[← 前の章: 第3章 ログイン画面詳細](login-feature-design-ch03.md)**

**[次の章へ: 第5章 セキュリティ対策 →](login-feature-design-ch05.md)**

**[目次に戻る ↑](login-feature-design-ch00-index.md)**
