# 第5章: 新規投稿画面

**掲示板機能 詳細設計書 v2.0**

[← 第4章](board-feature-design-ch04.md) | [目次に戻る](board-feature-design-ch00-index.md) | [第6章へ →](board-feature-design-ch06.md)

---

## 5.1 画面要素

新規投稿画面は、住民が投稿を作成する画面です。入力フォーム、バリデーション、AI自動モデレーションが含まれます。

### 5.1.1 ヘッダー

**ヘッダーの構成**

```
┌─────────────────────────────────┐
│ ×  新規投稿         [投稿する]  │ ← ヘッダー
└─────────────────────────────────┘
```

**左側: キャンセルボタン（×）**

- タップで新規投稿をキャンセル
- 入力内容がある場合は確認ダイアログを表示

```
入力内容が破棄されます。
よろしいですか？

[キャンセル] [破棄する]
```

**右側: 投稿するボタン**

- タップで投稿を実行
- 入力内容が不足している場合はグレーアウト（非活性）
- 有効な場合は青色で表示

---

### 5.1.2 安全な投稿のための注意表示

画面上部に、安全な投稿のための注意を表示します。

**表示内容**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 投稿前にご確認ください

・不適切な投稿は自動的にブロックされます
・攻撃的な表現は自動的に適切な表現に変換されます
・匿名投稿でも内容から特定される可能性があります

詳しくは「投稿ガイドライン」をご覧ください
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**表示タイミング**

- 初回訪問時に表示
- 以降は折りたたみ可能（「注意を見る」リンクで再表示）

**デザイン**

- 背景色: 薄い黄色（#FFF9C4）
- 文字色: 濃い黄色（#F57F17）
- アイコン: ⚠️（警告マーク）
- 角丸: 8px

**投稿ガイドラインへのリンク**

「投稿ガイドライン」をタップすると、別画面で投稿ガイドラインを表示します。

---

### 5.1.3 入力フォーム

投稿内容を入力するフォームです。

**フォーム構成**

```
┌─────────────────────────────────┐
│ カテゴリ *                       │
│ [お知らせ ▼]                    │
│                                 │
│ タイトル *                       │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ └─────────────────────────────┘ │
│ 0 / 50文字                      │
│                                 │
│ 本文 *                          │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ │                             │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│ 0 / 2000文字                    │
│                                 │
│ 📎 添付ファイル                  │
│ [ファイルを選択]                 │
│                                 │
│ [プレビュー表示エリア]           │
└─────────────────────────────────┘
```

---

#### カテゴリ選択（必須）

**入力方法**

ドロップダウンから1つ選択

**選択肢**

- 住民: 自分が投稿できるカテゴリのみ表示
- 管理者: すべてのカテゴリを表示（回覧板カテゴリを含む）

**デフォルト値**

未選択（プレースホルダー: 「カテゴリを選択してください」）

**バリデーション**

未選択の場合、エラーメッセージを表示

```
❌ カテゴリを選択してください
```

---

#### タイトル入力（必須）

**入力方法**

テキストボックス（1行）

**文字数制限**

最大50文字

**プレースホルダー**

「タイトルを入力してください」

**文字数カウンター**

入力中の文字数を表示

```
15 / 50文字
```

**バリデーション**

- 未入力の場合: エラーメッセージを表示
- 50文字を超えた場合: エラーメッセージを表示

```
❌ タイトルを入力してください
❌ タイトルは50文字以内で入力してください
```

---

#### 本文入力（必須）

**入力方法**

テキストエリア（複数行）

**文字数制限**

最大2000文字

**プレースホルダー**

「本文を入力してください」

**文字数カウンター**

入力中の文字数を表示

```
125 / 2000文字
```

**バリデーション**

- 未入力の場合: エラーメッセージを表示
- 2000文字を超えた場合: エラーメッセージを表示

```
❌ 本文を入力してください
❌ 本文は2000文字以内で入力してください
```

---

#### 添付ファイル選択（任意）

**入力方法**

ファイル選択ボタン

**対応ファイル形式**

- 画像: JPEG, PNG, GIF, WebP
- PDF: PDF
- Office: Word (.docx), Excel (.xlsx), PowerPoint (.pptx)

**ファイルサイズ制限**

- 1ファイルあたり: 最大5MB
- 1投稿あたり: 最大5ファイル、合計10MB

**選択方法**

1. 「ファイルを選択」ボタンをタップ
2. デバイスのファイルピッカーが開く
3. ファイルを選択
4. プレビュー表示エリアに追加

**バリデーション**

- ファイルサイズ超過: エラーメッセージを表示
- ファイル数超過: エラーメッセージを表示
- 非対応形式: エラーメッセージを表示

```
❌ ファイルサイズは5MB以下にしてください
❌ 添付ファイルは最大5個までです
❌ このファイル形式には対応していません
```

---

### 5.1.4 添付プレビュー表示エリア

選択したファイルのプレビューを表示します。

**画像ファイルの場合**

```
┌─────┐ ┌─────┐
│     │ │     │
│ 画像1│ │ 画像2│  ×
│     │ │     │
└─────┘ └─────┘
```

- サムネイル表示
- 右上に削除ボタン（×）

**PDF・Officeファイルの場合**

```
┌─────────────────────────┐
│ 📄 資料.pdf        ×   │
└─────────────────────────┘
```

- ファイル名とアイコンを表示
- 右側に削除ボタン（×）

---

## 5.2 バリデーション

投稿時に、以下のバリデーションを実行します。

### 5.2.1 必須項目チェック

**対象項目**

- カテゴリ
- タイトル
- 本文

**エラー表示**

未入力の場合、フィールド直下に赤文字でエラーメッセージを表示

```
❌ カテゴリを選択してください
❌ タイトルを入力してください
❌ 本文を入力してください
```

---

### 5.2.2 文字数制限チェック

**対象項目**

- タイトル: 最大50文字
- 本文: 最大2000文字

**エラー表示**

超過した場合、フィールド直下に赤文字でエラーメッセージを表示

```
❌ タイトルは50文字以内で入力してください
❌ 本文は2000文字以内で入力してください
```

---

### 5.2.3 ファイルサイズ・数の制限チェック

**制限**

- 1ファイルあたり: 最大5MB
- 1投稿あたり: 最大5ファイル、合計10MB

**エラー表示**

```
❌ ファイルサイズは5MB以下にしてください
❌ 添付ファイルは最大5個までです
❌ 合計ファイルサイズは10MB以下にしてください
```

---

### 5.2.4 NGワードフィルタ

**リアルタイムチェック**

入力中にNGワードを検知し、警告を表示します。

**対象語句**

- 管理者が設定したNGワード
- 誹謗中傷、暴言、差別表現など

**警告表示**

```
⚠️ この表現は不適切な可能性があります
```

- 黄色の背景
- フィールド直下に表示
- 投稿は可能（AI自動モデレーションで最終判定）

---

### 5.2.5 AI自動モデレーション

**実行タイミング**

「投稿する」ボタン押下時

**処理の流れ**

```
投稿ボタン押下
  ↓
[投稿内容を確認中...] 表示（0.5秒）
  ↓
AI自動判定（3段階）
  ↓
レベル1: ブロック → エラー表示、修正を促す
レベル2: 変換提案 → 変換後の文章を表示、選択可能
レベル3: OK → 即座に投稿完了
```

詳細は「第6章 主要機能 - 6.1.4 投稿時のAI自動処理」を参照してください。

---

### 5.2.6 エラーメッセージの表示位置

**フィールド直下**

各フィールドのエラーは、そのフィールド直下に赤文字で表示

**画面上部**

複数のエラーがある場合、画面上部にまとめて表示

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❌ 以下の項目を修正してください

・カテゴリを選択してください
・タイトルを入力してください
・本文は2000文字以内で入力してください
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 5.3 管理者画面（回覧板作成）

管理者が回覧板を作成する場合、通常の投稿画面に加えて以下の設定が可能です。

### 5.3.1 回覧板として投稿

**チェックボックス**

```
☑ 回覧板として投稿
```

- チェックすると、回覧板として投稿される
- 自動的に「返信不可」に設定される
- 既読管理機能が有効になる

---

### 5.3.2 対象グループ選択

**選択肢**

- 全体（全住民）
- 特定グループ（A棟、B棟など）

**デフォルト値**

全体（全住民）

**グループ回覧板の場合**

特定グループを選択すると、そのグループのメンバーのみに表示されます。

---

### 5.3.3 既読期限設定（Phase 2）

**Phase 2で実装予定**

回覧板の既読期限を設定できます。

**設定項目**

- 既読期限: 日付選択
- 未読者への通知: ON/OFF

**動作**

- 期限が近づくと未読者に自動通知
- 期限超過後も投稿は表示されるが、「期限超過」マークが表示される

---

## まとめ

第5章では、新規投稿画面の画面要素、バリデーション、管理者画面を定義しました。

**重要なポイント**

- 安全な投稿のための注意を表示し、住民への啓発を実施
- 必須項目、文字数制限、ファイルサイズのバリデーションを実装
- NGワードフィルタでリアルタイムチェック
- AI自動モデレーションで投稿前に最終チェック
- 管理者は回覧板作成時に対象グループを選択可能

---

[← 第4章](board-feature-design-ch04.md) | [目次に戻る](board-feature-design-ch00-index.md) | [第6章へ →](board-feature-design-ch06.md)

---

**Document ID:** SEC-APP-BOARD-DESIGN-002-CH05  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-27
