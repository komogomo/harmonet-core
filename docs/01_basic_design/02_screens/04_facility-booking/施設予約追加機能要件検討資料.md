# HarmoNet 施設予約機能 追加検討要件資料

## 1. 基本方針
- HarmoNetの施設予約機能は、「施設の種類が異なっても共通の予約構造で管理できる」ことを目的とする。
- 施設間の差異は、データモデルではなく**ルール定義層（facility_rule）**で吸収する。
- UIは全施設共通の流れ（予約 → 確認 → 完了）を持ち、操作体験を統一する。

## 2. 対象範囲
以下のような多様な施設種別を想定：
- 集会室・パーティールーム・シアタールームなど「室内系」
- ゲストルーム・ゲスト駐車場など「宿泊・駐車系」
- ラウンジ・ワークスペースなど「共用スペース系」
- EV充電器など「機能設備系」

※各物件（テナント）によって利用可否が異なるため、**施設ごとに有効／無効を設定可能**にすること。

## 3. 施設構造に関する前提
### facility_master
- テナント単位で施設情報を持つ。
- カラム例：`id`, `tenant_id`, `name`, `type`, `description`, `is_active`, `image_url`
- `is_active = false` の施設は住民UIには非表示とする。

### facility_rule
- 施設ごとの運用ルールを定義。
- カラム例：`facility_id`, `unit`, `open_time`, `close_time`, `max_reservations_per_user`, `allow_repeat`, `cancellation_policy`, `require_approval`, `fee_type`, `fee_point`

### reservation
- 共通構造で「誰が・いつ・どこを・どのように利用するか」を管理。
- カラム例：`id`, `facility_id`, `user_id`, `start_time`, `end_time`, `participants`, `status`, `note`

## 4. 共通予約フロー
1. 利用者が施設一覧（アクティブなもののみ）を閲覧。  
2. 対象施設を選択し、空き状況を確認。  
3. 日時・利用人数・用途を入力して予約申請。  
4. ルールに応じて即時確定または承認待ちへ遷移。  
5. 確定後、通知機能を通じてユーザへリマインド送信。

## 5. 機能面での検討ポイント
- **多施設対応**：施設をマスタ登録すれば即UIに反映される設計。  
- **柔軟な運用ルール**：同一画面上で施設ごとに予約単位・制限・承認要否を切り替え可能。  
- **スケジュール重複制御**：同一施設・時間帯での重複予約を防止。  
- **ポイント・料金連携**：将来的にポイント消費・加算機能と接続可能なスキーマ設計を考慮。  
- **通知・プッシュ連携**：予約確定／キャンセル／リマインドの自動通知を標準化。  
- **多言語UI**：施設名・説明文・ルール説明は翻訳対応（`facility_i18n`などで管理）。

## 6. 非機能的配慮
- 各施設はテナント（物件）単位で管理され、複数棟の共用施設にも対応可能とする。  
- DBスキーマ変更を伴わずに施設追加／削除ができる構成とする。  
- 将来的な拡張（IoT連携、エネルギー使用連携など）を見据えて、`reservation_meta`（JSONB）などの拡張カラムを検討。

## 7. UI上の方針（Claudeへのデザイン指示）
- 予約可能施設のみ一覧に表示。  
- 非アクティブ施設はカード非表示または「準備中」表示。  
- 予約フローは3ステップ（選択 → 入力 → 確認）で統一。  
- 予約成功時のメッセージトーンは「やさしく・自然・控えめ」スタイルに準拠。
