# HarmoNet マルチテナント設計仕様書 v1.1（Part3）
文書バージョン: 1.1
作成日: 2025年10月30日
最終更新日: 2025年10月30日
文書管理番号: HARMONET-MULTI-TENANT-001

---

## 第9章 コスト試算

### 9.1 クラウド利用コスト（MVP構成）
| 項目 | サービス | 想定月額 | 備考 |
|------|-----------|-----------|------|
| フロントエンド | Vercel Pro | 約2,500円 | CDN含む |
| DB／Auth／Storage | Supabase | 約3,000円 | RLS含む |
| メール通知 | SendGrid | 無料枠100通まで |
| 翻訳API | Google Cloud Translation | 約0円（50万文字無料） |
| 通知API | Firebase Cloud Messaging | 無料 |
| 監視 | UptimeRobot / Sentry | 約1,000円 |
| 合計 |  | **約6,500円／月** | MVP時想定 |

**備考:**  
将来的にユーザー数増加・マルチテナント拡張に伴い、月額15,000〜25,000円規模を想定。

---

### 9.2 AWS移行時コスト（将来）
| サービス | 概要 | 想定月額 |
|-----------|--------|-----------|
| ECS (Fargate) | APIコンテナ稼働 | 約8,000円 |
| RDS (PostgreSQL) | DB運用 | 約5,000円 |
| CloudFront | CDN配信 | 約2,000円 |
| S3 | 画像・添付保存 | 約1,000円 |
| 合計 |  | **約16,000円／月** |

---

## 第10章 スケーラビリティ設計

### 10.1 スケール戦略
1. **垂直スケーリング**：Vercel/Supabaseプランアップグレード  
2. **水平スケーリング**：ECS分散構成（将来フェーズ）  
3. **キャッシュ分散**：Redisクラスタリング  
4. **DB最適化**：インデックス最適化・RLS効率化

### 10.2 同時アクセス試験想定
| 想定条件 | 値 |
|-----------|------|
| 同時アクセス数 | 200（MVP）／500（拡張） |
| レスポンス閾値 | 2秒以下 |
| 翻訳APIレイテンシ | 5秒以内／500文字 |
| テナント追加時の影響 | RLS＋キャッシュで限定的 |

---

## 第11章 拡張フェーズ計画

### 11.1 フェーズ概要
HarmoNetの機能拡張は以下4フェーズで計画される。

| フェーズ | 期間 | 主な追加機能 |
|----------|------|---------------|
| Phase1 | MVPリリース | 掲示板・お知らせ・駐車場予約・通知・マイページ |
| Phase2 | +6ヶ月 | 安否確認・監視カメラ・住宅設備／消耗品照会 |
| Phase3 | +1年 | HEMS連携・AI自動翻訳最適化・マルチテナント強化 |
| Phase4 | +2年 | IoT統合・コミュニティ拡張・分析レポート |

---

### 11.2 Phase2 詳細：住宅設備／消耗品照会・発注機能

**目的:**  
住宅設備機器や共用部消耗品の交換・発注をオンラインで管理する。  
住民が自宅設備の型番・部品情報を照会し、在庫・再注文を容易に行える仕組みを提供する。

**機能概要:**
- 設備／部品マスタ参照（管理会社登録）  
- 型番・カテゴリ検索  
- 消耗品リスト（例：換気フィルタ・電球・電池）  
- 発注フォーム（数量・備考入力）  
- 注文履歴・再注文機能  
- 外部API連携（管理会社またはECサイト）  

**データモデル例:**
| テーブル | 主目的 |
|-----------|----------|
| consumables_items | 消耗品マスタ（型番・カテゴリ） |
| consumables_orders | 発注履歴（テナント単位） |
| consumables_suppliers | 仕入先情報 |

**テーブルサンプル:**  
```sql
CREATE TABLE consumables_items (
  id SERIAL PRIMARY KEY,
  tenant_id UUID NOT NULL,
  item_name TEXT,
  category TEXT,
  model_number TEXT,
  stock_count INT DEFAULT 0,
  supplier_id INT,
  updated_at TIMESTAMP DEFAULT now()
);
```

**UI想定:**  
ホーム画面タイル「🛒 消耗品」→ 一覧／検索／注文履歴。

**管理画面:**  
管理者が品目登録・在庫調整を行える。

---

### 11.3 Phase3〜4 ハイライト

**Phase3:**  
- HEMSデータ連携（電力使用量グラフ表示）  
- AI翻訳精度最適化（Claude連携）  
- 行動解析ベースのスマート通知  
- フルマルチテナント化（デベロッパー横断）  

**Phase4:**  
- IoT／スマートホーム統合（ロック・センサー）  
- コミュニティ拡張（イベント・物品貸借）  
- AI要約・管理ボット機能  
- 統計・予測分析ダッシュボード  

---

## 第12章 リスク・対策

| リスク | 影響度 | 対策 |
|--------|----------|------|
| Supabase API障害 | 高 | バックアップ環境用意・リトライ |
| 翻訳API超過 | 中 | キャッシュ・差分翻訳 |
| データ越権アクセス | 高 | RLS＋アプリ層検証 |
| テナント設定破損 | 中 | バージョン管理・バックアップ |
| ユーザー離脱 | 高 | UX改善・説明会開催 |
| コスト増大 | 中 | 無料枠モニタリング・段階プランアップ |
| AI連携停止 | 中 | Claude/Gemini/GPT代替切替ポリシー |

---

## 第13章 付録／参照資料

### 13.1 関連ドキュメント
| 名称 | 内容 |
|------|------|
| HarmoNet 機能要件定義書 v1.2 | 機能・非機能要件総覧 |
| HarmoNet デザインガイドライン | UI/UXルール定義 |
| HarmoNet API仕様書 | APIエンドポイント定義 |
| HarmoNet DB設計書 | Prismaスキーマ・ER図 |
| HarmoNet セキュリティガイドライン | 暗号化・RLSポリシー |
| HarmoNet 運用マニュアル | 管理者向け運用手順 |

---

### 13.2 用語集
| 用語 | 意味 |
|------|------|
| テナント | 管理単位（住宅群・管理組合） |
| RLS | Row Level Security。テナント間分離方式 |
| consumables | 住宅設備・消耗品照会機能 |
| Phase | 開発フェーズ（MVP以降の拡張） |
| AI協調開発 | Claude, Gemini, GPTによる分担開発 |

---

### 13.3 Claude登録用サマリー（1ページ版）

**HarmoNet マルチテナント設計仕様書 v1.1（2025-10-30 改訂）**  
- 構成: Vercel + Supabase (RLS対応)  
- テーブル: tenant / tenant_user / tenant_features / tenant_settings / consumables_*  
- 新規追加機能: 消耗品照会・発注（Phase2）  
- Row Level Security: Supabase JWTポリシーによるtenant_id隔離  
- Prismaミドルウェアによるtenant_id自動付与  
- AI開発体制: Claude（UX）＋Gemini（Infra）＋GPT（PMO/Docs）  
- 今後の拡張: HEMS・IoT連携・スマート通知・AI分析  

---
