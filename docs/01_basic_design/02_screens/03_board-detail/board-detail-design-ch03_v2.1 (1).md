# 第3章: 掲示板詳細画面（本文・添付・翻訳領域）

**掲示板詳細画面 設計書 v2.1（完全版）**

[← 第2章](board-detail-design-ch02_v2.1_full.md) | [目次に戻る](board-detail-design-ch00-index.md) | [第4章へ →](board-detail-design-ch04_v2.0.md)

---

## 🆕 ChangeLog (v2.1 / 2025-10-31)

- 章構成を再整理し、本文・添付・翻訳のみを対象範囲に限定  
- コメント・リアクション・通報機能は第4章に移行予定  
- PDFプレビュー仕様を更新（モーダル上部に「閉じる」ボタン配置／背景タップ無効）  
- 翻訳操作のUIとRedisキャッシュ連携仕様を追記  
- UIトーンを「やさしく・自然・控えめ」に統一  
- ドキュメントメタ情報をHarmoNet共通フォーマットに更新  

---

## 3.1 概要

本章は「掲示板詳細画面」における本文領域・添付ファイル・翻訳操作のUI/UX仕様を定義する。  
本画面は `board-detail-design-ch02`（ヘッダー構成）と連携し、住民が投稿内容を閲覧・確認・翻訳できる主要エリアを担う。

設計思想は HarmoNet の統一トーン「やさしく・自然・控えめ」に準拠し、  
BIZ UDゴシックを基調とした読みやすく落ち着いたデザインを採用する。

---

## 3.2 本文構造

### 3.2.1 レイアウト概要

| 項目 | 内容 |
|------|------|
| タイトル行 | 投稿タイトルを大きく表示（20px、Bold） |
| 投稿者情報 | 投稿者名・日時・タグを横並び表示 |
| 本文テキスト | 最大5,000文字、改行保持表示 |
| 添付ファイル領域 | 画像／PDF／その他ファイルをカード形式で表示 |
| 翻訳ボタン | 各投稿本文下に配置、「翻訳」押下でローカライズテキストを展開 |

**視覚構成（イメージ）**
```
[タイトル]
【重要】総会開催のお知らせ
───────────────────
管理組合  • 2025/10/30 10:00  • タグ：重要
───────────────────
本年度の総会を下記の日程で開催します。
…（本文省略）…

📎 添付ファイル：総会案内.pdf [プレビュー]
🌐 翻訳（英語）
```

---

### 3.2.2 添付ファイルカード仕様

| 項目 | 内容 |
|------|------|
| アイコン | 📎 or 📄（PDF）、🖼（画像） |
| ファイル名 | 最大20文字、省略時はホバーで全名表示 |
| プレビューリンク | PDF.js／画像ビューアに連携 |
| サイズ表示 | 任意（Phase2で実装予定） |

UIトーンは「控えめ」であり、枠線は #E0E0E0、影は `shadow-sm`。  
カードクリックでPDFプレビューまたは画像モーダルを起動。

---

## 3.3 PDFプレビュー仕様（v2.1更新）

### 3.3.1 概要

PDFプレビューは、掲示板投稿に添付されたPDFをブラウザ内で直接閲覧できる機能である。  
PDF.js を用いて、スマートフォン環境でも追加アプリ不要で閲覧可能とする。

### 3.3.2 UI挙動

- 添付PDFをタップすると、全画面モーダルでPDFプレビューを表示。  
- モーダル上部に「閉じる」テキストまたは✕アイコンを配置（右上／上中央のいずれか）。  
- 背景タップでは閉じない（誤操作防止）。  
- PDF内部のスクロール・ピンチ操作を優先する。  
- モーダル下部中央に「タップで閉じる」ガイドを表示（非アクティブ時の補助）。  
- UIトーン：「やさしく・自然・控えめ」（白背景＋淡い影）。  

### 3.3.3 実装要素（技術仕様）

| 項目 | 値 |
|------|----|
| ビューア | Mozilla PDF.js |
| 依存 | Reactコンポーネントラップ版（phase2: dynamic import） |
| 背景処理 | `backdrop-filter: blur(4px)` |
| 閉じる操作 | `onClick` → `setPreview(false)` |
| 非同期読込 | LazyLoad対応 |

---

## 3.4 翻訳操作仕様（v2.1追加）

### 3.4.1 概要

投稿本文下に表示される「翻訳」ボタンを押下すると、  
選択された言語（JA/EN/ZH）に応じてバックエンドAPIが翻訳文を生成・返却する。  
結果は Redis キャッシュに保存され、再表示時のレスポンスを最適化する。

### 3.4.2 UI動作

| 要素 | 内容 |
|------|------|
| ボタン位置 | 本文末尾右下（灰色ラベルボタン） |
| ボタンラベル | 「翻訳」／「再翻訳」 |
| 翻訳領域 | 本文下に差し込みで展開 |
| 翻訳キャッシュ | Redis TTL 72時間 |
| 表示切替 | 折りたたみ可能（toggle式） |

### 3.4.3 UX補足

- 初回翻訳時はスピナー表示（最大1.5秒）。  
- 翻訳済みの場合は即時展開。  
- エラー発生時は軽量モーダルで通知（背景は薄灰）。  
- トーン＆マナーは控えめ、フォントサイズは本文より1pt小さく設定。  

---

## 3.5 関連仕様リンク

| 機能 | 参照章 | ファイル |
|------|--------|-----------|
| ヘッダー・タグ構造 | 第2章 | `board-detail-design-ch02_v2.1_full.md` |
| コメント・通報・リアクション | 第4章（移行予定） | `board-detail-design-ch04_v2.0.md` |
| 多言語キャッシュ構造 | 機能要件書 第3章 | `harmonet-functional-requirements-ch03-functional-req-part1_v1.3.md` |

---

**Document ID:** SEC-APP-BOARD-DETAIL-003-CH03  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-31  
**Version:** 2.1  
