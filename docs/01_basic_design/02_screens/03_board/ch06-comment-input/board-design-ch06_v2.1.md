# 第6章: 主要機能
**掲示板機能 詳細設計書 v2.1（HarmoNet準拠）**

[← 第5章](board-design-ch05_v2.1.md) | [目次に戻る](board-design-ch00-index_v2.0.md) | [第7章へ →](board-design-ch07_v2.0.md)

---

## 🆕 ChangeLog (v2.1 / 2025-10-31)
- HarmoNetトーン（やさしく・自然・控えめ）に再整形  
- AI自動モデレーション仕様を本章で完結化  
- PDF・Officeファイル仕様を第4章準拠に統一（PDF.jsプレビュー）  
- ファイル権限・制限仕様を明確化  
- テナント構造・非機能項目を軽く補足  
- GPTレビューコメントを追記  

---

## 6.1 投稿機能

投稿機能は、住民や管理者が掲示板に新規投稿を行うための中心機能である。  
投稿データはテナントごとに分離管理され、他テナントからは閲覧・検索できない。

### 6.1.1 投稿フォーム概要

- 詳細は「第5章 新規投稿画面」を参照。  
- 投稿時の入力内容は即時バリデーションされ、AIが投稿内容を解析して提案を行う。  

**入力項目**  
| 項目 | 必須 | 制限 |
|------|------|------|
| カテゴリ | 必須 | 1つのみ選択 |
| タイトル | 必須 | 最大50文字 |
| 本文 | 必須 | 最大2000文字 |
| 添付ファイル | 任意 | 最大5件、合計10MB |

### 6.1.2 自動設定項目

| 項目 | 内容 |
|------|------|
| 投稿者 | ログインユーザーの情報 |
| 投稿日時 | 投稿実行時のタイムスタンプ |
| 掲示板タイプ | カテゴリより自動判定（全体／グループ／回覧板） |
| 返信可否 | 回覧板では自動で「返信不可」 |

---

## 6.2 AI自動モデレーション機能

投稿時のAIモデレーションは、住民の安全を守るための中核機能である。  
AIは投稿内容を自然言語処理で解析し、不適切な表現・誤解を招く語句・感情トーンを自動的に判定する。  

### 6.2.1 判定フロー

```
投稿ボタン押下
  ↓
AIが投稿内容を解析（約0.5秒）
  ↓
判定結果を3段階で提示
```

| レベル | 内容 | 対応動作 |
|---------|------|----------|
| **レベル1** | 明確な違反（誹謗中傷、個人情報など） | 投稿ブロック＋修正指示 |
| **レベル2** | 改善提案が可能な表現 | 修正版を提示、選択投稿可 |
| **レベル3** | 問題なし | そのまま投稿完了 |

### 6.2.2 判定例

**レベル1（投稿ブロック）**  
> 「301号室の○○さん、夜中うるさい！」  
→ 個人特定＋攻撃的表現を検出。投稿ブロック。  

**レベル2（変換提案）**  
> 「外国人が多くて困る」  
→ 改善提案：「近隣で生活音が気になります。ご配慮をお願いします。」  

**レベル3（問題なし）**  
> 「自治会の会合は何時からでしたか？」  

### 6.2.3 ユーザー体験

- 判定結果はモーダルで表示し、柔らかい言葉で通知。  
- レベル2では「修正して投稿」「元のまま再編集」の2択を提供。  
- AIは“検閲”ではなく“安心をサポートする対話者”として設計されている。  

---

## 6.3 コメント機能

コメント機能は、投稿に対して1階層のみの返信を行う仕組みである。  
深いスレッド構造を避け、スマートフォンでも読みやすく保つ設計を採用。  

| 項目 | 内容 |
|------|------|
| 階層構造 | 1階層のみ |
| 文字数制限 | 最大500文字 |
| 添付ファイル | 不可（MVP段階） |
| 並び順 | 古い順（昇順） |

### 編集・削除
- 投稿者本人のみ編集・削除可能。  
- 管理者はすべてのコメントを削除可能（削除理由を入力）。  
- 削除後は「このコメントは削除されました」と静かに表示。  

---

## 6.4 添付ファイル機能

### 6.4.1 対応ファイル形式
| 種別 | 形式 | 機能 |
|------|------|------|
| 画像 | JPEG, PNG, GIF, WebP | プレビュー・拡大表示 |
| PDF | PDF | **PDF.jsプレビュー（モーダル表示）** |
| Office | Word, Excel, PowerPoint | ダウンロード（Phase 2でプレビュー予定） |

### 6.4.2 PDFプレビュー仕様（共通）
- 投稿詳細画面（第4章）と同一仕様。  
- モーダル中央にPDF.jsビューアを表示。  
- 上部に✕ボタン、下部に「タップで閉じる」表示。  
- 背景タップでは閉じず、PDFスクロールを優先。  
- アプリ追加不要。HarmoNet内で完結表示。  

### 6.4.3 ファイル制限
| 区分 | 最大ファイル数 | 合計サイズ |
|------|----------------|------------|
| 一般住民 | 5件 | 10MB |
| 管理者 | 10件 | 20MB |

### 6.4.4 非機能仕様
- tenant_id単位でファイル領域を分離管理。  
- 削除投稿の添付ファイルは非公開化（物理削除は行わない）。  
- PDFプレビューは遅延読み込みでパフォーマンス最適化。  

---

## 6.5 管理者機能拡張

管理者は以下の追加操作が可能。  

| 操作 | 説明 |
|------|------|
| 投稿削除 | 理由入力ダイアログを表示し、投稿者へ通知 |
| コメント削除 | 同上 |
| 添付ファイル制御 | 投稿後も削除／再アップロード可能 |
| NGワード辞書更新 | モデレーションの基準語句を管理 |
| テナント切替 | 管理者のみ複数テナント閲覧可能 |

管理画面の詳細仕様は「管理者ダッシュボード設計書（別紙）」を参照。  

---

## 6.6 設計意図まとめ

1. 住民が安心して書ける“心理的安全設計”を中心に据える。  
2. AIモデレーションを介して「投稿体験を守る」文化を醸成。  
3. テナント単位でデータを分離し、情報の漏洩を防止。  
4. 管理者が最小限の操作で安全維持を行える構造を提供。  

---

## GPTレビュー要約コメント（再構成版）

> 第6章は「投稿の安全性」を構造的に定義した章であり、技術設計と心理設計の融合が特徴。  
> 特にAIモデレーションは、検閲ではなく“住民の心の安全”を守る役割として再定義されている。  
> テナント分離やファイル遅延読み込みなど、現実運用を考慮した堅実な構成。  
> — *GPT上流設計レビュー担当（再編集）*  

---

**Document ID:** SEC-APP-BOARD-DESIGN-002-CH06  
**Version:** 2.1  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-31  
**Author:** TKD + GPT (HarmoNet PMO)  
