# 第8章: 掲示板詳細画面（状態管理・エラーハンドリング設計）

**掲示板詳細画面 設計書 v2.2**

[← 第7章](board-detail-design-ch07_v2.2.md) | [目次に戻る](board-detail-design-ch00-index.md)

---

## 🆕 ChangeLog (v2.2 / 2025-10-31)

- コード仕様中心の旧版を再構成し、UI/UX視点の設計に置換  
- 状態管理とエラーハンドリングの視覚的・操作的仕様を定義  
- 冗長なTypeScript・テスト記述を削除  
- 共通エラー設計書（`common-error-handling.md`）への参照統一  
- UIトーンを「やさしく・自然・控えめ」に統一  
- HarmoNet共通フォーマット（Document ID, Version, 日付）に更新  

---

## 8.1 概要

本章は、掲示板詳細画面における**状態管理**および**エラーハンドリング**のUI設計を定義する。  
対象範囲は、投稿・コメント・既読・翻訳・プレビューなどの操作時に発生する状態遷移および通知表現。  

目的は、ユーザーがアプリ操作中に「今どの状態にあるか」を明確に把握でき、  
障害や通信断時にも安心して操作を継続できるUXを実現することである。  

---

## 8.2 状態管理設計

### 8.2.1 状態分類

| 状態名 | 内容 | 表現方法 |
|--------|------|-----------|
| 通常 | 操作可能な通常状態 | すべてのUI要素が有効 |
| 処理中 | 投稿送信・翻訳リクエストなど非同期処理中 | スピナー表示、ボタン非活性 |
| 成功 | 操作完了時 | トースト通知（青系） |
| 失敗 | 通信・モデレーション失敗 | トースト通知（赤系） |
| 再試行待機 | エラー後のリトライ状態 | 「再試行」ボタン表示 |

### 8.2.2 状態遷移の原則

- 状態遷移は視覚的に明示する（例：ボタン色変化／スピナー）。  
- 状態変化は0.2〜0.3秒以内に描画反映。  
- 成功／失敗は共通トーストUIを使用。  
- 連続操作を防ぐため、処理中はボタンを非活性化する。  

---

## 8.3 エラーハンドリング設計

### 8.3.1 エラー分類

| 種別 | 内容 | 表示形式 |
|------|------|-----------|
| 通信エラー | ネットワーク断・タイムアウト | トースト（赤）＋「再試行」ボタン |
| 入力エラー | 必須項目・文字数超過 | 入力欄下に赤字メッセージ |
| モデレーション拒否 | 不適切表現を検出 | モーダル通知＋修正案表示 |
| 権限エラー | 権限不足で操作不可 | ダイアログ通知（灰背景） |

### 8.3.2 再試行動作

- 再試行はエラー発生後に明示的にボタンを表示。  
- 再試行時は最後の操作を再送信（例：コメント投稿・既読更新）。  
- 成功時は自動的にトースト通知で結果を報告。  

### 8.3.3 モーダル通知例

```
⚠ 投稿を送信できませんでした。
[再試行]　[キャンセル]
```

- トーン：淡赤背景（#FFEBEE）＋青ボタン（#1565C0）  
- アニメーション：フェードイン／フェードアウト（0.25s）  

---

## 8.4 パフォーマンス・回復設計

### 8.4.1 非同期処理設計

- 投稿・翻訳・既読登録は非同期API処理を採用。  
- UIは**ローディング中の不安軽減**を目的に、スピナー＋灰色ボタンで進行中を明示。  
- 非同期完了後、状態を「成功」または「失敗」に即時切り替える。  

### 8.4.2 回復動作（リカバリ）

| 事象 | UI動作 | 備考 |
|------|---------|------|
| 通信断 | 自動再接続（5秒間隔） | 再接続成功で「通信が回復しました」表示 |
| タイムアウト | 再試行ダイアログ表示 | 最大3回まで |
| サーバエラー | 共通エラー画面遷移 | Phase2で実装予定 |

### 8.4.3 スピナー／トースト共通仕様

| 要素 | 仕様 |
|------|------|
| スピナー色 | #1565C0 |
| サイズ | 16px（小）／24px（中） |
| トースト位置 | 画面下部中央 |
| 表示時間 | 3秒 |

---

## 8.5 トーン＆マナー／共通仕様参照

### 8.5.1 トーン方針

- 状態遷移・通知・エラーすべてにおいて「やさしく・自然・控えめ」を原則とする。  
- 強い警告色（赤・黄）は限定的に使用。  
- 成功通知は淡青を基調とし、ユーザーに安心感を与える。  
- 過剰なアニメーションや音による演出は避ける。  

### 8.5.2 関連文書リンク

- `common-error-handling.md` – 共通エラーUI設計書  
- `harmonet-functional-requirements-ch03-functional-req-part1_v1.3.md` – 機能定義との整合仕様  
- `board-detail-design-ch07_v2.2.md` – インタラクション全体設計  

---

**Document ID:** SEC-APP-BOARD-DETAIL-008-CH08  
**Created:** 2025-10-27  
**Last Updated:** 2025-10-31  
**Version:** 2.2  
