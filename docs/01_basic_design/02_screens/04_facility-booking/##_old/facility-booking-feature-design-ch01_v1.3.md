# Chapter 01: 概要・MVP機能セット

**HarmoNet 施設予約機能設計書**

---

## 改訂履歴

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| v1.0 | 2025-10-29 | TKD + Claude | 初版作成 |
| v1.1 | 2025-10-29 | TKD + Claude | Phase整理、MVP範囲明確化、除外機能追加 |
| v1.2 | 2025-10-29 | TKD + Claude | 内容確認・詰め作業完了版 |

---

## 目次

1. [はじめに](#1-はじめに)
   - 1.1 [目的と背景](#11-目的と背景)
   - 1.2 [想定読者](#12-想定読者)
   - 1.3 [本章の位置づけ](#13-本章の位置づけ)

2. [基本方針](#2-基本方針)
   - 2.1 [共通予約構造の設計思想](#21-共通予約構造の設計思想)
   - 2.2 [ルール定義層での差異吸収](#22-ルール定義層での差異吸収)
   - 2.3 [UI統一の考え方](#23-ui統一の考え方)

3. [MVP機能セット（ゲスト駐車場）](#3-mvp機能セットゲスト駐車場)
   - 3.1 [実装範囲](#31-実装範囲)
   - 3.2 [MVP除外機能](#32-mvp除外機能)

4. [将来実装機能](#4-将来実装機能)
   - 4.1 [料金徴収の自動化](#41-料金徴収の自動化)
   - 4.2 [検討しない機能](#42-検討しない機能)

5. [施設設定の参考例](#5-施設設定の参考例)
   - 5.1 [位置づけ](#51-位置づけ)
   - 5.2 [施設種類の参考例](#52-施設種類の参考例)
   - 5.3 [注記](#53-注記)

---

## 1. はじめに

### 1.1 目的と背景

**目的：**

HarmoNet スマートコミュニケーションアプリにおける施設予約機能の設計方針と実装範囲を定義する。

**背景：**

- マンション・住宅開発における共用施設（ゲスト駐車場、集会室、パーティールーム等）の予約管理は、従来は紙ベースまたは管理会社への電話連絡で行われてきた
- これらの方法は、予約状況の可視化が困難、二重予約のリスク、多言語対応の困難さ、管理者の負担増などの課題を抱えている
- HarmoNetでは、住民が自らスマートフォンから簡単に施設予約ができる仕組みを提供することで、これらの課題を解決する

**施設予約機能が目指すもの：**

1. **住民の利便性向上**
   - いつでもどこでも予約可能
   - 空き状況の可視化
   - 多言語対応（日本語、英語、中国語）

2. **管理者の負担軽減**
   - 予約受付の自動化
   - 重複予約の防止
   - 予約履歴の一元管理

3. **透明性と公平性の確保**
   - ルールの明示
   - 予約履歴の記録
   - 利用状況の把握

---

### 1.2 想定読者

本設計書は、以下の関係者を対象とする：

- **開発チーム**（TKD + AI協働開発）
- **プロジェクトマネージャー**
- **テスト担当者**
- **将来の保守・運用担当者**

---

### 1.3 本章の位置づけ

本章（Chapter 01）は、施設予約機能全体の**「概要」と「MVP機能セット」**を定義する。

詳細仕様は以下のChapterで定義する：

- **Chapter 02**: 施設構造・データモデル
- **Chapter 03**: 予約フロー・画面構成
- **Chapter 04**: 予約制限ルール・検証
- **Chapter 05**: 管理機能
- **Chapter 06**: 多言語対応・通知機能
- **Chapter 07**: 将来拡張・補足

---


### 1.4 テナント単位の運用スコープ

本機能は、**テナント単位（団地・管理組合単位）で完全に独立した運用**を行います。  
施設予約データ、施設マスタ、ルール定義などはすべて `tenant_id` によってスコープ管理され、他テナントの情報と混在することはありません。

**設計方針**
- すべての主要テーブル（facility_master、facility_rule、reservation）は `tenant_id` を持つ。  
- ログインセッションに紐づく `tenant_id` と一致しないデータは、API層でアクセス拒否される。  
- テナント管理者は自テナント内の施設・予約・ルールのみを管理可能。  
- サービス全体の運営者（プラットフォーム管理者）は、監査目的に限り全テナント横断で参照可能。

**データスコープ例**

| データ種別 | 主キー構成 | テナント制御 | 備考 |
|-------------|-------------|---------------|------|
| `facility_master` | `id, tenant_id` | 各施設を所属テナントごとに分離 | テナント間で施設構成が異なる前提 |
| `facility_rule` | `id, tenant_id` | テナント独自ルール設定を許可 | 予約単位・最大日数などを自由設定 |
| `reservation` | `id, tenant_id` | 自テナント施設のみ予約可 | 交差予約は禁止 |

**UI・運用前提**
- ログイン時に選択された `tenant_id` に基づき、利用可能施設を自動フィルタ。  
- 管理者が複数テナントに属する場合、ヘッダーのテナント切替メニューで明示的にスコープを変更。  
- テナント切替時には、施設一覧・予約履歴・カレンダー情報を即時再取得。

---

## 2. 基本方針

### 2.1 共通予約構造の設計思想

**方針：**

HarmoNetの施設予約機能は、**「共通の予約システム」**として設計する。

**理由：**

- ゲスト駐車場、集会室、パーティールーム、ゲストルーム等、予約対象となる施設の種類は多様だが、**「予約する」という行為の本質は共通**
- 施設ごとに個別のシステムを作ると、開発・保守コストが増大し、ユーザーも混乱する
- **共通構造 + ルール定義層**のアーキテクチャにより、柔軟性と保守性を両立

---

### 2.2 ルール定義層での差異吸収

**設計方針：**

各施設の違いは、**「ルール定義テーブル（facility_rule）」**で吸収する。

**ルール定義の例：**

| 項目 | ゲスト駐車場 | 集会室 | ゲストルーム |
|------|-------------|--------|-------------|
| 予約単位 | 日単位 | 時間単位（30分刻み） | 日単位（宿泊） |
| 最大予約日数/時間 | 3日（設定可能） | 3時間（設定可能） | 2泊（設定可能） |
| 予約可能期間 | 翌月末まで | 翌月末まで | 翌月末まで |
| 承認フロー | 不要 | 必要 | 必要 |
| キャンセル可能期限 | 前日まで（設定可能） | 前日まで（設定可能） | 3日前まで（設定可能） |
| 料金 | 1日500円 | 1時間1000円 | 1泊3000円 |

**メリット：**

- 新しい施設タイプを追加する際、コードを変更せずルール定義を追加するだけでよい
- テナント（管理組合）ごとに柔軟な設定が可能
- 将来の機能拡張に強い

---

### 2.3 UI統一の考え方

**方針：**

基本的なUI操作は、**すべての施設タイプで統一**する。

**統一するUI要素：**

- カレンダー表示（空き状況の確認）
- 予約ボタン（予約申し込み）
- 予約確認画面（確認・キャンセル）
- 通知メッセージ（予約完了、リマインダー等）

**施設タイプごとに変わる要素：**

- カレンダーの表示単位（日単位 or 時間単位）
- 選択可能な予約枠の粒度
- 表示されるルール説明文

**例外：駐車場専用UI**

ゲスト駐車場のみ、**駐車場レイアウトMAP + 駐車場番号一覧**の専用UIを提供する。

- 静的画像（JPG）として駐車場のレイアウトMAPをアップロード可能
- 駐車場番号ごとに予約状況を表示
- カレンダーは「行＝駐車場番号、列＝日付」の形式

---

## 3. MVP機能セット（ゲスト駐車場）

### 3.1 実装範囲

**MVP対象施設：**

- ゲスト駐車場

**ユーザー機能：**

- 施設一覧表示
  - ユーザーが予約可能な施設を一覧表示
  - 施設名、説明文、料金を多言語表示

- 空き状況確認
  - カレンダー形式で空き状況を表示
  - 駐車場の場合：駐車場番号ごとに表示
  - 駐車場レイアウトMAP表示（静的画像）

- 予約申し込み
  - カレンダーから日付を選択
  - 駐車場番号を選択
  - 予約内容確認
  - 予約確定

- 予約確認・キャンセル
  - 自分の予約一覧表示
  - 予約詳細確認
  - 予約キャンセル（期限内のみ）

- 通知受信
  - 予約完了通知（メール）
  - リマインダー通知（予約日前日、メール）

**管理者機能：**

- 施設マスタ管理
  - 施設情報登録・編集・削除
  - 施設名（多言語）
  - 説明文（多言語）
  - レイアウトMAP（JPG画像アップロード）
  - 駐車場番号リスト設定
  - 表示順序設定

- ルール管理（施設ごとに設定可能）
  - 予約単位設定：日単位（駐車場）
  - 予約制限
    - 最大予約日数（駐車場、デフォルト3日、テナント設定可能）
    - 予約可能期間（翌月末まで）
  - キャンセルポリシー詳細設定
    - キャンセル可能期限（前日まで/当日まで/何日前まで）
    - ポリシー説明テキスト（多言語対応）
    - なぜそのルールなのか、住民に理解してもらうための説明
  - 料金設定
    - 有料/無料切り替え
    - 金額設定（1日あたり）
    - 料金表示テキスト

- 予約管理機能
  - 全予約状況確認（カレンダー形式、施設別表示）
  - 予約詳細表示
  - 代理予約
  - 予約キャンセル
  - 予約ブロック設定（メンテナンス等、理由記載）

- 多言語コンテンツ管理
  - 静的コンテンツ（UI要素）
    - 翻訳マスタテーブルで管理
    - ボタン、ラベル、メッセージ等
  - 動的コンテンツ（施設情報）
    - Google Translation API使用
    - 施設名・説明文の翻訳
    - 翻訳結果の確認・修正可能

---

### 3.2 MVP除外機能

**なし。**

MVPで施設予約の基本機能はすべて実装します。

---

## 4. 将来実装機能

### 4.1 料金徴収の自動化

**概要：**

アプリ内決済機能（クレジットカード、電子マネー等）

**現状：**

- 後日請求（管理組合が手動処理）
- 管理費と一緒に請求 or 現金徴収

**将来：**

- アプリ内で即座に決済完了
- 管理組合の事務負担軽減

**実装判断：**

- テナントの要望に応じて検討
- 決済手数料とのバランスを考慮

---

### 4.2 検討しない機能

以下の機能は、施設予約機能の範囲外として扱います。

**EV充電器管理：**

- 予約して使うものではない（空いていれば使う）
- 施設予約とは別機能として独立

**IoT連携（スマートロック）：**

- 既存サービス（Qrio、SESAME等）が存在
- ホームセキュリティ（セコム、ALSOK等）も提供
- わざわざ自分たちのアプリに組み込む必要性がない

**AI予測機能：**

- 予約に関しては不要
- 混雑予測やおすすめ提案は過剰機能

**コミュニティ機能連携：**

- 掲示板は単独メニュー
- 施設予約から連携する必要性なし

**利用統計レポート：**

- 管理者（一般人）は見ない
- 単に運用負担になるだけ
- IT企業や大企業がマーケティングで気にする内容

**HEMS連携：**

- 施設予約と全く関係ない
- デベロッパー or ハウスメーカーとの業務提携が前提
- APIがもらえないと実現不可
- 「業務提携できたら」の話
- アプリ全体の将来構想として別途検討

---

## 5. 施設設定の参考例

### 5.1 位置づけ

施設名称・種類は**テナントが完全に自由に設定**できます。

以下は参考として、一般的な施設例を示すものであり、これらに限定されるものではありません。

---

### 5.2 施設種類の参考例

#### 集会・パーティー系

- 集会室
- パーティールーム
- スカイラウンジ
- 多目的室
- バンケットルーム

#### 宿泊系

- ゲストルーム
- 来客宿泊室

#### 駐車・駐輪系

- ゲスト用駐車場
- 来客用駐輪場
- バイク駐車場

#### その他共用スペース系

- キッズルーム
- シアタールーム
- フィットネスジム
- コワーキングスペース
- ラウンジ
- 茶室
- ゴルフ練習場
- ビリヤードルーム

---

### 5.3 注記

**これらはあくまで参考例です。**

テナントは任意の名称・用途で施設を登録できます。

- 名称は完全に自由入力
- 説明文も自由入力
- ルール設定も施設ごとに個別設定可能

---

## 📋 今後の検討事項

以下のChapterで詳細を詰めていきます：

- **Chapter 02: 施設構造・データモデル**
  - テーブル設計
  - ER図
  - テナント管理の実装方式

- **Chapter 03: 予約フロー・画面構成**
  - 画面遷移
  - UI/UX詳細
  - 駐車場MAP表示の詳細

- **Chapter 04: 予約制限ルール・検証**
  - バリデーション仕様
  - 排他制御
  - エラーメッセージ定義

- **Chapter 05: 管理機能**
  - テナント管理画面の詳細
  - 施設マスタ管理の実装
  - ルール設定UIの詳細

- **Chapter 06: 多言語対応・通知機能**
  - 翻訳フロー
  - メール通知仕様
  - プッシュ通知仕様

- **Chapter 07: 将来拡張・補足**
  - 技術実装詳細への参照
  - 制約事項
  - 既知の課題

---

**Document ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH01  
**Status**: 確定版  
**Created**: 2025-10-29  
**Last Updated**: 2025-10-29  
**Version**: v1.2  
**Authors**: TKD + Claude  

---

© 2025 HarmoNet Project. All rights reserved.
