# 掲示板詳細画面 詳細設計書 v2.0 - 第2章: ヘッダー領域

**HarmoNET スマートコミュニケーションアプリ**

**文書ID**: HRM-APP-BOARD-DETAIL-DESIGN-001-CH02  
**バージョン**: v2.0  
**最終更新**: 2025年10月29日  
**作成者**: TKD + Claude

---

## 📝 改訂履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| v1.0 | 2025年10月28日 | 初版作成 |
| v2.0 | 2025年10月29日 | 三点メニューの詳細化、権限別表示の追加 |

---

## 目次

- [2.1 ヘッダー領域の概要](#21-ヘッダー領域の概要)
- [2.2 戻るボタン](#22-戻るボタン)
- [2.3 画面タイトル](#23-画面タイトル)
- [2.4 三点メニュー](#24-三点メニュー)
- [2.5 通知ボタン](#25-通知ボタン)
- [2.6 言語切替ボタン](#26-言語切替ボタン)

---

## 2.1 ヘッダー領域の概要

### 2.1.1 基本構成

掲示板詳細画面のヘッダーは、**HarmoNET共通ヘッダー**を使用し、以下の要素で構成されます。

```
┌─────────────────────────────────────────────┐
│ [←] 掲示板詳細        [🔔] [JA ▼] [⋮]        │
└─────────────────────────────────────────────┘
    ↑    ↑               ↑     ↑     ↑
   戻る  タイトル         通知  言語  三点メニュー
```

### 2.1.2 レイアウト仕様

**高さ**
- ヘッダー全体: `64px`（タップ領域確保）
- セーフエリア上部余白: 環境変数で自動調整

**横幅**
- 全幅: `100%`
- 左右余白: `16px`
- 要素間隔: `12px`

**配置**
```css
/* 左側 */
戻るボタン: 左端から16px
画面タイトル: 戻るボタンから12px

/* 右側 */
三点メニュー: 右端から16px
言語切替: 三点メニューから12px
通知ボタン: 言語切替から12px
```

### 2.1.3 スタイル仕様

**背景**
- 背景色: `bg-white` (#FFFFFF)
- 下部ボーダー: `border-b border-gray-200` (1px、#E5E7EB)

**固定表示**
- `position: fixed`
- `top: 0`
- `z-index: 100`（コンテンツより前面）
- スクロールしても常に表示

**参照**: 共通ヘッダー仕様 `common-header_v1_1.md`

---

## 2.2 戻るボタン

### 2.2.1 表示仕様

**アイコン**
- アイコン種類: `←`（左向き矢印）
- アイコンサイズ: `24px × 24px`
- アイコン色: `text-gray-700` (#374151)

**タップ領域**
- サイズ: `44px × 44px`（最小タップ領域）
- 位置: ヘッダー左端から16px

**スタイル**
```css
.back-button {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #374151;
  cursor: pointer;
}

.back-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
  border-radius: 8px;
}

.back-button:active {
  background-color: rgba(0, 0, 0, 0.1);
}
```

### 2.2.2 動作仕様

**基本動作**
1. タップすると掲示板一覧画面に戻る
2. 画面遷移はブラウザの履歴を使用（`history.back()`）
3. 遷移アニメーション: 右から左へスライド（300ms）

**コメント入力中の動作**
- コメント入力欄に文字がある場合
  - 確認ダイアログを表示
  - 「入力中の内容が失われますがよろしいですか？」
  - キャンセル / 戻る

**確認ダイアログの仕様**
```javascript
{
  title: "入力中の内容が失われます",
  message: "コメントの入力内容が保存されていません。このまま戻りますか？",
  buttons: [
    { label: "キャンセル", action: "close" },
    { label: "戻る", action: "back", style: "destructive" }
  ]
}
```

### 2.2.3 アクセシビリティ

**ARIAラベル**
```html
<button 
  class="back-button"
  aria-label="掲示板一覧に戻る"
  type="button">
  ←
</button>
```

**キーボード操作**
- `Tab`キーでフォーカス
- `Enter`または`Space`キーで実行

---

## 2.3 画面タイトル

### 2.3.1 表示仕様

**テキスト**
- 表示内容: `掲示板`（固定）
- 多言語対応: 
  - 日本語: `掲示板`
  - 英語: `Board`
  - 中国語: `公告板`

**スタイル**
- フォントサイズ: `18px`
- フォントウェイト: `font-semibold` (600)
- 文字色: `text-gray-900` (#1F2937)
- 行の高さ: `24px`

**配置**
- 位置: 戻るボタンの右側（12px間隔）
- 垂直方向: 中央揃え

```css
.header-title {
  font-size: 18px;
  font-weight: 600;
  color: #1F2937;
  line-height: 24px;
  margin-left: 12px;
}
```

### 2.3.2 動作仕様

**基本動作**
- タップ不可（テキスト表示のみ）
- 選択不可（user-select: none）

### 2.3.3 レスポンシブ対応

**スマホ（〜767px）**
- 表示: あり
- フォントサイズ: 18px

**タブレット（768px〜）**
- 表示: あり
- フォントサイズ: 18px

**デスクトップ（1024px〜）**
- 表示: あり
- フォントサイズ: 20px

---

## 2.4 三点メニュー

### 2.4.1 表示仕様

**アイコン**
- アイコン種類: `⋮`（縦3点リーダー）
- アイコンサイズ: `24px × 24px`
- アイコン色: `text-gray-700` (#374151)

**タップ領域**
- サイズ: `44px × 44px`
- 位置: ヘッダー右端から16px

**スタイル**
```css
.menu-button {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #374151;
  cursor: pointer;
}

.menu-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
  border-radius: 8px;
}

.menu-button:active {
  background-color: rgba(0, 0, 0, 0.1);
}
```

### 2.4.2 メニュー項目の仕様

三点メニューをタップすると、**ボトムシート**形式でメニューが表示されます。

#### 一般ユーザー（他人の投稿）の場合

```
┌─────────────────────────┐
│  ⚠️  通報する           │
│                         │
│  ━━━━━━━━━━━━━━━━━━   │
│                         │
│  ✕  キャンセル          │
└─────────────────────────┘
```

**メニュー項目**
1. **通報する**
   - アイコン: `⚠️`
   - テキスト: `通報する`
   - 動作: 通報理由選択画面に遷移

2. **キャンセル**
   - アイコン: `✕`
   - テキスト: `キャンセル`
   - 動作: メニューを閉じる

#### 投稿者本人の場合

```
┌─────────────────────────┐
│  ✏️  編集する           │
│                         │
│  🗑️  削除する           │
│                         │
│  ━━━━━━━━━━━━━━━━━━   │
│                         │
│  ✕  キャンセル          │
└─────────────────────────┘
```

**メニュー項目**
1. **編集する**
   - アイコン: `✏️`
   - テキスト: `編集する`
   - 動作: 投稿編集画面に遷移

2. **削除する**
   - アイコン: `🗑️`
   - テキスト: `削除する`
   - スタイル: 赤文字（`text-red-600`）
   - 動作: 削除確認ダイアログを表示

3. **キャンセル**
   - アイコン: `✕`
   - テキスト: `キャンセル`
   - 動作: メニューを閉じる

#### 管理者の場合

```
┌─────────────────────────┐
│  ✏️  編集する           │
│                         │
│  🗑️  削除する           │
│                         │
│  ⚠️  通報する           │
│                         │
│  ━━━━━━━━━━━━━━━━━━   │
│                         │
│  ✕  キャンセル          │
└─────────────────────────┘
```

**メニュー項目**
1. **編集する**（全ての投稿で表示）
2. **削除する**（全ての投稿で表示）
3. **通報する**（念のため表示）
4. **キャンセル**

### 2.4.3 ボトムシートの仕様

**表示アニメーション**
- 下から上にスライドイン（300ms）
- イージング: `ease-out`

**背景オーバーレイ**
- 背景色: `rgba(0, 0, 0, 0.5)`（半透明黒）
- タップで閉じる

**メニュー項目のスタイル**
```css
.menu-item {
  height: 56px;
  padding: 0 24px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 16px;
  color: #1F2937;
  cursor: pointer;
}

.menu-item:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.menu-item:active {
  background-color: rgba(0, 0, 0, 0.1);
}

.menu-item.destructive {
  color: #DC2626; /* 赤色 */
}

.menu-item.cancel {
  border-top: 1px solid #E5E7EB;
  font-weight: 600;
}
```

### 2.4.4 削除確認ダイアログの仕様

**表示タイミング**
- 三点メニューの「削除する」をタップ時

**ダイアログ内容**
```javascript
{
  title: "投稿を削除しますか？",
  message: "削除した投稿は復元できません。コメントは残ります。",
  buttons: [
    { label: "キャンセル", action: "close" },
    { label: "削除する", action: "delete", style: "destructive" }
  ]
}
```

**削除処理**
1. 「削除する」ボタンをタップ
2. ローディング表示（「削除中...」）
3. API呼び出し: `DELETE /api/posts/{postId}`
4. 成功時: 掲示板一覧画面に戻る
5. 失敗時: エラーメッセージ表示

**エラーメッセージ**
```
削除に失敗しました。
もう一度お試しください。
```

### 2.4.5 権限判定ロジック

**投稿者本人の判定**
```javascript
const isOwner = currentUser.id === post.author.id;
```

**管理者の判定**
```javascript
const isAdmin = currentUser.role === 'admin';
```

**メニュー表示ロジック**
```javascript
if (isAdmin) {
  // 管理者: 編集・削除・通報
  showMenu(['edit', 'delete', 'report', 'cancel']);
} else if (isOwner) {
  // 投稿者本人: 編集・削除
  showMenu(['edit', 'delete', 'cancel']);
} else {
  // 一般ユーザー: 通報のみ
  showMenu(['report', 'cancel']);
}
```

### 2.4.6 アクセシビリティ

**ARIAラベル**
```html
<button 
  class="menu-button"
  aria-label="投稿のメニューを開く"
  aria-expanded="false"
  type="button">
  ⋮
</button>
```

**キーボード操作**
- `Tab`キーでフォーカス
- `Enter`または`Space`キーで開く
- `Esc`キーで閉じる
- メニュー内は矢印キーで移動

---

## 2.5 通知ボタン

### 2.5.1 表示仕様

**アイコン**
- アイコン種類: `🔔`（ベル）
- アイコンサイズ: `24px × 24px`
- アイコン色: `text-gray-700` (#374151)

**未読バッジ**
- 表示条件: 未読通知がある場合
- 位置: アイコン右上
- サイズ: `8px × 8px`（丸）
- 背景色: `bg-red-500` (#EF4444)

**タップ領域**
- サイズ: `44px × 44px`
- 位置: 言語切替ボタンの左側（12px間隔）

**スタイル**
```css
.notification-button {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  color: #374151;
  cursor: pointer;
}

.notification-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 8px;
  height: 8px;
  background-color: #EF4444;
  border-radius: 50%;
  border: 2px solid #FFFFFF;
}
```

### 2.5.2 動作仕様

**基本動作**
1. タップすると通知一覧画面に遷移
2. 画面遷移: 右から左へスライド（300ms）

**参照**: 共通ヘッダー仕様 `common-header_v1_1.md`

---

## 2.6 言語切替ボタン

### 2.6.1 表示仕様

**テキスト**
- 表示内容: 現在選択中の言語コード
  - 日本語: `JA`
  - 英語: `EN`
  - 中国語: `ZH`
- フォントサイズ: `14px`
- フォントウェイト: `font-semibold` (600)
- 文字色: `text-gray-700` (#374151)

**ドロップダウンアイコン**
- アイコン種類: `▼`（下向き三角）
- アイコンサイズ: `12px × 12px`
- 位置: テキストの右側（4px間隔）

**タップ領域**
- サイズ: `60px × 44px`
- 位置: 三点メニューの左側（12px間隔）

**スタイル**
```css
.language-button {
  width: 60px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  color: #374151;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
}

.language-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
  border-radius: 8px;
}
```

### 2.6.2 動作仕様

**言語選択メニュー**
タップすると、ドロップダウンメニューが表示されます。

```
┌─────────────────┐
│ ✓ 日本語 (JA)   │
│   English (EN)  │
│   中文 (ZH)     │
└─────────────────┘
```

**メニュー項目**
- 現在選択中の言語にチェックマーク `✓`
- 各言語の母語表記 + 言語コード

**言語切替処理**
1. 言語を選択
2. UIの全テキストを選択言語に切り替え
3. ローカルストレージに保存
4. 画面を再描画（リロードなし）

**参照**: 共通i18n仕様 `common-i18n_v1_0.md`

### 2.6.3 アクセシビリティ

**ARIAラベル**
```html
<button 
  class="language-button"
  aria-label="言語を選択"
  aria-expanded="false"
  type="button">
  JA ▼
</button>
```

---

## 2.7 ヘッダー全体の動作仕様

### 2.7.1 スクロール時の動作

**基本動作**
- ヘッダーは常に固定表示（`position: fixed`）
- スクロールしても位置は変わらない

**スクロールダウン時**
- 表示: そのまま表示
- アニメーション: なし

**スクロールアップ時**
- 表示: そのまま表示
- アニメーション: なし

**理由**: 戻るボタンや三点メニューは常時アクセス可能にする

### 2.7.2 画面遷移時の動作

**遷移元画面からの表示**
- フェードイン（200ms）
- 遷移アニメーションと同期

**遷移先画面への移動**
- フェードアウト（200ms）
- 遷移アニメーションと同期

### 2.7.3 エラー状態の表示

**ネットワークエラー時**
- ヘッダーは通常通り表示
- 戻るボタンは有効（オフライン時も使用可能）

**権限エラー時**
- ヘッダーは通常通り表示
- 三点メニューは非表示（権限なし）

---

## 2.8 レスポンシブ対応

### 2.8.1 スマホ（〜767px）

**レイアウト**
- ヘッダー高さ: `64px`
- 全要素を1行に配置
- 戻るボタン、タイトル、通知、言語、三点メニュー

**タイトル表示**
- 表示: あり
- フォントサイズ: `18px`
- 最大幅: 計算値（画面幅 - 左右要素の合計幅）
- 省略: `text-overflow: ellipsis`

### 2.8.2 タブレット（768px〜1023px）

**レイアウト**
- ヘッダー高さ: `64px`
- スマホと同じ配置

**タイトル表示**
- 表示: あり
- フォントサイズ: `18px`

### 2.8.3 デスクトップ（1024px〜）

**レイアウト**
- ヘッダー高さ: `64px`
- 最大幅: `800px`（中央揃え）
- 左右余白: 自動計算

**タイトル表示**
- 表示: あり
- フォントサイズ: `20px`

---

## 2.9 テスト項目

### 2.9.1 機能テスト

**戻るボタン**
- ✅ タップで掲示板一覧画面に戻る
- ✅ コメント入力中は確認ダイアログ表示
- ✅ 確認ダイアログの「キャンセル」で閉じる
- ✅ 確認ダイアログの「戻る」で遷移

**三点メニュー**
- ✅ 他人の投稿では「通報」のみ表示
- ✅ 自分の投稿では「編集」「削除」を表示
- ✅ 管理者は全ての投稿で「編集」「削除」「通報」を表示
- ✅ 「削除する」タップで確認ダイアログ表示
- ✅ 削除成功後、一覧画面に戻る

**通知ボタン**
- ✅ 未読通知がある場合、バッジ表示
- ✅ タップで通知一覧画面に遷移

**言語切替ボタン**
- ✅ タップでドロップダウンメニュー表示
- ✅ 言語選択で全テキスト切り替え
- ✅ 選択言語をローカルストレージに保存

### 2.9.2 UIテスト

**配置**
- ✅ 各要素が仕様通りの位置に配置
- ✅ タップ領域が44px × 44px以上
- ✅ 要素間隔が仕様通り

**スタイル**
- ✅ 背景色が白
- ✅ 下部ボーダーが表示
- ✅ アイコン色が正しい

**レスポンシブ**
- ✅ スマホで正しく表示
- ✅ タブレットで正しく表示
- ✅ デスクトップで正しく表示

### 2.9.3 アクセシビリティテスト

**ARIAラベル**
- ✅ 各ボタンにaria-labelが設定
- ✅ スクリーンリーダーで読み上げ可能

**キーボード操作**
- ✅ Tabキーでフォーカス移動
- ✅ EnterまたはSpaceキーで実行
- ✅ Escキーでメニューを閉じる

---

## 🔗 関連ドキュメント

### 共通部品
- `common-header_v1_1.md` - ヘッダー共通仕様
- `common-i18n_v1_0.md` - 翻訳機能の共通仕様

### 画面遷移先
- [第7章: インタラクション仕様](board-detail-design-ch07_v1_0.md) - 通報・編集・削除フロー

### デザインシステム
- `harmonet-design-system_v1_0.md` - HarmoNET Design System

---

**Document ID:** HRM-APP-BOARD-DETAIL-DESIGN-001-CH02  
**Status:** 承認待ち  
**Created:** 2025-10-29  
**Last Updated:** 2025-10-29  
**Approved by:** _未承認_

---

HarmoNET スマートコミュニケーションアプリ  
掲示板詳細画面 詳細設計書 v2.0 - 第2章
