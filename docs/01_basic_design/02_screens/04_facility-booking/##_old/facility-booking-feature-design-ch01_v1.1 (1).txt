# 施設予約機能 詳細設計書 Chapter 01: 概要・MVP機能セット

**HarmoNet スマートコミュニケーションアプリ**

**文書ID**: HARMONET-FACILITY-BOOKING-DESIGN-001-CH01  
**バージョン**: v1.1  
**最終更新**: 2025年10月29日  
**ステータス**: 承認待ち

---

## 📝 改訂履歴 (Changelog)

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|---------|--------|
| v1.1 | 2025年10月29日 | MVPの仕様見直しに伴い、「3. MVP機能セット」を更新。連続予約機能をMVP除外対象に変更。 | TKD + Gemini |
| v1.0 | 2025年10月29日 | 初版作成 | TKD |

---

## 目次

1. [目的と背景](#1-目的と背景)
2. [基本方針](#2-基本方針)
   - [2.1 共通予約構造の設計思想](#21-共通予約構造の設計思想)
   - [2.2 ルール定義層での差異吸収](#22-ルール定義層での差異吸収)
3. [MVP機能セット（ゲスト駐車場）](#3-mvp機能セットゲスト駐車場)
   - [3.1 MVP実装範囲](#31-mvp実装範囲)
   - [3.2 MVP除外機能](#32-mvp除外機能)
4. [将来実装機能](#4-将来実装機能)
   - [4.1 Phase 2: 室内施設予約](#41-phase-2-室内施設予約)
   - [4.2 Phase 3: 高度化機能](#42-phase-3-高度化機能)
5. [対象施設の分類](#5-対象施設の分類)
   - [5.1 室内系施設](#51-室内系施設)
   - [5.2 宿泊・駐車系施設](#52-宿泊駐車系施設)
   - [5.3 設備・備品](#53-設備備品)

---

## 1. 目的と背景

### 1.1 HarmoNetにおける施設予約機能の位置づけ

施設予約機能は、HarmoNetアプリケーションにおける重要な住民サービス機能の一つです。住民が共用施設をオンラインで予約・管理できる仕組みを提供し、管理組合の業務効率化と住民の利便性向上を同時に実現します。

HarmoNetの開発目的の一つである「共用施設の効率利用」を具体化する機能として、以下の価値を提供します：

- リアルタイムでの予約状況確認
- 24時間受付可能な予約プロセス
- 紙台帳の廃止による管理コスト削減
- 予約ルールのシステム化による公平性の担保

---

## 2. 基本方針

### 2.1 共通予約構造の設計思想

本機能は、ゲスト駐車場（MVP）から集会室、ゲストルーム（Phase 2）まで、多様な施設に対応可能な共通基盤として設計されます。

将来的な拡張性を最重要視し、「施設ごとの固有ルール」をハードコーディングするのではなく、データモデル（`facility_rule`）とロジック層で吸収するアーキテクチャを採用します。

### 2.2 ルール定義層での差異吸収

施設ごとの「予約単位（時間/日）」「料金」「承認要否」「予約可能期間」といった差異は、すべて `facility_type` に紐づく `facility_rule` テーブルで管理します。

これにより、新たな施設タイプ（例：パーティールーム）が追加された場合も、コードの変更を最小限に抑え、ルール定義（DBデータ）の追加のみで対応可能とします。

---

## 3. MVP機能セット（ゲスト駐車場）

MVP（Minimum Viable Product）では、最も利用頻度が高く、かつ仕様が標準的な「ゲスト駐車場」の予約機能にスコープを絞り、迅速な価値提供を目指します。

### 3.1 MVP実装範囲

MVPで実装する主要な機能は以下の通りです。

- **施設カテゴリ**: 駐車場
- **施設タイプ**: ゲスト駐車場（日単位）
- **予約フロー**:
    - 予約カレンダー（FB-01）
    - 駐車場MAP（FB-02）
    - 予約確認（FB-03）
    - 予約完了（FB-04）
- **マイ予約**:
    - 予約一覧（FB-05）
    - 予約詳細（FB-06）
    - 予約キャンセル（FB-07）
- **基本ルール**:
    - 1日単位での予約（単日予約のみ）
    - 同日複数予約の禁止
    - 予約可能期間（例：30日先まで）の制限
    - 排他制御による二重予約防止
    - キャンセルポリシー（例：前日まで）

### 3.2 MVP除外機能

MVPのスコープを明確にするため、以下の機能はPhase 2以降の対応とします。

- **決済機能**:
    - アプリ内決済（クレジットカード、PayPay等）
    - （MVPでは現行運用（集金箱への現金投入、または管理費合算）を想定）
- **時間単位の予約**:
    - 集会室などで必要となる「時間単位」の予約ロジック
- **承認フロー**:
    - 管理者による予約の「承認・否認」ワークフロー
- **抽選機能**:
    - 特定の施設（例：ゲストルーム）で必要となる抽選ロジック
- **設備・備品予約**:
    - プロジェクターやマイクなどの備品同時予約
- **連続予約機能**:
    - 複数の日付を一度に予約する機能（例：3日連続での予約）
    - （MVPでは公平性の観点、および実装の簡素化のため、1日単位での予約操作のみを許可する）

---

## 4. 将来実装機能

### 4.1 Phase 2: 室内施設予約

MVPの基盤を活用し、より複雑なルールを持つ室内施設に対応します。

**対象施設**:
- 集会室
- パーティールーム
- 会議室
- ゲストルーム

**追加機能**:
- 時間単位予約
- 承認ワークフロー
- 設備・備品予約
- 抽選機能
- 施設ごとの料金設定（時間帯別料金など）

### 4.2 Phase 3: 高度化機能

施設予約機能の利便性をさらに高めるための高度な機能群です。

#### 4.2.1 アプリ内決済
- クレジットカード、電子マネーによるオンライン決済
- `booking` テーブルの `payment_status` と連動した管理

#### 4.2.2 AI予測機能（混雑予測）
- 過去の予約データから混雑時期を予測
- おすすめの予約日時を提案

#### 4.2.3 コミュニティ機能連携
- 掲示板機能と連携（イベント企画・参加者募集）
- 施設利用レポートの共有

---

## 5. 対象施設の分類

HarmoNetで予約可能な施設を、以下のカテゴリに分類します。

### 5.1 室内系施設

**特徴**:
- 屋内の施設
- 時間単位での予約が主
- 承認フローが必要な場合が多い
- 利用目的・人数の入力が必要

**対象施設**:
- 集会室（Phase 2）
- パーティールーム（Phase 2）
- シアタールーム（Phase 3）
- 会議室（Phase 2）

### 5.2 宿泊・駐車系施設

**特徴**:
- 日単位での予約が主
- 比較的シンプルな予約フロー
- 車両情報・宿泊者情報の入力が必要

**対象施設**:
- ゲストルーム（Phase 2）
- ゲスト駐車場（MVP対象）
- 来客用バイク置場（Phase 3）

### 5.3 設備・備品

**特徴**:
- 施設予約と同時に予約
- 在庫管理（数量管理）が必要

**対象施設**:
- プロジェクター
- ホワイトボード
- 調理器具セット
- ゲスト用布団セット